void OnStart()
{
SetMapDisplayNameEntry("LVL2Name");
SetEnemySanityDecreaseActive("RealDog", false);
SetEnemySanityDecreaseActive("ChaseBrute", false);
SetLanternDisabled(true);
ClearSavedMaps();
SetGlobalVarInt("BeenThereBefore", 0);
CreateParticleSystemAtEntityExt("LVL1SteamPS1", "ps_steam.ps", "LVL1SteamArea1", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS1", "ps_steam.ps", "BrokenPipeFlow", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS2", "ps_steam.ps", "BrokenPipeFlow", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS3", "ps_steam.ps", "BrokenPipeFlow2", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS4", "ps_steam.ps", "BrokenPipeFlow2", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS5", "ps_steam.ps", "BrokenPipeFlow3", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS6", "ps_steam.ps", "BrokenPipeFlow4", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS7", "ps_steam_cloud.ps", "BrokenSteamCloud_1", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS8", "ps_steam_cloud.ps", "BrokenSteamCloud_2", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS9", "ps_steam_cloud.ps", "BrokenSteamCloud_3", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS10", "ps_steam_cloud.ps", "BrokenSteamCloud_4", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS11", "ps_steam_cloud.ps", "BrokenSteamCloud_5", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS12", "ps_steam_cloud.ps", "BrokenSteamCloud_6", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS13", "ps_steam_cloud.ps", "BrokenSteamCloud_7", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS14", "ps_steam_cloud.ps", "BrokenSteamCloud_8", true, 1, 1, 1, 1, false, 0, 0, 0, 0);
SetLightVisible("LightButton1_Dead_1", false);
SetLightVisible("LightButton1_Dead_2", false);
SetLightVisible("LightButton1_Dead_3", false);
SetLightVisible("LightButton1_Dead_4", false);
SetLightVisible("LightButton1_Dead_5", false);
SetLightVisible("LightButton1_Dead_6", false);
SetLightVisible("LightButton1_Dead_7", false);
SetLightVisible("LightButton1_Dead_8", false);
SetLightVisible("LightButton1_Dead_9", false);
AddUseItemCallback("LockPick_1", "Lockpick", "Chest_1", "LockpickChest_1", false);
AddUseItemCallback("LockPick_2", "Lockpick", "Chest_2", "LockpickChest_2", false);
FadeLightTo("LVL2BridgeLight", 0, 0, 0, 0, -1, 3);
CompleteQuest("Chapter1AOnly", "CHP1A");
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLightVisible("LightButton1_Dead_1", false);
SetLightVisible("LightButton1_Dead_2", false);
SetLightVisible("LightButton1_Dead_3", false);
SetLightVisible("LightButton1_Dead_4", false);
SetLightVisible("LightButton1_Dead_5", false);
SetLightVisible("LightButton1_Dead_6", false);
SetLightVisible("LightButton1_Dead_7", false);
SetLightVisible("LightButton1_Dead_8", false);
SetLightVisible("LightButton1_Dead_9", false);
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLightVisible("DogDisappearLight", false);
SetLightVisible("LVL2BigLight", false);
SetLocalVarInt("PlayerOnLVL", 1);
SetLocalVarInt("Keypad1Code", 0);
SetLocalVarInt("Keypad2Code", 0);
SetLocalVarInt("Keypad3Code", 0);
SetLocalVarInt("RoobyLightOn", 0);
SetLocalVarInt("RoobyRoomLightOn", 0);
SetLocalVarInt("RoobyHallwayLightOn", 0);
SetLocalVarInt("RoobyKitchenLightOn", 0);
SetLocalVarInt("ElixirDiscover", 0);
SetLocalVarInt("ElixirState", 0);
SetLocalVarInt("Infected", 0);
SetLocalVarInt("InfProgress", 0);
SetLocalVarInt("Dreaming", 0);
SetLocalVarInt("PowerLVL1", 1);
SetLocalVarInt("PowerLVL2", -1);
SetLocalVarInt("PowerLVL3", 1);
SetLocalVarInt("PowerLVL5", 1);
SetLocalVarInt("ScorchAOETrue", 0);
SetLocalVarInt("MP1Progress", 1);
SetLocalVarInt("MPSFound", 0);
SetLocalVarInt("Scared", 0);
SetLocalVarInt("RealDogState", -1);
SetLocalVarInt("ReachedLVL7", 0);
AddEntityCollideCallback("Player", "DoorScare", "DoorScareTrigger", true, 1);
AddEntityCollideCallback("Player", "TriggerDogWalk", "DogScareLanternPrep", false, 1);
AddEntityCollideCallback("CinematicDog", "TriggerDogDisappear", "DogDisappear", true, 1);
AddEntityCollideCallback("Player", "LVL2InfectSpot", "InfectPlayerLVL2", false, 0);
AddEntityCollideCallback("Player", "LVL3InfectArea", "InfectPlayerLVL3", false, 0);
AddUseItemCallback("", "Screwdriver", "BrokenPipeScrew", "FixPipes", false);
AddEntityCollideCallback("Player", "LVL2BridgeScares", "LVL2BridgeScareSystem", true, 1);
AddEntityCollideCallback("Player", "ScorchBellTrigger", "TriggerScorchBell", true, 1);
AddEntityCollideCallback("Player", "ScorchArea", "ScorchFunc", false, 1);
AddEntityCollideCallback("Player", "ScorchArea2", "ScorchFunc2", false, -1);
AddEntityCollideCallback("Player", "ScriptedDogAppear", "TriggerDogScripted", true, 1);
AddEntityCollideCallback("Player", "PipeWTFArea", "PipeWTFMSG", true, 1);
AddEntityCollideCallback("Player", "LVL4PipeScare", "LVL4PipeScare", true, 1);
AddEntityCollideCallback("Player", "LVL3DogTrigger_1", "LVL3DogSpawn1", false, 1);
AddEntityCollideCallback("Player", "LVL3DogTrigger_2", "LVL3DogSpawn2", false, 1);
AddEntityCollideCallback("Player", "LVL3DogTrigger_3", "LVL3DogSpawn3", false, 1);
AddEntityCollideCallback("Player", "LVL2DogTrigger_1", "LVL2DogSpawn1", false, 1);
AddEntityCollideCallback("Player", "LVL2DogTrigger_2", "LVL2DogSpawn2_3", false, 1);
AddEntityCollideCallback("Player", "LVL1DogTrigger_1", "LVL1DogSpawn1_4", false, 1);
AddEntityCollideCallback("Player", "LVL1DogTrigger_2", "LVL2DogSpawn5_6", false, 1);
AddEntityCollideCallback("Player", "UpToLVL4", "ChangeAmbstoLVL4", false, 1);
AddEntityCollideCallback("Player", "DownToLVL5", "ChangeAmbstoLVL5", false, 1);
AddEntityCollideCallback("Player", "WaterReaction", "WaterReact", true, 1);
AddEntityCollideCallback("Player", "LVL5WaterScareArea", "LVL5WaterScare", true, 1);
AddTimer("", 0.25f, "BrokenBlinking");
AddTimer("", 0.25f, "ScorchHandler");
AddTimer("", 1.0f, "AddCHP1B");
AddTimer("", 3.0f, "LightBlinksLVL2");
AddTimer("", RandFloat(1.0f, 5.0f), "UndergroundRumbAmb");
AddTimer("", 2.0f, "InfectionHandler");
AddTimer("", 2.0f, "Hallucinations");
AddTimer("", 2.0f, "HeartbeatHandler");
AddTimer("", 1.0f, "HeartbeatTimer");
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", 1.0f, "DebugTimersss");
StopSound("Elev1Noise", 0);
StopSound("Elev2Noise", 0);
StopSound("Elev2ANoise", 0);
StopSound("Elev3Noise", 0);
StopSound("ScorchNoise", 0);
StopSound("ScorchNoiseAmb", 0);
SetMoveObjectStateExt("Elev1DoorTop", -1.0, 5, 5, 0, false);
SetMoveObjectStateExt("Elev2DoorTop", -1.0, 5, 5, 0, false);
SetMoveObjectStateExt("Elev3DoorTop", -1.0, 5, 5, 0, false);
SetMessage("TD_Custom", "KeypadFigureMSG", 5.0f);
SetEntityPlayerInteractCallback("RoobyTouchLight", "RoobyLightSwitch", false);
SetEntityPlayerInteractCallback("RoobyTouchLight2", "RoobyRoomLightSwitch", false);
SetEntityPlayerInteractCallback("RoobyTouchLight3", "RoobyHallwayLightSwitch", false);
SetEntityPlayerInteractCallback("RoobyTouchLight4", "RoobyKitchenLightSwitch", false);
SetEntityInteractionDisabled("ChemoElixir_1", true);
SetEntityInteractionDisabled("bag_small_1", true);
SetEntityInteractionDisabled("bag_small_2", true);
SetEntityInteractionDisabled("bag01_1", true);
SetEntityInteractionDisabled("bag01_2", true);
SetEntityInteractionDisabled("bag01_3", true);
SetEntityInteractionDisabled("bag01_4", true);
SetEntityInteractionDisabled("bag01_5", true);
SetEntityInteractionDisabled("bag01_6", true);
SetEntityInteractionDisabled("bag01_7", true);
SetEntityInteractionDisabled("bag01_8", true);
SetEntityInteractionDisabled("bag01_9", true);
SetEntityInteractionDisabled("MindPiece_1", true);
SetEntityInteractionDisabled("MasterValveLVL1", true);
SetEntityInteractionDisabled("LVL6Candle1", true);
SetEntityInteractionDisabled("LVL6Candle2", true);
SetEntityInteractionDisabled("button_simple_72", true);
SetEntityConnectionStateChangeCallback("MasterValveLVL1", "PowerHandleLVL1");
SetEntityConnectionStateChangeCallback("MasterValveLVL2", "PowerHandleLVL2");
}

void DebugTimer(string &in asTimer)
{
SetLanternDisabled(false);
GiveItemFromFile("", "lantern.ent");
GiveItemFromFile("Sani", "potion_sanity.ent");
GiveItemFromFile("Heal", "potion_health.ent");
GiveItemFromFile("Lockpick", "hollow_needle.ent");
AddTimer("", 1.0f, "DebugOilStoof");
}

void DebugOilStoof(string &in asTimer)
{
if(GetPlayerLampOil() < 100)
{
SetPlayerLampOil(100);
}
if(HasItem("Sani") == false)
{
GiveItemFromFile("Sani", "potion_sanity.ent");
}
if(HasItem("Heal") == false)
{
GiveItemFromFile("Heal", "potion_health.ent");
}
AddTimer("", 2.0f, "DebugOilStoof");
}

void OnEnter()
{
SetLocalVarInt("Keypad1Code", 0);
FadeSepiaColorTo(0.01f, 0.05f);
FadeRadialBlurTo(0.013f, 0.005f);
SetInDarknessEffectsActive(false);
SetSanityDrainDisabled(true);
SetPlayerFallDamageDisabled(true);
PlayMusic("TD_Darkness.ogg", true, 1.0f, 3.0f, 1, false);
PreloadSound("VentLoop.snt");
PreloadSound("SecureClose.snt");
PreloadSound("SecureOpen.snt");
PreloadSound("DPChord.snt");
PreloadSound("TD_Drink.snt");
PreloadSound("puzzle_button.snt");
PreloadSound("scare_whine_loop4.snt");
PreloadSound("MetalBang.snt");
PreloadSound("TD_LadderTrans.snt");
PreloadSound("18_blow_wind.snt");
PreloadSound("18_valve_off.snt");
PreloadSound("TD_DistantBoom.snt");
PreloadSound("TD_Rumb.snt");
PreloadSound("TD_RumbLouder.snt");
PreloadSound("TD_BigBell.snt");
PreloadSound("TD_SpiderScare.snt");
}

void OnLeave()
{
StopMusic(1.0f, 1);
}

void AddCHP1B(string &in asTimer)
{
AddQuest("Chapter1BOnly", "CHP1B");
}

void LockpickChest_1(string &in asItem, string &in asEntity)
{
PlayGuiSound("lock_door.snt", 1);
SetLeverStuckState("Chest_1", 0, true);
RemoveUseItemCallback("LockPick_1");
}

void LockpickChest_2(string &in asItem, string &in asEntity)
{
PlayGuiSound("lock_door.snt", 1);
SetLeverStuckState("Chest_2", 0, true);
RemoveUseItemCallback("LockPick_2");
}

void Press1_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad1Code") == 2)
{
AddLocalVarInt("Keypad1Code", 1);
SetLightVisible("LightButton1_3", true);
}
else
{
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}
}

void Press1_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad1Code") == 3)
{
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", -1);
PlayGuiSound("27_jam.snt", 1);
StartScreenShake(0.1f, 0.5f, 0, 0.5);
SetLightVisible("LightButton1_Dead_1", true);
SetLightVisible("LightButton1_Dead_2", true);
SetLightVisible("LightButton1_Dead_3", true);
SetLightVisible("LightButton1_Dead_4", true);
SetLightVisible("LightButton1_Dead_5", true);
SetLightVisible("LightButton1_Dead_6", true);
SetLightVisible("LightButton1_Dead_7", true);
SetLightVisible("LightButton1_Dead_8", true);
SetLightVisible("LightButton1_Dead_9", true);
SetMessage("TD_Custom", "LVL2DoorBroke", 3.0f);
}
}

void Press1_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad1Code") == 0)
{
AddLocalVarInt("Keypad1Code", 1);
SetLightVisible("LightButton1_1", true);
}
else
{
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}
}

void Press1_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}

void Press1_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}

void Press1_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}

void Press1_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad1Code") == 1)
{
AddLocalVarInt("Keypad1Code", 1);
SetLightVisible("LightButton1_2", true);
}
else
{
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}
}

void Press1_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}

void Press1_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton1_1", false);
SetLightVisible("LightButton1_2", false);
SetLightVisible("LightButton1_3", false);
SetLightVisible("LightButton1_4", false);
SetLocalVarInt("Keypad1Code", 0);
}

void Press2_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 3)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass0to1");
SetLocalVarInt("Keypad2Code", 0);
SetLightVisible("LightButton2_4", true);
}
else
{
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 2)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton2_3", true);
}
else
{
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton2_2", true);
}
else
{
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 0 && GetLocalVarInt("PowerLVL1") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton2_1", true);
}
else
{
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton2_2", true);
}
else
{
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2B_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 3)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass1to0");
SetLocalVarInt("Keypad2Code", 0);
SetLightVisible("LightButton3_4", true);
}
else
{
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2B_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 2)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton3_3", true);
}
else
{
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2B_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2B_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton3_2", true);
}
else
{
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2B_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 0 && GetLocalVarInt("PowerLVL1") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton3_1", true);
}
else
{
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2B_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2B_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton3_2", true);
}
else
{
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2B_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2B_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2C_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 3)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass1to2");
SetLocalVarInt("Keypad2Code", 0);
SetLightVisible("LightButton4_4", true);
}
else
{
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2C_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 2)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton4_3", true);
}
else
{
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2C_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2C_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton4_2", true);
}
else
{
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2C_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 0 && GetLocalVarInt("PowerLVL1") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton4_1", true);
}
else
{
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2C_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2C_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton4_2", true);
}
else
{
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2C_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2C_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2D_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 3)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass2to1");
SetLocalVarInt("Keypad2Code", 0);
SetLightVisible("LightButton5_4", true);
}
else
{
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2D_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 2)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton5_3", true);
}
else
{
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2D_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2D_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton5_2", true);
}
else
{
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2D_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 0 && GetLocalVarInt("PowerLVL1") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton5_1", true);
}
else
{
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2D_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2D_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad2Code") == 1)
{
AddLocalVarInt("Keypad2Code", 1);
SetLightVisible("LightButton5_2", true);
}
else
{
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}
}

void Press2D_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press2D_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
SetLocalVarInt("Keypad2Code", 0);
}

void Press3A_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3A_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 0 && GetLocalVarInt("PowerLVL3") == 1)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_1", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3A_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3A_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 3)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_4", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3A_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 1)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_2", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3A_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 4)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass2to3");
SetLocalVarInt("Keypad3Code", 0);
SetLightVisible("LightButton6_5", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3A_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3A_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 2)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_3", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3A_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3B_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3B_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 0 && GetLocalVarInt("PowerLVL3") == 1)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_1", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3B_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3B_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 3)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_5", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3B_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 1)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_2", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3B_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 4)
{
SetPlayerActive(false);
FadeOut(0.5f);
PlayGuiSound("SecureOpen.snt", 1);
AddTimer("", 1.5f, "Pass3to2");
SetLocalVarInt("Keypad3Code", 0);
SetLightVisible("LightButton6_4", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3B_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Press3B_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad3Code") == 2)
{
AddLocalVarInt("Keypad3Code", 1);
SetLightVisible("LightButton6_3", true);
}
else
{
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}
}

void Press3B_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
SetLocalVarInt("Keypad3Code", 0);
}

void Pass0to1(string &in asTimer)
{
TeleportPlayer("CheckPoint1Forward");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
}

void Pass1to0(string &in asTimer)
{
TeleportPlayer("CheckPoint1Back");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
}

void Pass1to2(string &in asTimer)
{
TeleportPlayer("CheckPoint1Forward2");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
}

void Pass2to1(string &in asTimer)
{
TeleportPlayer("CheckPoint1Back2");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
}

void Pass2to3(string &in asTimer)
{
TeleportPlayer("CheckPoint3Forward");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
if(GetLocalVarInt("IsBeingBruted") == 1)
{
AddEntityCollideCallback("ChaseBrute", "LVL3BruteScareEnder", "DisappearBrute", true, 1);
}
}

void Pass3to2(string &in asTimer)
{
TeleportPlayer("CheckPoint3Back");
SetPlayerActive(true);
FadeIn(1.0f);
PlayGuiSound("SecureClose.snt", 1);
SetLightVisible("LightButton6_1", false);
SetLightVisible("LightButton6_2", false);
SetLightVisible("LightButton6_3", false);
SetLightVisible("LightButton6_4", false);
SetLightVisible("LightButton6_5", false);
}

void BrokenBlinking(string &in asTimer)
{
SetLampLit("HallwayLight0_Broken", false, true);
SetLampLit("HallwayLight1_Broken", false, true);
SetLampLit("Elevator2Light_Broken", false, true);
SetLampLit("HallwayLight1_Shorted", false, false);
SetLampLit("LVL4MasterLight", false, true);
AddTimer("", RandFloat(0.0f, 2.5f), "BrokenBlinking2");
}

void BrokenBlinking2(string &in asTimer)
{
SetLampLit("HallwayLight0_Broken", true, false);
SetLampLit("HallwayLight1_Broken", true, false);
SetLampLit("Elevator2Light_Broken", true, false);
SetLampLit("HallwayLight1_Shorted", true, false);
SetLampLit("LVL4MasterLight", true, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "HallwayLight0_Broken", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "HallwayLight1_Broken", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "Elevator2Light_Broken", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "HallwayLight1_Shorted", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "LVL4MasterLight", 0, false);
AddTimer("", 0.1f, "BrokenBlinking");
}

void Elev1MoveUp(string &in asEntity, int alState)
{
if(alState == -1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev1DoorBottom", 0.0, 0.75, 1, 0, false);
SetMoveObjectStateExt("Elev1", -12.0, 1, 1.5, 0, false);
AddEntityCollideCallback("Elev1", "Elev1StopTop", "Elev1StopUp", false, 1);
FadeInSound("Elev1Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
}
}

void Elev1MoveDown(string &in asEntity, int alState)
{
if(alState == 1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev1DoorTop", 0.1, 0.25, 1, 0, false);
SetMoveObjectStateExt("Elev1", 15.0, 0.5, 1.5, 0, false);
AddEntityCollideCallback("Elev1", "Elev1StopBottom", "Elev1StopDown", false, 1);
FadeInSound("Elev1Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
}
}

void Elev1StopUp(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev1");
SetLeverStuckState("Elev1TopLever", 0, true);
SetMoveObjectStateExt("Elev1DoorTop", -1.0, 0.25, 1, 0, false);
StopSound("Elev1Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev1StopDown(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev1");
SetLeverStuckState("Elev1BottomLever", 0, true);
SetMoveObjectStateExt("Elev1DoorBottom", -1.0, 0.25, 2, 0, false);
StopSound("Elev1Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev2MoveUp(string &in asEntity, int alState)
{
if(alState == -1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev2DoorBottom", 0.0, 0.75, 1, 0, false);
SetMoveObjectStateExt("Elev2", -12.0, 1, 1.5, 0, false);
AddEntityCollideCallback("Elev2", "Elev2StopTop", "Elev2StopUp", false, 1);
FadeInSound("Elev2Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 1);
}
}

void Elev2MoveDown(string &in asEntity, int alState)
{
if(alState == 1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev2DoorTop", 0.1, 0.25, 1, 0, false);
SetMoveObjectStateExt("Elev2", 15.0, 0.5, 1.5, 0, false);
AddEntityCollideCallback("Elev2", "Elev2StopBottom", "Elev2StopDown", false, 1);
FadeInSound("Elev2Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 2);
}
}

void Elev2StopUp(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev2");
SetLeverStuckState("Elev2TopLever", 0, true);
SetMoveObjectStateExt("Elev2DoorTop", -1.0, 0.25, 1, 0, false);
StopSound("Elev2Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev2StopDown(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev2");
SetLeverStuckState("Elev2BottomLever", 0, true);
SetMoveObjectStateExt("Elev2DoorBottom", -1.0, 0.25, 2, 0, false);
StopSound("Elev2Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev3MoveUp(string &in asEntity, int alState)
{
if(alState == -1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev3DoorBottom", 0.0, 0.75, 1, 0, false);
SetMoveObjectStateExt("Elev3", -12.0, 1, 1.5, 0, false);
AddEntityCollideCallback("Elev3", "Elev3StopTop", "Elev3StopUp", false, 1);
FadeInSound("Elev3Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 2);
}
}

void Elev3MoveDown(string &in asEntity, int alState)
{
if(alState == 1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev3DoorTop", 0.1, 0.25, 1, 0, false);
SetMoveObjectStateExt("Elev3", 15.0, 0.5, 1.5, 0, false);
AddEntityCollideCallback("Elev3", "Elev3StopBottom", "Elev3StopDown", false, 1);
FadeInSound("Elev3Noise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 3);
}
}

void Elev3StopUp(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev3");
SetLeverStuckState("Elev3TopLever", 0, true);
SetMoveObjectStateExt("Elev3DoorTop", -1.0, 0.25, 1, 0, false);
StopSound("Elev3Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev3StopDown(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev3");
SetLeverStuckState("Elev3BottomLever", 0, true);
SetMoveObjectStateExt("Elev3DoorBottom", -1.0, 0.25, 2, 0, false);
StopSound("Elev3Noise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void Elev2AMoveUp(string &in asEntity, int alState)
{
if(alState == -1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev2ADoorBottom", 0.0, 0.75, 1, 0, false);
SetMoveObjectStateExt("Elev2A", -12.0, 1, 1.5, 0, false);
AddEntityCollideCallback("Elev2A", "Elev2AStopTop", "Elev2AStopUp", false, 1);
FadeInSound("Elev2ANoise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 1);
if(HasItem("ResPro") == false)
{
AddTimer("", 5.0f, "ScorchWarning");
}
}
}

void Elev2AMoveDown(string &in asEntity, int alState)
{
if(alState == 1)
{
SetLeverStuckState(asEntity, alState, true);
SetMoveObjectStateExt("Elev2ADoorTop", 0.1, 0.25, 1, 0, false);
SetMoveObjectStateExt("Elev2A", 15.0, 0.5, 1.5, 0, false);
AddEntityCollideCallback("Elev2A", "Elev2AStopBottom", "Elev2AStopDown", false, 1);
FadeInSound("Elev2ANoise", 0.5f, false);
PlayGuiSound("14_elevator_clank.snt", 1);
SetPlayerRunSpeedMul(0.0f);
SetPlayerMoveSpeedMul(0.0f);
SetLocalVarInt("PlayerOnLVL", 2);
StopSound("ScorchNoiseAmb", 10);
if(HasItem("ResPro") == false)
{
AddTimer("", 5.0f, "ScorchWarning2");
}
}
}

void Elev2AStopUp(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev2A");
SetLeverStuckState("Elev2ATopLever", 0, true);
StopSound("Elev2ANoise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
FadeInSound("ScorchNoiseAmb", 10.0f, true);
}

void Elev2AStopDown(string &in asParent, string &in asChild, int alState)
{
StopPropMovement("Elev2A");
SetLeverStuckState("Elev2ABottomLever", 0, true);
StopSound("Elev2ANoise", 0);
PlayGuiSound("14_elevator_activate.snt", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
}

void HouseTrigger(string &in asTimer)
{
PlayGuiSound("scare_whine_loop4.snt", 1);
FadeRadialBlurTo(0.04f, 0.02f);
SetLocalVarInt("ElixirState", 0);
SetPlayerRunSpeedMul(0.4);
SetPlayerMoveSpeedMul(0.4);
AddTimer("", 4.0f, "HouseTrigger1");
}

void HouseTrigger1(string &in asTimer)
{
FadeOut(0.25f);
SetPlayerCrouching(true);
SetPlayerActive(false);
PlayGuiSound("player_bodyfall.snt", 1);
FadeSepiaColorTo(0.7f, 0.5f);
FadePlayerRollTo(-10, 8.2f, 8.2f);
StopMusic(2.0f, 1);
SetPlayerRunSpeedMul(1.0);
SetPlayerMoveSpeedMul(1.0);
AddTimer("", 4.0f, "HouseTrigger2");
}

void HouseTrigger2(string &in asTimer)
{
TeleportPlayer("HouseSpawn");
SetPlayerCrouching(false);
PlayMusic("TD_Weirdscape.ogg", true, 1.0f, 3.0f, 2, false);
FadeIn(3.0f);
SetPlayerActive(true);
FadeRadialBlurTo(0.013f, 0.005f);
FadePlayerRollTo(0, 2.2f, 2.2f);
AddTimer("", RandFloat(30.0f, 90.0f), "HouseTriggerEnd");
}

void HouseTriggerEnd(string &in asTimer)
{
int RandChance = RandInt(1, 10);
if(RandChance == 1)
{
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
PlayGuiSound("enemy_dog_investigate.snt", 1);
GivePlayerDamage(200, "Claws", false, true);
}
else
{
FadeOut(0.25f);
SetLocalVarInt("Dreaming", 2);
SetPlayerCrouching(true);
SetPlayerActive(false);
PlayGuiSound("player_bodyfall.snt", 1);
FadeSepiaColorTo(0.7f, 0.5f);
FadePlayerRollTo(-10, 8.2f, 8.2f);
StopMusic(2.0f, 2);
AddTimer("", 4.0f, "HouseTriggerEnd2");
}
}

void HouseTriggerEnd2(string &in asTimer)
{
TeleportPlayer("CheckPoint1Back");
SetPlayerCrouching(false);
PlayMusic("TD_Darkness.ogg", true, 1.0f, 3.0f, 1, false);
FadeIn(3.0f);
SetPlayerActive(true);
FadeRadialBlurTo(0.013f, 0.005f);
FadePlayerRollTo(0, 2.2f, 2.2f);
FadeSepiaColorTo(0.01f, 0.05f);
SetGlobalVarInt("Achiev3", 1);
SetMessage("TD_Custom", "HouseEventOver", 6.0f);
}

void RoobyLightSwitch(string &in asEntity)
{
if(GetLocalVarInt("RoobyLightOn") == 0)
{
SetLampLit("RoobyLight", true, false);
PlayGuiSound("puzzle_button.snt", 1);
SetLocalVarInt("RoobyLightOn", 1);
return;
}
if(GetLocalVarInt("RoobyLightOn") == 1)
{
SetLampLit("RoobyLight", false, false);
PlayGuiSound("puzzle_button.snt", 1);
SetLocalVarInt("RoobyLightOn", 0);
return;
}
}

void RoobyRoomLightSwitch(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("RoobyRoomLightOn") == 0)
{
AddTimer("", 1.5f, "RoobyRoomLightActivate");
SetEntityInteractionDisabled(asEntity, true);
}
else
{
SetLampLit("RoobyRoomLight", false, false);
SetLocalVarInt("RoobyRoomLightOn", 0);
}
}

void RoobyRoomLightActivate(string &in asTimer)
{
SetLampLit("RoobyRoomLight", true, false);
int RandChance = RandInt(1, 8);
if(RandChance == 1)
{
SetLocalVarInt("RoobyRoomLightOn", 1);
}
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyRoomLight", 0, false);
AddTimer("", 0.05f, "RoobyRoomLightActivate2");
}

void RoobyRoomLightActivate2(string &in asTimer)
{
SetLampLit("RoobyRoomLight", false, false);
if(GetLocalVarInt("RoobyRoomLightOn") == 1)
{
AddTimer("", 0.2f, "RoobyRoomLightActivateFinal");
}
else
{
AddTimer("", RandFloat(0.1f, 0.2f), "RoobyRoomLightActivate");
}
}

void RoobyRoomLightActivateFinal(string &in asTimer)
{
SetLampLit("RoobyRoomLight", true, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyRoomLight", 0, false);
SetEntityInteractionDisabled("RoobyTouchLight2", false);
}

void RoobyHallwayLightSwitch(string &in asEntity)
{
if(GetLocalVarInt("RoobyHallwayLightOn") == 0)
{
SetEntityInteractionDisabled(asEntity, true);
PlayGuiSound("puzzle_button.snt", 1);
SetEntityActive("RoobyHallwayLight_2", false);
SetEntityActive("RoobyHallwayLight_2UR", true);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyHallwayLight_1", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyHallwayLight_2", 0, false);
SetLampLit("RoobyHallwayLight_2UR", true, false);
SetLampLit("RoobyHallwayLight_1", true, false);
SetLocalVarInt("RoobyHallwayLightOn", 1);
AddTimer("", RandFloat(0.8f, 3.0f), "RoobyHallwayLightFinish");
}
else
{
PlayGuiSound("puzzle_button.snt", 1);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyHallwayLight_1", 0, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyHallwayLight_2", 0, false);
SetLampLit("RoobyHallwayLight_1", false, false);
SetLampLit("RoobyHallwayLight_2", false, true);
SetLocalVarInt("RoobyHallwayLightOn", 0);
}
}


void RoobyHallwayLightFinish(string &in asTimer)
{
SetEntityActive("RoobyHallwayLight_2UR", false);
SetLampLit("RoobyHallwayLight_2UR", false, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyHallwayLight_2", 0, false);
SetEntityActive("RoobyHallwayLight_2", true);
SetLampLit("RoobyHallwayLight_2", true, false);
SetEntityInteractionDisabled("RoobyTouchLight3", false);
}

void RoobyKitchenLightSwitch(string &in asEntity)
{
if(GetLocalVarInt("RoobyKitchenLightOn") == 0)
{
PlayGuiSound("puzzle_button.snt", 1);
SetLampLit("RoobyKitchenLight", true, true);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyKitchenLight", 0, false);
SetLocalVarInt("RoobyKitchenLightOn", 1);
}
else
{
PlayGuiSound("puzzle_button.snt", 1);
PlaySoundAtEntity("", "lm_light_flicker.snt", "RoobyKitchenLight", 0, false);
SetLampLit("RoobyKitchenLight", false, true);
SetLocalVarInt("RoobyKitchenLightOn", 0);
}
}

void PCMSG(string &in asEntity)
{
SetMessage("TD_Custom", "RoobyPC", 3.0f);
AddTimer("", 0.25f, "GivePointTimer");
}

void GivePointFX(string &in asTimer)
{
PlayGuiSound("DPChord.snt", 1.0f);
FadeIn(6.0f);
}

void GivePointTimer(string &in asTimer)
{
AddGlobalVarInt("DreamPoint", 1);
FadeOut(0.1f);
AddTimer("", 0.1f, "GivePointFX");
}

void DoorScareTrigger(string &in asParent, string &in asChild, int alState)
{
PlayGuiSound("MetalBang.snt", 1.3f);
PlayGuiSound("outside_howl.snt", 1);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
CreateParticleSystemAtEntity("", "ps_hit_metal.ps", "DoorScareBangHere", false);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetLampLit("HallwayLight1_4", false, false);
SetLampLit("HallwayLight1_4", true, true);
}

void DeathByBrute(string &in asName, int alCount)
{
SetupLoadScreen("TD_Custom", "LVLDeadScreen", 1, "");
SetGlobalVarInt("DeathType", 5);
ChangeMap("Dead.map", "Death", "", "DeadEnter.snt");
}

void DeathByDog(string &in asName, int alCount)
{
SetupLoadScreen("TD_Custom", "LVLDeadScreen", 1, "");
SetGlobalVarInt("DeathType", 2);
ChangeMap("Dead.map", "Death", "", "DeadEnter.snt");
}

void DeathByChem(string &in asName, int alCount)
{
SetupLoadScreen("TD_Custom", "LVLDeadScreen", 1, "");
SetGlobalVarInt("DeathType", 3);
ChangeMap("Dead.map", "Death", "", "DeadEnter.snt");
}

void DeathByScorch(string &in asName, int alCount)
{
SetupLoadScreen("TD_Custom", "LVLDeadScreen", 1, "");
SetGlobalVarInt("DeathType", 4);
ChangeMap("Dead.map", "Death", "", "DeadEnter.snt");
}

void ElixirUse(string &in asEntity)
{
if(GetLocalVarInt("ElixirDiscover") == 0)
{
SetMessage("TD_Custom", "ElixirUnknown" + RandInt(1, 3), 3.0f);
}
if(GetLocalVarInt("ElixirDiscover") == 3)
{
SetMessage("TD_Custom", "ElixirAlreadyUsed", 3.0f);
}
if(GetLocalVarInt("ElixirDiscover") == 2)
{
SetMessage("TD_Custom", "ElixirAlreadyUsed2", 3.0f);
}
if(GetLocalVarInt("ElixirDiscover") == 1)
{
SetPlayerActive(false);
SetLocalVarInt("Infected", 0);
StartPlayerLookAt(asEntity, 5, 10, "");
SetEntityActive("ChemoElixir_1", false);
PlayGuiSound("pick_generic.snt", 1);
ShowPlayerCrossHairIcons(false);
SetLocalVarInt("ElixirDiscover", 3);
if(GetLocalVarInt("ElixirState") >= 60 && GetLocalVarInt("Dreaming") == 0)
{
AddTimer("", 4.75f, "HouseTrigger");
SetLocalVarInt("Dreaming", 1);
}
if(GetLocalVarInt("ElixirState") > 240)
{
SetLocalVarInt("ElixirState", 240);
}
AddTimer("", 0.75f, "BeginDrinkElixir");
}
}

void ElixirUse2(string &in asEntity)
{
if(GetLocalVarInt("ElixirDiscover") == 0)
{
SetMessage("TD_Custom", "ElixirUnknown" + RandInt(1, 3), 3.0f);
}
if(GetLocalVarInt("ElixirDiscover") == 3)
{
SetMessage("TD_Custom", "ElixirAlreadyUsed", 3.0f);
}
if(GetLocalVarInt("ElixirDiscover") == 1)
{
SetPlayerActive(false);
SetLocalVarInt("Infected", 0);
StartPlayerLookAt(asEntity, 5, 10, "");
SetEntityActive("ChemoElixir_2", false);
PlayGuiSound("pick_generic.snt", 1);
ShowPlayerCrossHairIcons(false);
SetLocalVarInt("ElixirDiscover", 3);
if(GetLocalVarInt("ElixirState") > 240)
{
SetLocalVarInt("ElixirState", 240);
}
AddTimer("", 0.75f, "BeginDrinkElixir");
}
}

void BeginDrinkElixir(string &in asTimer)
{
PlayGuiSound("TD_Drink.snt", 1);
SetPlayerHealth(20);
AddTimer("", 2.25f, "PutElixirDown");
}

void PutElixirDown(string &in asTimer)
{
if(GetLocalVarInt("ElixirState") == 0)
{
SetLocalVarInt("ElixirState", 240);
AddTimer("", 60.0f, "ElixirHandler");
}
PlayGuiSound("impact_generic_soft_low.snt", 1);
PlayGuiSound("impact_generic_soft_low.snt", 1);
PlayGuiSound("impact_generic_soft_low.snt", 1);
PlayGuiSound("impact_generic_soft_low.snt", 1);
ShowPlayerCrossHairIcons(true);
SetPlayerActive(true);
StopPlayerLookAt();
SetPlayerHealth(100);
SetEntityActive("ChemoElixir_1", true);
SetEntityActive("ChemoElixir_2", true);
SetPlayerMoveSpeedMul(1.0f);
SetPlayerRunSpeedMul(1.0f);
SetPlayerLookSpeedMul(1.0f);
FadeRadialBlurTo(0.013f, 0.005f);
FadeSepiaColorTo(0.01f, 0.05f);
FadeImageTrailTo(0.0f, 0.05f);
AddTimer("", 60.0f, "ElixirAvailable2");
}

void ElixirAvailable2(string &in asTimer)
{
SetLocalVarInt("ElixirDiscover", 1);
}

void ElixirHandler(string &in asTimer)
{
if(GetLocalVarInt("ElixirState") > 0)
{
AddLocalVarInt("ElixirState", -60);
AddTimer("", 60.0f, "ElixirHandler");
}
}

void InfectionHandler(string &in asTimer)
{
if(GetLocalVarInt("ElixirState") > 0)
{
SetLocalVarInt("Infected", 0);
SetEntityActive("InfectBlocker", false);
}
if(GetLocalVarInt("Infected") == 1)
{
AddLocalVarInt("InfProgress", 5);
SetEntityActive("InfectBlocker", true);
if(GetLocalVarInt("InfProgress") == 10)
{
FadeRadialBlurTo(0.026f, 0.005f);
}
if(GetLocalVarInt("InfProgress") == 20)
{
SetMessage("TD_Custom", "InfPhase1", 3.0f);
FadeSepiaColorTo(0.15f, 0.05f);
}
if(GetLocalVarInt("InfProgress") == 40)
{
SetMessage("TD_Custom", "InfPhase2", 3.0f);
AddTimer("", 1.0f, "Hallucinations");
FadeSepiaColorTo(0.45f, 0.05f);
FadeRadialBlurTo(0.039f, 0.005f);
}
if(GetLocalVarInt("InfProgress") == 60)
{
SetMessage("TD_Custom", "InfPhase3", 3.0f);
AddTimer("", 1.0f, "HeartbeatHandler");
FadeSepiaColorTo(0.7f, 0.05f);
FadeRadialBlurTo(0.045f, 0.005f);
FadeImageTrailTo(0.1f, 0.05f);
SetPlayerMoveSpeedMul(0.9f);
SetPlayerRunSpeedMul(0.9f);
SetPlayerLookSpeedMul(0.9f);
}
if(GetLocalVarInt("InfProgress") == 80)
{
SetMessage("TD_Custom", "InfPhase4", 3.0f);
FadeSepiaColorTo(0.7f, 0.05f);
FadeRadialBlurTo(0.045f, 0.005f);
FadeImageTrailTo(0.1f, 0.05f);
SetPlayerMoveSpeedMul(0.75f);
SetPlayerRunSpeedMul(0.75f);
SetPlayerLookSpeedMul(0.75f);
}
if(GetPlayerHealth() < 20 && GetLocalVarInt("Infected") == 1 && GetLocalVarInt("InfProgress") > 80)
{
SetLocalVarInt("Infected", 0);
CheckPoint("", "Start", "DeathByChem", "TD_Custom", "GO");
SetPlayerHealth(-5);
}
AddTimer("", 20.0f, "InfectionHandler");
}
AddDebugMessage("Infection at: " + GetLocalVarInt("InfProgress") + "%", false);
}

void Hallucinations(string &in asTimer)
{
if(GetLocalVarInt("InfProgress") >= 30 && GetLocalVarInt("InfProgress") < 50 && GetLocalVarInt("Infected") == 1)
{
PlayGuiSound("scare_loon.snt", 0.1f);
AddTimer("", RandFloat(3.0f, 30.0f), "Hallucinations");
}
if(GetLocalVarInt("InfProgress") >= 50 && GetLocalVarInt("Infected") == 1)
{
AddTimer("", RandFloat(1.0f, 10.0f), "Hallucinations");
int RandChance = RandInt(1, 4);
if(RandChance == 1)
{
PlayGuiSound("scare_steps_big.snt", 0.6f);
}
if(RandChance == 2)
{
PlayGuiSound("scare_animal_squeal.snt", 0.6f);
}
if(RandChance == 3)
{
PlayGuiSound("outside_howl.snt", 0.1f);
int RandChance2 = RandInt(1, 10);
if(RandChance2 == 1)
{
StartInsanityEvent("Stream_Monster_Roar0" + RandInt(1, 3));
}
}
if(RandChance == 4)
{
PlayGuiSound("scare_wall_crawl_single.snt", 1.0f);
}
}
}

void HeartbeatHandler(string &in asTimer)
{
if(GetLocalVarInt("InfProgress") >= 45 && GetLocalVarInt("InfProgress") < 60 && GetLocalVarInt("Infected") == 1)
{
PlayGuiSound("sanity_heartbeat.snt", 0.25f);
AddTimer("", RandFloat(1.0f, 3.0f), "HeartbeatHandler");
}
if(GetLocalVarInt("InfProgress") >= 60 && GetLocalVarInt("InfProgress") < 70 && GetLocalVarInt("Infected") == 1)
{
PlayGuiSound("sanity_heartbeat.snt", 0.5f);
AddTimer("", RandFloat(0.75f, 2.0f), "HeartbeatHandler");
}
if(GetLocalVarInt("InfProgress") >= 70 && GetLocalVarInt("Infected") == 1)
{
PlayGuiSound("sanity_heartbeat.snt", 1.0f);
int RandChance = RandInt(1, 3);
if(RandChance == 1)
{
PlayGuiSound("player_cough.snt", 1.0f);
GivePlayerDamage(RandFloat(1, 12), "Splat", true, false);
}
AddTimer("", RandFloat(0.6f, 1.5f), "HeartbeatHandler");
}
}

void DiscoverElixir(string &in asEntity)
{
SetLocalVarInt("ElixirDiscover", 1);
}

void DogScareLanternPrep(string &in asParent, string &in asChild, int alState)
{
if(GetPlayerLampOil() >= 0 && GetPlayerLampOil() < 1)
{
SetMessage("TD_Custom", "TooDark", 4.0f);
}
if(GetPlayerLampOil() >= 1)
{
SetLanternDisabled(false);
SetEntityActive("block_box_1", false);
SetEntityActive("TriggerDogWalk", false);
SetEntityActive("CinematicDog", true);
AddEnemyPatrolNode("CinematicDog", "PathNodeArea_11", 0, "");
SetEnemySanityDecreaseActive("CinematicDog", false);
PlayMusic("05_event_falling.ogg", false, 1.0f, 1.0f, 2, false);
SetLampLit("HallwayLight2_2", true, true);
}
}

void DogDisappear(string &in asParent, string &in asChild, int alState)
{
SetEntityActive(asParent, false);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
SetLightVisible("DogDisappearLight", true);
FadeLightTo("DogDisappearLight", 0, 0, 0, 0, 0, 2);
ReplaceEntity(asParent, "", "", "potion_sanity.ent", false);
SetEntityActive("CineBlocker", false);
SetLampLit("HallwayLight2_1", true, false);
SetLampLit("HallwayLight2_1", false, true);
SetLampLit("HallwayLight2_2", false, true);
PlayGuiSound("12_valve_stuck.snt", 1);
SetMessage("TD_Custom", "DogSeen", 4.0f);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetEntityInteractionDisabled("MasterValveLVL1", false);
AddTimer("", RandFloat(6.0f, 30.0f), "AddCHP1B_1");
}

void AddCHP1B_1(string &in asTimer)
{
AddQuest("Chapter1BOnly1", "CHP1B_1");
}

void PowerHandleLVL1(string &in asEntity, int alState)
{
if(alState == 1 && GetLocalVarInt("PowerLVL1") == 1)
{
SetEntityInteractionDisabled("MasterValveLVL1", true);
SetLocalVarInt("PowerLVL1", 0);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
StopSound("LVL1SteamAmb", 1);
StopSound("LVL1SteamAmb2", 1);
SetLocalVarInt("Keypad2Code", 0);
SetLightVisible("LightButton2_1", false);
SetLightVisible("LightButton2_2", false);
SetLightVisible("LightButton2_3", false);
SetLightVisible("LightButton2_4", false);
SetLightVisible("LightButton3_1", false);
SetLightVisible("LightButton3_2", false);
SetLightVisible("LightButton3_3", false);
SetLightVisible("LightButton3_4", false);
SetLightVisible("LightButton4_1", false);
SetLightVisible("LightButton4_2", false);
SetLightVisible("LightButton4_3", false);
SetLightVisible("LightButton4_4", false);
SetLightVisible("LightButton5_1", false);
SetLightVisible("LightButton5_2", false);
SetLightVisible("LightButton5_3", false);
SetLightVisible("LightButton5_4", false);
AddTimer("", 2.0f, "LVL1LightsOff");
DestroyParticleSystem("LVL1SteamPS1");
}
if(alState == -1 && GetLocalVarInt("PowerLVL1") == 0)
{
SetEntityInteractionDisabled("MasterValveLVL1", true);
SetLocalVarInt("PowerLVL1", 1);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
PlayGuiSound("18_flow_done.snt", 1);
FadeInSound("LVL1SteamAmb", 3.0f, true);
FadeInSound("LVL1SteamAmb2", 3.0f, true);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
AddTimer("", 2.0f, "LVL1LightsOn");
CreateParticleSystemAtEntityExt("LVL1SteamPS1", "ps_steam.ps", "LVL1SteamArea1", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
}
}

void PowerHandleLVL2(string &in asEntity, int alState)
{
if(alState == 1 && GetLocalVarInt("PowerLVL2") == -1)
{
SetLocalVarInt("PowerLVL2", 0);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
StopSound("LVL2SteamAmb", 1);
StopSound("LVL2SteamAmb2", 1);
StopSound("LVL2BrokenSteamSound", 1);
DestroyParticleSystem("LVL2SteamPS1");
DestroyParticleSystem("LVL2SteamPS2");
DestroyParticleSystem("LVL2SteamPS3");
DestroyParticleSystem("LVL2SteamPS4");
DestroyParticleSystem("LVL2SteamPS5");
DestroyParticleSystem("LVL2SteamPS6");
DestroyParticleSystem("LVL2SteamPS7");
DestroyParticleSystem("LVL2SteamPS8");
DestroyParticleSystem("LVL2SteamPS9");
DestroyParticleSystem("LVL2SteamPS10");
DestroyParticleSystem("LVL2SteamPS11");
DestroyParticleSystem("LVL2SteamPS12");
DestroyParticleSystem("LVL2SteamPS13");
DestroyParticleSystem("LVL2SteamPS14");
}
if(alState == 1 && GetLocalVarInt("PowerLVL2") == 1)
{
SetLocalVarInt("PowerLVL2", 0);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
StopSound("LVL2SteamAmb", 1);
StopSound("LVL2SteamAmb2", 1);
SetLampLit("LVL2MasterLight", false, false);
AddTimer("", 2.0f, "LVL2LightsOff");
}
if(alState == -1 && GetLocalVarInt("PowerLVL2") == 0)
{
if(GetLocalVarInt("LVL2PipesFixed") == 0)
{
SetLocalVarInt("PowerLVL2", -1);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
FadeInSound("LVL2SteamAmb", 1, true);
FadeInSound("LVL2SteamAmb2", 1, true);
FadeInSound("LVL2BrokenSteamSound", 1, true);
CreateParticleSystemAtEntityExt("LVL1SteamPS1", "ps_steam.ps", "LVL1SteamArea1", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS1", "ps_steam.ps", "BrokenPipeFlow", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS2", "ps_steam.ps", "BrokenPipeFlow", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS3", "ps_steam.ps", "BrokenPipeFlow2", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS4", "ps_steam.ps", "BrokenPipeFlow2", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS5", "ps_steam.ps", "BrokenPipeFlow3", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS6", "ps_steam.ps", "BrokenPipeFlow4", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS7", "ps_steam_cloud.ps", "BrokenSteamCloud_1", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS8", "ps_steam_cloud.ps", "BrokenSteamCloud_2", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS9", "ps_steam_cloud.ps", "BrokenSteamCloud_3", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS10", "ps_steam_cloud.ps", "BrokenSteamCloud_4", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS11", "ps_steam_cloud.ps", "BrokenSteamCloud_5", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS12", "ps_steam_cloud.ps", "BrokenSteamCloud_6", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS13", "ps_steam_cloud.ps", "BrokenSteamCloud_7", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
CreateParticleSystemAtEntityExt("LVL2SteamPS14", "ps_steam_cloud.ps", "BrokenSteamCloud_8", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
}
if(GetLocalVarInt("LVL2PipesFixed") == 1)
{
SetLocalVarInt("PowerLVL2", 1);
PlayGuiSound("18_blow_wind.snt", 1);
PlayGuiSound("18_valve_off.snt", 1);
StartScreenShake(0.01f, 2.0f, 0.5, 2.5);
FadeInSound("LVL2SteamAmb", 1, true);
FadeInSound("LVL2SteamAmb2", 1, true);
if(QuestIsAdded("Chapter1BOnly1") == true)
{
CompleteQuest("Chapter1BOnly1", "CHP1B_1");
}
SetEntityInteractionDisabled("MasterValveLVL2", true);
SetGlobalVarInt("Achiev5", 1);
AddTimer("", 2.0f, "LVL2LightsOn");
SetLampLit("LVL2MasterLight", true, false);
}
}
}

void LVL1LightsOff(string &in asTimer)
{
SetLampLit("LVL1MasterLight", false, false);
SetLampLit("HallwayLight1_1", false, false);
SetLampLit("HallwayLight1_2", false, false);
SetLampLit("HallwayLight1_3", false, false);
SetLampLit("HallwayLight1_4", false, false);
SetLampLit("HallwayLight1_5", false, false);
SetLampLit("HallwayLight1_6", false, false);
SetLampLit("HallwayLight1_7", false, false);
SetLampLit("HallwayLight1_8", false, false);
SetLampLit("HallwayLight1_9", false, false);
SetLampLit("HallwayLight1_10", false, false);
SetLampLit("HallwayLight1_11", false, false);
SetLampLit("HallwayLight1_12", false, false);
SetLampLit("HallwayLight1_13", false, false);
SetLampLit("HallwayLight1_14", false, false);
SetLampLit("HallwayLight1_15", false, false);
SetLampLit("HallwayLight1_16", false, false);
SetLampLit("HallwayLight1_17", false, false);
SetLampLit("HallwayLight1_18", false, false);
SetLampLit("HallwayLight1_19", false, false);
SetLampLit("HallwayLight1_20", false, false);
SetLampLit("HallwayLight1_21", false, false);
SetLampLit("HallwayLight1_22", false, false);
SetLampLit("HallwayLight1_23", false, false);
SetLampLit("HallwayLight1_24", false, false);
SetLampLit("HallwayLight1_25", false, false);
SetLampLit("HallwayLight1_26", false, false);
SetLampLit("HallwayLight1_27", false, false);
SetLampLit("Keypad2Light_1", false, false);
SetLampLit("Keypad2Light_2", false, false);
SetLampLit("Keypad3Light_1", false, false);
SetLampLit("Keypad3Light_2", false, false);
SetLightVisible("LVL1BigLight_1", false);
PlayGuiSound("lm_light_flicker.snt", 1);
SetEntityActive("CheckPoint1DoorPowered", false);
SetEntityActive("CheckPoint1DoorPowered2", false);
SetEntityActive("CheckPoint1DoorUnpowered", true);
SetEntityActive("CheckPoint1DoorUnpowered2", true);
SetEntityInteractionDisabled("MasterValveLVL1", false);
}

void LVL1LightsOn(string &in asTimer)
{
SetLampLit("LVL1MasterLight", true, false);
SetLampLit("HallwayLight1_1", true, false);
SetLampLit("HallwayLight1_2", true, false);
SetLampLit("HallwayLight1_3", true, false);
SetLampLit("HallwayLight1_4", true, false);
SetLampLit("HallwayLight1_5", true, false);
SetLampLit("HallwayLight1_6", true, false);
SetLampLit("HallwayLight1_7", true, false);
SetLampLit("HallwayLight1_8", true, false);
SetLampLit("HallwayLight1_9", true, false);
SetLampLit("HallwayLight1_10", true, false);
SetLampLit("HallwayLight1_11", true, false);
SetLampLit("HallwayLight1_12", true, false);
SetLampLit("HallwayLight1_13", true, false);
SetLampLit("HallwayLight1_14", true, false);
SetLampLit("HallwayLight1_15", true, false);
SetLampLit("HallwayLight1_16", true, false);
SetLampLit("HallwayLight1_17", true, false);
SetLampLit("HallwayLight1_18", true, false);
SetLampLit("HallwayLight1_19", true, false);
SetLampLit("HallwayLight1_20", true, false);
SetLampLit("HallwayLight1_21", true, false);
SetLampLit("HallwayLight1_22", true, false);
SetLampLit("HallwayLight1_23", true, false);
SetLampLit("HallwayLight1_24", true, false);
SetLampLit("HallwayLight1_25", true, false);
SetLampLit("HallwayLight1_26", true, false);
SetLampLit("HallwayLight1_27", true, false);
SetLampLit("Keypad2Light_1", true, false);
SetLampLit("Keypad2Light_2", true, false);
SetLampLit("Keypad3Light_1", true, false);
SetLampLit("Keypad3Light_2", true, false);
SetLightVisible("LVL1BigLight_1", true);
PlayGuiSound("lm_light_flicker.snt", 1);
SetEntityActive("CheckPoint1DoorPowered", true);
SetEntityActive("CheckPoint1DoorPowered2", true);
SetEntityActive("CheckPoint1DoorUnpowered", false);
SetEntityActive("CheckPoint1DoorUnpowered2", false);
SetEntityInteractionDisabled("MasterValveLVL1", false);
}

void LVL2LightsOn(string &in asTimer)
{
SetLampLit("HallwayLight2_1", true, false);
SetLampLit("HallwayLight2_2", true, false);
SetLampLit("HallwayLight2_3", true, false);
SetLampLit("HallwayLight2_4", true, false);
SetLampLit("HallwayLight2_5", true, false);
SetLampLit("HallwayLight2_6", true, false);
SetLampLit("HallwayLight2_7", true, false);
SetLampLit("HallwayLight2_8", true, false);
SetLampLit("HallwayLight2_9", true, false);
SetLampLit("HallwayLight2_10", true, false);
SetLampLit("HallwayLight2_11", true, false);
SetLampLit("HallwayLight2_12", true, false);
SetLampLit("HallwayLight2_13", true, false);
SetLampLit("HallwayLight2_14", true, false);
SetLampLit("HallwayLight2_15", true, false);
SetLampLit("HallwayLight2_16", true, false);
SetLampLit("HallwayLight2_17", true, false);
SetLampLit("HallwayLight2_18", true, false);
SetLampLit("HallwayLight2_19", true, false);
SetLampLit("HallwayLight2_20", true, false);
SetLampLit("HallwayLight2_21", true, false);
SetLampLit("HallwayLight2_22", true, false);
SetLampLit("HallwayLight2_23", true, false);
SetLampLit("HallwayLight2_24", true, false);
SetLampLit("HallwayLight2_25", true, false);
SetLampLit("HallwayLight2_26", true, false);
SetLightVisible("LVL2BigLight", true);
PlayGuiSound("lm_light_flicker.snt", 1);
SetEntityInteractionDisabled("MasterValveLVL2", false);
}

void LVL2LightsOff(string &in asTimer)
{
SetLampLit("HallwayLight2_1", false, false);
SetLampLit("HallwayLight2_2", false, false);
SetLampLit("HallwayLight2_3", false, false);
SetLampLit("HallwayLight2_4", false, false);
SetLampLit("HallwayLight2_5", false, false);
SetLampLit("HallwayLight2_6", false, false);
SetLampLit("HallwayLight2_7", false, false);
SetLampLit("HallwayLight2_8", false, false);
SetLampLit("HallwayLight2_9", false, false);
SetLampLit("HallwayLight2_10", false, false);
SetLampLit("HallwayLight2_11", false, false);
SetLampLit("HallwayLight2_12", false, false);
SetLampLit("HallwayLight2_13", false, false);
SetLampLit("HallwayLight2_14", false, false);
SetLampLit("HallwayLight2_15", false, false);
SetLampLit("HallwayLight2_16", false, false);
SetLampLit("HallwayLight2_17", false, false);
SetLampLit("HallwayLight2_18", false, false);
SetLampLit("HallwayLight2_19", false, false);
SetLampLit("HallwayLight2_20", false, false);
SetLampLit("HallwayLight2_21", false, false);
SetLampLit("HallwayLight2_22", false, false);
SetLampLit("HallwayLight2_23", false, false);
SetLampLit("HallwayLight2_24", false, false);
SetLampLit("HallwayLight2_25", false, false);
SetLampLit("HallwayLight2_26", false, false);
SetLightVisible("LVL2BigLight", false);
PlayGuiSound("lm_light_flicker.snt", 1);
SetEntityInteractionDisabled("MasterValveLVL2", false);
}

void ClimbUpLVL1Valve(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbUpLVL1ValveDone");
}

void ClimbUpLVL1ValveDone(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("ValveSpawn1");
}

void ClimbUpLVL2Valve(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbUpLVL2ValveDone");
}

void ClimbUpLVL2ValveDone(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("ValveSpawn2");
}

void InitPhono3(string &in asEntity, int alState)
{
PlayMusic("PhonoAmb2.ogg", false, 0.5f, 0.0f, 2, false);
AddGlobalVarInt("Achiev2", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
FadeGlobalSoundVolume(0.2f, 0.5f);
AddEffectVoice("TD_Phono31.ogg", "", "TD_Voice", "Phono3_1", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono32.ogg", "", "TD_Voice", "Phono3_2", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono33.ogg", "", "TD_Voice", "Phono3_3", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono34.ogg", "", "TD_Voice", "Phono3_4", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono35.ogg", "", "TD_Voice", "Phono3_5", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono36.ogg", "", "TD_Voice", "Phono3_6", false, asEntity, 0, 20);
SetWheelStuckState("PhonoGraph3", alState, true);
SetEffectVoiceOverCallback("GivePointPhono");
SetInventoryDisabled(true);
}

void InitPhono4(string &in asEntity, int alState)
{
PlayMusic("PhonoAmb3.ogg", false, 0.5f, 0.0f, 2, false);
AddGlobalVarInt("Achiev2", 1);
StartScreenShake(0.1f, 0.2f, 0, 0);
FadeGlobalSoundVolume(0.2f, 0.5f);
AddEffectVoice("TD_Phono41.ogg", "", "TD_Voice", "Phono4_1", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono42.ogg", "", "TD_Voice", "Phono4_2", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono43.ogg", "", "TD_Voice", "Phono4_3", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono44.ogg", "", "TD_Voice", "Phono4_4", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono45.ogg", "", "TD_Voice", "Phono4_5", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono46.ogg", "", "TD_Voice", "Phono4_6", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono47.ogg", "", "TD_Voice", "Phono4_7", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono48.ogg", "", "TD_Voice", "Phono4_8", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono49.ogg", "", "TD_Voice", "Phono4_9", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono410.ogg", "", "TD_Voice", "Phono4_10", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono411.ogg", "", "TD_Voice", "Phono4_11", false, asEntity, 0, 20);
AddEffectVoice("TD_Phono412.ogg", "", "TD_Voice", "Phono4_12", false, asEntity, 0, 20);
SetWheelStuckState("PhonoGraph4", alState, true);
SetEffectVoiceOverCallback("GivePointPhono");
SetInventoryDisabled(true);
SetPlayerRunSpeedMul(0.5f);
SetPlayerMoveSpeedMul(0.5f);
}

void GivePointPhono()
{
StopMusic(0.25f, 2);
SetPlayerRunSpeedMul(1.0f);
SetPlayerMoveSpeedMul(1.0f);
SetSwingDoorLocked("CellarDoor", false, true);
SetLevelDoorLocked("BackDoor", false);
FadeGlobalSoundVolume(1.0f, 6.0f);
StartScreenShake(0.1f, 0.2f, 0, 0);
PlayGuiSound("lock_door.snt", 1);
SetInventoryDisabled(false);
SetEntityActive("Blockade_1", false);
AddTimer("", 0.25f, "GivePointTimer");
}

void InfectPlayerLVL2(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("Infected") == 0 && GetLocalVarInt("PowerLVL2") == -1)
{
SetLocalVarInt("Infected", 1);
AddTimer("", 20.0f, "InfectionHandler");
}
}

void InfectPlayerLVL3(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("Infected") == 0)
{
SetLocalVarInt("Infected", 1);
AddTimer("", 20.0f, "InfectionHandler");
}
}

void FixPipes(string &in asItem, string &in asEntity)
{
if(GetLocalVarInt("PowerLVL2") == -1)
{
SetMessage("TD_Custom", "CantFixPipes", 3.0f);
}
if(GetLocalVarInt("PowerLVL2") == 0 && GetLocalVarInt("LVL2PipesFixed") == 0)
{
SetPlayerActive(false);
FadeOut(0.5f);
SetMessage("TD_Custom", "FixingPipes", 3.0f);
PlayGuiSound("12_make_drill.snt", 1);
AddTimer("", 3.0f, "FixPipesDone");
}
if(GetLocalVarInt("PowerLVL2") == 0 && GetLocalVarInt("LVL2PipesFixed") == 1)
{
SetMessage("TD_Custom", "PipesAlreadyFixed", 3.0f);
}
if(GetLocalVarInt("PowerLVL2") == 1 && GetLocalVarInt("LVL2PipesFixed") == 1)
{
SetMessage("TD_Custom", "PipesAlreadyFixed2", 3.0f);
}
}

void FixPipesDone(string &in asTimer)
{
SetEntityActive("PipeBroken_1", false);
SetEntityActive("PipeBroken_2", false);
SetEntityActive("PipeBroken_3", false);
SetEntityActive("PipeFixed_1", true);
SetEntityActive("PipeFixed_2", true);
SetEntityActive("PipeFixed_3", true);
SetPlayerActive(true);
FadeIn(0.5f);
SetLocalVarInt("LVL2PipesFixed", 1);
}

void LVL2BridgeScareSystem(string &in asParent, string &in asChild, int alState)
{
int RandScare = RandInt(1, 3);
if(RandScare == 1)
{
PlayGuiSound("TD_DistantBoom.snt", 1);
StartScreenShake(0.01f, 2.5f, 0.5, 0.5);
}
if(RandScare == 2)
{
PlayGuiSound("Bang.snt", 1);
StartScreenShake(0.1f, 0.2f, 0.0, 0.0);
FadeLightTo("LVL2BridgeLight", 1, 0, 0, 1, -1, 0);
AddTimer("", 0.1f, "BridgeLightReset");
}
if(RandScare == 3)
{
PlayGuiSound("TD_SpiderScare.snt", 1);
}
AddTimer("", RandFloat(30.0f, 300.0f), "LVL2BridgeScareReset");
}

void BridgeLightReset(string &in asTimer)
{
FadeLightTo("LVL2BridgeLight", 0, 0, 0, 0, -1, 3);
}

void LVL2BridgeScareReset(string &in asTimer)
{
AddEntityCollideCallback("Player", "LVL2BridgeScares", "LVL2BridgeScareSystem", true, 1);
}

void LightBlinksLVL2(string &in asTimer)
{
if(GetLocalVarInt("PowerLVL2") == 1)
{
int WhichX = RandInt(1, 26);
SetLampLit("HallwayLight2_" + WhichX, false, false);
PlaySoundAtEntity("", "lm_light_flicker.snt", "HallwayLight2_" + WhichX, 0, false);
AddTimer("", 0.1f, "LightBlinksLVL2Cancel");
}
AddTimer("", RandFloat(0.2f, 0.9f), "LightBlinksLVL2");
}

void LightBlinksLVL2Cancel(string &in asTimer)
{
if(GetLocalVarInt("PowerLVL2") == 1)
{
SetLampLit("HallwayLight2_1", true, true);
SetLampLit("HallwayLight2_2", true, true);
SetLampLit("HallwayLight2_3", true, true);
SetLampLit("HallwayLight2_4", true, true);
SetLampLit("HallwayLight2_5", true, true);
SetLampLit("HallwayLight2_6", true, true);
SetLampLit("HallwayLight2_7", true, true);
SetLampLit("HallwayLight2_8", true, true);
SetLampLit("HallwayLight2_9", true, true);
SetLampLit("HallwayLight2_10", true, true);
SetLampLit("HallwayLight2_11", true, true);
SetLampLit("HallwayLight2_12", true, true);
SetLampLit("HallwayLight2_13", true, true);
SetLampLit("HallwayLight2_14", true, true);
SetLampLit("HallwayLight2_15", true, true);
SetLampLit("HallwayLight2_16", true, true);
SetLampLit("HallwayLight2_17", true, true);
SetLampLit("HallwayLight2_18", true, true);
SetLampLit("HallwayLight2_19", true, true);
SetLampLit("HallwayLight2_20", true, true);
SetLampLit("HallwayLight2_21", true, true);
SetLampLit("HallwayLight2_22", true, true);
SetLampLit("HallwayLight2_23", true, true);
SetLampLit("HallwayLight2_24", true, true);
SetLampLit("HallwayLight2_25", true, true);
SetLampLit("HallwayLight2_26", true, true);
}
}

void UndergroundRumbAmb(string &in asTimer)
{
if(GetLocalVarInt("PlayerOnLVL") == 2)
{
PlayGuiSound("TD_Rumb.snt", 0.25f);
StartScreenShake(0.005f, 1.5f, 0.55f, 0.55f);
}
if(GetLocalVarInt("PlayerOnLVL") == 3)
{
PlayGuiSound("TD_Rumb.snt", 0.5f);
StartScreenShake(0.01f, 1.5f, 0.55f, 0.55f);
}
if(GetLocalVarInt("PlayerOnLVL") == 4)
{
PlayGuiSound("TD_Rumb.snt", 0.75f);
PlayGuiSound("TD_RumbLouder.snt", 0.2f);
StartScreenShake(0.012f, 1.75f, 0.55f, 0.55f);
}
if(GetLocalVarInt("PlayerOnLVL") == 5)
{
PlayGuiSound("TD_Rumb.snt", 1.0f);
PlayGuiSound("TD_RumbLouder.snt", 0.5f);
StartScreenShake(0.015f, 1.75f, 0.55f, 0.55f);
}
if(GetLocalVarInt("PlayerOnLVL") == 6)
{
PlayGuiSound("TD_Rumb.snt", 1.0f);
PlayGuiSound("TD_RumbLouder.snt", 1.0f);
PlayGuiSound("guardian_idle_rand.snt", 0.2f);
StartScreenShake(0.015f, 1.75f, 0.55f, 0.55f);
}
AddTimer("", RandFloat(20.0f, 60.0f), "UndergroundRumbAmb");
}

void ScorchWarning(string &in asTimer)
{
SetMessage("TD_Custom", "Unprotected", 4.0f);
}

void ScorchWarning2(string &in asTimer)
{
SetMessage("TD_Custom", "UnprotectedHint", 4.0f);
}

void ScorchFunc(string &in asParent, string &in asChild, int alState)
{
SetPlayerMoveSpeedMul(0.5f);
SetPlayerLookSpeedMul(0.5f);
SetLocalVarInt("ScorchAOETrue", 1);
FadeInSound("ScorchNoise", 4.0f, false);
AddTimer("", 0.1f, "ScorchHandler");
}

void ScorchFunc2(string &in asParent, string &in asChild, int alState)
{
StopSound("ScorchNoise", 10.0f);
SetPlayerMoveSpeedMul(1.0f);
SetPlayerLookSpeedMul(1.0f);
SetLocalVarInt("ScorchAOETrue", 0);
FadeRadialBlurTo(0.013f, 0.005f);
FadeSepiaColorTo(0.01f, 0.05f);
FadeImageTrailTo(0.0f, 0.05f);
FadePlayerRollTo(0, 0.2f, 0.2f);
FadePlayerFOVMulTo(1, 4);
}

void ScorchHandler(string &in asTimer)
{
if(GetLocalVarInt("ScorchAOETrue") == 1 && GetPlayerSanity() > 23.5)
{
AddPlayerSanity(-0.8f);
FadePlayerFOVMulTo(RandFloat(0.9, 1.1), 4);
StartScreenShake(0.01f, 3.25f, 0.5f, 0.5f);
FadeRadialBlurTo(RandFloat(0.04f, 0.12f), 0.06f);
FadePlayerRollTo(RandFloat(-10, 10), 2.2f, 2.2f);
FadeSepiaColorTo(1.0f, 0.2f);
SetPlayerMoveSpeedMul(0.8f);
SetPlayerLookSpeedMul(0.8f);
}
if(GetLocalVarInt("ScorchAOETrue") == 1 && GetPlayerSanity() < 23.5)
{
AddPlayerHealth(-0.5f);
if(GetPlayerHealth() < 10)
{
SetLocalVarInt("Infected", 0);
SetLocalVarInt("ScorchAOETrue", 0);
CheckPoint("", "Start", "DeathByScorch", "TD_Custom", "GO");
SetPlayerHealth(-5);
}
FadePlayerFOVMulTo(RandFloat(0.6, 1.4), 4);
StartScreenShake(0.04f, 3.25f, 0.01f, 0.01f);
FadeRadialBlurTo(RandFloat(0.12f, 0.34f), 0.06f);
FadePlayerRollTo(RandFloat(-30, 30), 4.2f, 4.2f);
SetPlayerMoveSpeedMul(0.65f);
SetPlayerLookSpeedMul(0.65f);
PlayGuiSound("PitchNoise.snt", 0.1f);
SetMessage("TD_Custom", "ScorchFXMSG" + RandInt(1, 7), 0.05f);
}
if(GetLocalVarInt("ScorchAOETrue") == 0)
{
return;
}
AddTimer("", 0.1f, "ScorchHandler");
}

void ScorcherMSG(string &in asEntity)
{
SetMessage("TD_Custom", "ScorcherTooClose", 5.0f);
}

void TriggerScorchBell(string &in asParent, string &in asChild, int alState)
{
CreateParticleSystemAtEntity("", "ps_orb_shockwave.ps", "BellFX", false);
PlayGuiSound("TD_BigBell.snt", 1);
StartScreenShake(0.1f, 0.2f, 0.0, 0.0);
StartPlayerLookAt("BellFX", 5, 10, "");
AddTimer("", 2.0f, "BellRemark");
}

void BellRemark(string &in asTimer)
{
StopPlayerLookAt();
SetMessage("TD_Custom", "BellHint", 4.0f);
}

void PressMP1Butt(string &in asEntity)
{
AddLocalVarInt("MP1Progress", 1);
PlayGuiSound("puzzle_button.snt", 1);
AddTimer("", 0.1f, "MP1ButtonUpdate");
}

void PressMP1ButtFinal(string &in asEntity)
{
PlayGuiSound("TD_BigBell.snt", 1);
StartScreenShake(0.1f, 0.2f, 0.0, 0.0);
PlayGuiSound("puzzle_button.snt", 1);
SetEntityActive("MindPiece_1Block", false);
SetEntityInteractionDisabled("MindPiece_1", false);
SetMessage("TD_Custom", "MindPiece1Unlocked", 3.0f);
}

void MP1ButtonUpdate(string &in asTimer)
{
SetEntityActive("MPButton_" + GetLocalVarInt("MP1Progress"), true);
if(GetLocalVarInt("MP1Progress") == 2)
{
SetMessage("TD_Custom", "ButtonPuzzle", 3.0f);
}
}

void MindPieceLock(string &in asEntity)
{
SetMessage("TD_Custom", "MindPiece1Locked", 3.0f);
}

void RemoveResPro(string &in asEntity)
{
DestroyParticleSystem("MindPiece_1FX");
AddLocalVarInt("MPSFound", 1);
if(GetLocalVarInt("MPSFound") == 3)
{
SetLocalVarInt("RealDogState", -1);
CompleteQuest("Chapter1BOnly2", "CHP1B_2");
AddTimer("", 10.0f, "TriggerCandleCode2");
}
AddTimer("", 2.0f, "RemoveResPro2");
}

void RemoveResPro2(string &in asTimer)
{
PlayGuiSound("impact_glass_high.snt", 1);
SetMessage("TD_Custom", "ResProBreaks", 2.0f);
RemoveItem("ResPro");
SetEntityActive("ScorchArea", true);
SetEntityActive("ScorchArea2", true);
SetEntityInteractionDisabled("Elev2ABottomLever", true);
}

void ScorchProtector(string &in asEntity)
{
SetEntityActive("ScorchArea", false);
SetEntityActive("ScorchArea2", false);
}

void PipeWTFMSG(string &in asParent, string &in asChild, int alState)
{
SetMessage("TD_Custom", "PipesWTF", 3.0f);
}

void ClimbDownTo4(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbDownTo4Done");
}

void ClimbDownTo4Done(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("LVL3_4Down");
SetLocalVarInt("PlayerOnLVL", 4);
}

void ClimbUpTo3(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbUpTo3Done");
}

void ClimbUpTo3Done(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("LVL3_4Up");
SetLocalVarInt("PlayerOnLVL", 3);
}

void ClimbDownTo6(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbDownTo6Done");
}

void ClimbDownTo6Done(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("LVL5_6Down");
SetLocalVarInt("PlayerOnLVL", 6);
}

void ClimbUpTo5(string &in asEntity)
{
FadeOut(0.25f);
PlayGuiSound("TD_LadderTrans.snt", 1);
SetPlayerActive(false);
AddTimer("", 2.0f, "ClimbUpTo5Done");
}

void ClimbUpTo5Done(string &in asTimer)
{
FadeIn(0.25f);
SetPlayerActive(true);
TeleportPlayer("LVL5_6Up");
SetLocalVarInt("PlayerOnLVL", 5);
}

void LVL4PipeScare(string &in asParent, string &in asChild, int alState)
{
GivePlayerDamage(1, "Splat", true, false);
GiveSanityDamage(10, true);
PlayGuiSound("27_jam.snt", 1);
SetPlayerHealth(22.5);
CreateParticleSystemAtEntityExt("", "ps_dust_elevator_crash.ps", "Player", false, 1, 1, 1, 1, false, 0, 0, 0, 0);
}

void TriggerDogScripted(string &in asParent, string &in asChild, int alState)
{
TeleportEnemyToEntity("RealDog", "SpawnHere1LVL3", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 0);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL3_1", true);
SetEntityActive("DoggyBlockLVL3_2", true);
AddTimer("", 45.0f, "TriggerDogScriptedDisappear");
SetLocalVarInt("RealDogState", 75);
AddTimer("", 1.0f, "RealDogStatusHandler");
}

void TriggerDogScriptedDisappear(string &in asTimer)
{
TeleportEnemyToEntity("RealDog", "TeleportToHideout", "", true);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 1);
SetEntityActive("Checkpoint3DoorPowered", true);
SetEntityActive("DoggyBlockLVL3_1", false);
SetEntityActive("DoggyBlockLVL3_2", false);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
PlayGuiSound("outside_howl.snt", 1);
AddTimer("", 0.25f, "TriggerDogScriptedDisappear2");
}

void TriggerDogScriptedDisappear2(string &in asTimer)
{
SetEntityActive("RealDog", false);
SetLocalVarInt("Scared", 0);
if(GetPlayerHealth() > 10)
{
AddTimer("", 3.0f, "AutosaveDangerous");
}
}

void AutosaveDangerous(string &in asTimer)
{
if(GetPlayerHealth() > 10)
{
AutoSave();
SetMessage("TD_Custom", "Saved", 1.0f);
}
}

void RealDogStatusHandler(string &in asTimer)
{
if(GetLocalVarInt("RealDogState") <= 0)
{
return;
}
if(GetLocalVarInt("RealDogState") > 0)
{
AddLocalVarInt("RealDogState", -1);
}
AddDebugMessage("Dog is " + GetLocalVarInt("RealDogState") + " seconds away from reappearing.", false);
AddTimer("", 1.0f, "RealDogStatusHandler");
}

void NormalDogDisappear(string &in asTimer)
{
TeleportEnemyToEntity("RealDog", "TeleportToHideout", "", true);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 1);
if(GetLocalVarInt("PowerLVL1") == -2)
{
SetLocalVarInt("PowerLVL1", 1);
}
if(GetLocalVarInt("PowerLVL1") == -3)
{
SetLocalVarInt("PowerLVL1", 0);
}
SetEntityActive("Checkpoint3DoorPowered", true);
SetEntityActive("DoggyBlockLVL3_1", false);
SetEntityActive("DoggyBlockLVL3_2", false);
SetEntityActive("DoggyBlockLVL2_1", false);
SetEntityActive("DoggyBlockLVL2_2", false);
SetEntityActive("DoggyBlockLVL2_3", false);
SetEntityActive("DoggyBlockLVL1_1", false);
SetEntityActive("DoggyBlockLVL1_2", false);
SetEntityActive("Checkpoint1DoorPowered", true);
SetEntityActive("Checkpoint1DoorPowered2", true);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
PlayGuiSound("outside_howl.snt", 1);
AddTimer("", 0.25f, "NormalDogDisappear2");
}

void NormalDogDisappear2(string &in asTimer)
{
SetEntityActive("RealDog", false);
SetLocalVarInt("Scared", 0);
}

void LVL3DogSpawn1(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere1LVL3", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 0);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL3_1", true);
SetEntityActive("DoggyBlockLVL3_2", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL3DogSpawn2(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere2LVL3", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 0);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL3_1", true);
SetEntityActive("DoggyBlockLVL3_2", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL3DogSpawn3(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere3LVL3", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
ShowEnemyPlayerPosition("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetLocalVarInt("PowerLVL3", 0);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL3_1", true);
SetEntityActive("DoggyBlockLVL3_2", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL2DogSpawn1(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere1LVL2", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL2_1", true);
SetEntityActive("DoggyBlockLVL2_2", true);
SetEntityActive("DoggyBlockLVL2_3", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL2DogSpawn2_3(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere" + RandInt(2, 3) + "LVL2", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL2_1", true);
SetEntityActive("DoggyBlockLVL2_2", true);
SetEntityActive("DoggyBlockLVL2_3", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL1DogSpawn1_4(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere" + RandInt(1, 4) + "LVL1", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
if(GetLocalVarInt("PowerLVL1") == 1)
{
SetLocalVarInt("PowerLVL1", -2);
}
if(GetLocalVarInt("PowerLVL1") == 0)
{
SetLocalVarInt("PowerLVL1", -3);
}
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL1_1", true);
SetEntityActive("DoggyBlockLVL1_2", true);
SetEntityActive("Checkpoint1DoorPowered", false);
SetEntityActive("Checkpoint1DoorPowered2", false);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL1DogSpawn5_6(string &in asParent, string &in asChild, int alState)
{
if(GetLocalVarInt("RealDogState") == 0)
{
TeleportEnemyToEntity("RealDog", "SpawnHere" + RandInt(5, 6) + "LVL1", "", true);
CheckPoint("", "Start", "DeathByDog", "TD_Custom", "GO");
SetLocalVarInt("Scared", 1);
if(GetLocalVarInt("PowerLVL1") == 1)
{
SetLocalVarInt("PowerLVL1", -2);
}
if(GetLocalVarInt("PowerLVL1") == 0)
{
SetLocalVarInt("PowerLVL1", -3);
}
SetGlobalVarInt("DeathType", 2);
SetEntityActive("RealDog", true);
AlertEnemyOfPlayerPresence("RealDog");
PlayGuiSound("enemy_dog_howl.snt", 1);
PlayGuiSound("25_guardian_slime_appear.snt", 1);
FadeOut(0.0f);
FadeIn(0.25f);
SetEntityActive("Checkpoint3DoorPowered", false);
SetEntityActive("DoggyBlockLVL1_1", true);
SetEntityActive("DoggyBlockLVL1_2", true);
SetLocalVarInt("RealDogState", RandInt(50, 180));
AddTimer("", 1.0f, "RealDogStatusHandler");
AddTimer("", RandFloat(10.0f, 45.0f), "NormalDogDisappear");
}
}

void LVL3BruteScare(string &in asParent, string &in asChild, int alState)
{
CheckPoint("", "Start", "DeathByBrute", "TD_Custom", "GO");
PlayGuiSound("PitchNoise.snt", 1.0f);
StartScreenShake(0.1f, 0.2f, 0, 0);
SetLocalVarInt("RealDogState", 240);
SetEntityActive("ChaseBrute", true);
SetGlobalVarInt("DeathType", 5);
SetEntityActive("MindPiece_2Block", false);
SetPropHealth("MindPiece_2Gate", 0);
ShowEnemyPlayerPosition("ChaseBrute");
SetLocalVarInt("IsBeingBruted", 1);
AddTimer("", 1.0f, "BruteShower");
RemoveItem("PadlockKey");
}

void DisappearBrute(string &in asParent, string &in asChild, int alState)
{
StartScreenShake(0.1f, 0.2f, 0, 0);
PlayGuiSound("MetalBang.snt", 1.3f);
SetEntityActive(asParent, false);
AddTimer("", 9.0f, "RefixMusic");
RemoveTimer("BruteTimer");
}

void BruteShower(string &in asTimer)
{
ShowEnemyPlayerPosition("ChaseBrute");
AddTimer("BruteTimer", 1.0f, "BruteShower");
}

void RefixMusic(string &in asTimer)
{
StopMusic(3.0f, 256);
}

void MindPieceProgress(string &in asEntity)
{
AddLocalVarInt("MPSFound", 1);
if(GetLocalVarInt("MPSFound") == 3)
{
SetLocalVarInt("RealDogState", -1);
CompleteQuest("Chapter1BOnly2", "CHP1B_2");
AddTimer("", 10.0f, "TriggerCandleCode2");
}
}

void PadlockKeyFound(string &in asEntity)
{
SetLocalVarInt("RealDogState", -1);
AddEntityCollideCallback("Player", "LVL3BruteScare", "LVL3BruteScare", true, 1);
}

void ChangeAmbstoLVL4(string &in asParent, string &in asChild, int alState)
{
SetLocalVarInt("PlayerOnLVL", 4);
}

void ChangeAmbstoLVL5(string &in asParent, string &in asChild, int alState)
{
SetLocalVarInt("PlayerOnLVL", 5);
}

void WaterReact(string &in asParent, string &in asChild, int alState)
{
SetMessage("TD_Custom", "Waters", 4.0f);
}

void LVL5WaterScare(string &in asParent, string &in asChild, int alState)
{
CreateParticleSystemAtEntity("", "ps_water_dump_splash.ps", "LVL5WaterHere", false);
PlayGuiSound("impact_water_high.snt", 1);
}

void TriggerCandleCode(string &in asEntity)
{
if(GetLocalVarInt("MPSFound") < 3)
{
AddQuest("Chapter1BOnly2", "CHP1B_2");
}
}

void TriggerCandleCode2(string &in asTimer)
{
if(GetLocalVarInt("MPSFound") == 3)
{
AddEntityCollideCallback("Player", "LVL6CandleArea", "CandleCodeSeqTrig", true, 1);
}
}

void CandleCodeSeqTrig(string &in asParent, string &in asChild, int alState)
{
SetEntityInteractionDisabled("button_simple_72", false);
AddQuest("Numbers", "NumbersQuest");
}

void PressLVL7_1(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 3)
{
SetLightVisible("LightButton7_1", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 8)
{
SetLightVisible("LightButton7_2", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_3(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 6)
{
SetLightVisible("LightButton7_3", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_4(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 2)
{
SetLightVisible("LightButton7_4", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_5(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 5)
{
SetLightVisible("LightButton7_5", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_6(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 9)
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
CompleteQuest("Numbers", "NumbersQuest");
SetLocalVarInt("Keypad7Code", 0);
SetupLoadScreen("TD_Custom", "LVL3Screen", 1, "");
if(GetGlobalVarInt("BeenThereBefore") == 0)
{
ChangeMap("TD_LVL3", "Start", "door_large_castle_open.snt", "close_gate.snt");
}
if(GetGlobalVarInt("BeenThereBefore") == 1)
{
ChangeMap("TD_LVL3", "DebugSpawn", "door_large_castle_open.snt", "close_gate.snt");
}
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_7(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 4)
{
SetLightVisible("LightButton7_7", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_8(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 7)
{
SetLightVisible("LightButton7_8", true);
AddLocalVarInt("Keypad7Code", 1);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void PressLVL7_9(string &in asEntity)
{
PlayGuiSound("puzzle_button.snt", 1);
if(GetLocalVarInt("Keypad7Code") == 0)
{
SetLightVisible("LightButton7_9", true);
AddLocalVarInt("Keypad7Code", 2);
}
else
{
SetLightVisible("LightButton7_1", false);
SetLightVisible("LightButton7_2", false);
SetLightVisible("LightButton7_3", false);
SetLightVisible("LightButton7_4", false);
SetLightVisible("LightButton7_5", false);
SetLightVisible("LightButton7_6", false);
SetLightVisible("LightButton7_7", false);
SetLightVisible("LightButton7_8", false);
SetLightVisible("LightButton7_9", false);
SetLocalVarInt("Keypad7Code", 0);
}
}

void InfectedMSG(string &in asEntity)
{
if(GetLocalVarInt("InfProgress") <= 30)
{
SetMessage("TD_Custom", "InfectedBarricade", 4.0f);
}
if(GetLocalVarInt("InfProgress") > 30)
{
SetMessage("TD_Custom", "InfectedBarricade2", 4.0f);
}
}