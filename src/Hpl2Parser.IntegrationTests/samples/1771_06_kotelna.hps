void OnStart()
{
  //CreateDataCache();
  SetGlobalVarInt("byl_v_kotelne", 1);
  //GiveItemFromFile("lantern_1", "lantern.ent");
  //GiveItem("lantern_wackersberg", "lantern", "Lantern", "lantern_wackersberg.tga", 1);
  /*AddEntityCollideCallback("paka_1", "area_paka_1", "paka_1_cb", false, 1);
  AddEntityCollideCallback("paka_2", "area_paka_2", "paka_1_cb", false, 1);
  AddEntityCollideCallback("paka_3", "area_paka_3", "paka_2_cb", false, 1);
  AddEntityCollideCallback("paka_4", "area_paka_4", "paka_2_cb", false, 1);
  AddEntityCollideCallback("paka_1", "area_paka_5", "paka_1_cb", false, 1);
  AddEntityCollideCallback("paka_2", "area_paka_6", "paka_1_cb", false, 1);*/

  AddEntityCollideCallback("coal*", "area_uhli", "je_treba_zatopit", false, 0);
  AddEntityCollideCallback("paka_z_pekla", "area_paka_kotel", "zatop_kurva_zatop", false, 1);

  //AddEntityCollideCallback("coal*", "idiot_proof_5", "blbec_s_uhlim", false,  1);

  // idiot proof design
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_1", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_2", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_3", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_4", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_5", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_6", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_7", "hrac_je_pica", false, 1);
  AddEntityCollideCallback("ona_je_ta_prava_trubka", "idiot_proof_8", "hrac_je_pica", false, 1);

  AddEntityCollideCallback("kolecko1", "idiot_proof_1", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_2", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_3", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_4", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_5", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_6", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_7", "hrac_je_pica_bez_kolecka", false, 1);
  AddEntityCollideCallback("kolecko1", "idiot_proof_8", "hrac_je_pica_bez_kolecka", false, 1);

  AddEntityCollideCallback("kolecko2", "idiot_proof_1", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_2", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_3", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_4", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_5", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_6", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_7", "hrac_je_pica_bez_kolecka1", false, 1);
  AddEntityCollideCallback("kolecko2", "idiot_proof_8", "hrac_je_pica_bez_kolecka1", false, 1);

  //AddEntityCollideCallback("paka_z_pekla", "area_kola", "zatop_kurva_zatop", false, 0);

  // Hedwig
  AddEntityCollideCallback("Player", "area_hedwig", "predstav_hedwigu", true, 1);

  SetLocalVarInt("dira_1", 0);
  SetLocalVarInt("dira_2", 0);
  SetLocalVarInt("dira_3", 0);
  SetLocalVarInt("dira_4", 0);
  SetLocalVarInt("dira_5", 0);
  SetLocalVarInt("dira_6", 0);
  obnov_callbacky();

  SetPropEffectActive("coal_*", false, false);

  SetEntityInteractionDisabled("trubka_puvodni", true);

  // default
  SetLocalVarInt("sticky1_má_o_kolečko_víc", 0);
  SetLocalVarInt("sticky2_má_o_kolečko_víc", 0);
  SetLocalVarInt("spravna_kombinace", 0);
  SetLocalVarInt("piston1_srovnany", 0);
  SetLocalVarInt("piston2_srovnany", 0);
  SetLocalVarInt("kotel_naplnen", 0);
  SetLocalVarInt("stroj_ma_vodu", 0);
  SetLocalVarInt("stroj_ma_olej", 0);
  SetLocalVarInt("tlak_vyvazeny", 0);
  SetLocalVarInt("trubka_na_miste", 0);

  //DEBUG
  /*
  SetLocalVarInt("sticky1_má_o_kolečko_víc", 1);
  SetLocalVarInt("sticky2_má_o_kolečko_víc", 1);
  SetLocalVarInt("spravna_kombinace", 1);
  SetLocalVarInt("piston1_srovnany", 1);
  SetLocalVarInt("piston2_srovnany", 1);
  SetLocalVarInt("kotel_naplnen", 1);
  SetLocalVarInt("stroj_ma_vodu", 1);
  SetLocalVarInt("stroj_ma_olej", 0);
  SetLocalVarInt("tlak_vyvazeny", 1);
  SetLocalVarInt("trubka_na_miste", 1);*/


  PreloadSound("afx_temple_steam_release.snt");

  //kyble
  AddUseItemCallback("", "kyblstrojovna", "area_kybl", "valve_steam_machines_werent_a_failure", false);
  AddUseItemCallback("", "sklenenapicovina", "area_nalevka", "puzzles_too_hard", false);

  for(int i=1;i<5;i++)
  {
		AddEntityCollideCallback("p_lever_"+i, "L_Up_Area_"+i, "CollideLever", false, 1);
		AddEntityCollideCallback("p_lever_"+i, "L_Down_Area_"+i, "CollideLever", false, 1);

		SetLocalVarInt("p_lever_"+i, 1);
	}

	for(int i=1;i<5;i++)
		SetEntityPlayerInteractCallback("control_room_piston_lever_"+i, "InteractLockedWheel", false);

//AddEnemyPatrolNode("h1", "n1", 0.0, "WalkCycle.dae_ANIM");
//SetEnemySanityDecreaseActive("h1", false);
}

void hrac_je_pica(string &in asParent, string &in asChild, int alState)
{
  SetLocalVarString("kam_to_ten_curak_hodil", asChild);
  AddTimer("", 5, "zjisti_jestli_je_hrac_fakt_pica");
}

void hrac_je_pica_bez_kolecka(string &in asParent, string &in asChild, int alState)
{
  SetLocalVarString("kam_ten_curak_kolecko1_hodil", asChild);
  AddTimer("", 5, "zjisti_jestli_je_hrac_fakt_pica");
}

void hrac_je_pica_bez_kolecka1(string &in asParent, string &in asChild, int alState)
{
  SetLocalVarString("kam_ten_curak_kolecko2_hodil", asChild);
  AddTimer("", 5, "zjisti_jestli_je_hrac_fakt_pica");
}

void zjisti_jestli_je_hrac_fakt_pica(string &in asTimer)
{
  if(GetEntitiesCollide(GetLocalVarString("kam_to_ten_curak_hodil"), "ona_je_ta_prava_trubka") == true)
  {
    SetEntityPos("ona_je_ta_prava_trubka", -15.586, 0.205, 11.992);
  }
  if(GetEntitiesCollide(GetLocalVarString("kam_ten_curak_kolecko1_hodil"), "kolecko1") == true)
  {
    SetEntityPos("kolecko1", -5.276, 0.449, -5.778);
  }
  if(GetEntitiesCollide(GetLocalVarString("kam_ten_curak_kolecko2_hodil"), "kolecko2") == true)
  {
    AddDebugMessage("kam jsi to hodil ty zmrde", false);
    SetEntityPos("kolecko2", -48.12, -7.249, -20.125);
  }
}

void vloztycku(string &in asItem, string &in asEntity)
{
    if(GetLocalVarInt(asEntity) == 0)
    {
      PlaySoundAtEntity("", "13_rod_in", "Player", 1, false);
      RemoveItem(asItem);
      SetEntityActive(asItem+"_vlozena_"+asEntity, true);
      SetLocalVarInt(asEntity, 1);
      SetEntityPlayerInteractCallback(asItem+"_vlozena_"+asEntity, "sebertycku" , true);
      SetEntityInteractionDisabled(asItem+"_vlozena_"+asEntity, true);
      SetLocalVarString(asEntity+"_item", asItem);
      SetEntityActive(asEntity+"_vyndat", true);
    }
    else
    {
      SetMessage("TheVoice", "semtyckanepujde", 2.0);
    }
}

void vyndat(string &in asEntity)
{
  if(asEntity == "dira_1_vyndat")
  {
    if(GetLocalVarInt("dira_1") == 1)
    {
      SetEntityActive(GetLocalVarString("dira_1_item")+"_vlozena_dira_1", false);
      GiveItem(GetLocalVarString("dira_1_item"), "item", GetLocalVarString("dira_1_item"), GetLocalVarString("dira_1_item"), 1.0);
      SetLocalVarInt("dira_1", 0);
      SetEntityActive("dira_1_vyndat", false);
      PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
    }
    else
    {
      SetMessage("TheVoice", "semtyckapujde", 2.0);
    }
  }
  else if(asEntity == "dira_2_vyndat")
  {
    if(GetLocalVarInt("dira_2") == 1)
    {
      AddDebugMessage("dira 2 vyndat", false);
      SetEntityActive(GetLocalVarString("dira_2_item")+"_vlozena_dira_2", false);
      GiveItem(GetLocalVarString("dira_2_item"), "item", GetLocalVarString("dira_2_item"), GetLocalVarString("dira_2_item"), 1.0);
      SetLocalVarInt("dira_2", 0);
      SetEntityActive("dira_2_vyndat", false);
      PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
    }
    else
    {
      SetMessage("TheVoice", "semtyckapujde", 2.0);
    }
  }
  else if(asEntity == "dira_3_vyndat")
    {
      AddDebugMessage("dira 3 vyndat prvni souhlas", false);
      if(GetLocalVarInt("dira_3") == 1)
        {
          AddDebugMessage("dira 3 vyndat", false);
          SetEntityActive(GetLocalVarString("dira_3_item")+"_vlozena_dira_3", false);
          GiveItem(GetLocalVarString("dira_3_item"), "item", GetLocalVarString("dira_3_item"), GetLocalVarString("dira_3_item"), 1.0);
          SetLocalVarInt("dira_3", 0);
          SetEntityActive("dira_3_vyndat", false);
          PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
        }
      else
        {
          SetMessage("TheVoice", "semtyckapujde", 2.0);
        }
      }
    else if(asEntity == "dira_4_vyndat")
    {
      if(GetLocalVarInt("dira_4") == 1)
        {
          SetEntityActive(GetLocalVarString("dira_4_item")+"_vlozena_dira_4", false);
          GiveItem(GetLocalVarString("dira_4_item"), "item", GetLocalVarString("dira_4_item"), GetLocalVarString("dira_4_item"), 1.0);
          SetLocalVarInt("dira_4", 0);
          SetEntityActive("dira_4_vyndat", false);
          PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
        }
      else
        {
          SetMessage("TheVoice", "semtyckapujde", 2.0);
        }
      }
    else if(asEntity == "dira_5_vyndat")
    {
      if(GetLocalVarInt("dira_5") == 1)
        {
          SetEntityActive(GetLocalVarString("dira_5_item")+"_vlozena_dira_5", false);
          GiveItem(GetLocalVarString("dira_5_item"), "item", GetLocalVarString("dira_5_item"), GetLocalVarString("dira_5_item"), 1.0);
          SetLocalVarInt("dira_5", 0);
          SetEntityActive("dira_5_vyndat", false);
          PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
        }
      else
        {
          SetMessage("TheVoice", "semtyckapujde", 2.0);
        }
      }
    else if(asEntity == "dira_6_vyndat")
    {
      if(GetLocalVarInt("dira_6") == 1)
        {
          SetEntityActive(GetLocalVarString("dira_6_item")+"_vlozena_dira_6", false);
          GiveItem(GetLocalVarString("dira_6_item"), "item", GetLocalVarString("dira_6_item"), GetLocalVarString("dira_6_item"), 1.0);
          SetLocalVarInt("dira_6", 0);
          SetEntityActive("dira_6_vyndat", false);
          PlaySoundAtEntity("", "13_rod_out", "Player", 1, false);
        }
      else
        {
          SetMessage("TheVoice", "semtyckapujde", 2.0);
        }
      }
  }

void obnov_callbacky()
{
  AddUseItemCallback("", "tycka_ruzova", "dira_1", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_1", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_1", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_1", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_1", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_1", "vloztycku", false);

  AddUseItemCallback("", "tycka_ruzova", "dira_2", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_2", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_2", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_2", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_2", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_2", "vloztycku", false);

  AddUseItemCallback("", "tycka_ruzova", "dira_3", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_3", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_3", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_3", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_3", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_3", "vloztycku", false);

  AddUseItemCallback("", "tycka_ruzova", "dira_4", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_4", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_4", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_4", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_4", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_4", "vloztycku", false);

  AddUseItemCallback("", "tycka_ruzova", "dira_5", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_5", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_5", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_5", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_5", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_5", "vloztycku", false);

  AddUseItemCallback("", "tycka_ruzova", "dira_6", "vloztycku", false);
  AddUseItemCallback("", "tycka_zluta", "dira_6", "vloztycku", false);
  AddUseItemCallback("", "tycka_zelena", "dira_6", "vloztycku", false);
  AddUseItemCallback("", "tycka_cervena", "dira_6", "vloztycku", false);
  AddUseItemCallback("", "tycka_tyrkysova", "dira_6", "vloztycku", false);
  AddUseItemCallback("", "tycka_modra", "dira_6", "vloztycku", false);
}

/*void paka_1_cb(string &in asParent, string &in asChild, int alState)
{
  if(GetLocalVarInt("piston_zamceny") == 0)
  {
    SetLocalVarInt("co_bych_delal_kdybych_byl_piston", RandInt(1,2));
    SetLocalVarInt("asi_bych_udelal_tohle", RandInt(0,1));
    if(GetLocalVarInt("co_bych_delal_kdybych_byl_piston") == 1)
    {
      CreateParticleSystemAtEntity("", "ps_steam_piston_move.ps", "area_piston_1", false);
      SetMoveObjectState("piston_*", GetLocalVarInt("asi_bych_udelal_tohle"));
      SetLocalVarInt("jedeme", 1);
      RemoveTimer("resettimer");
      AddTimer("resettimer", 15, "reaktivacepromenne");
    }
    else
    {
      CreateParticleSystemAtEntity("", "ps_steam_piston_move.ps", "area_piston_1", false);
      SetMoveObjectState("piston_*", -GetLocalVarInt("asi_bych_udelal_tohle"));
      SetLocalVarInt("jedeme", 1);
      RemoveTimer("resettimer");
      AddTimer("resettimer", 15, "reaktivacepromenne");
    }
  }
  else
  {
    PlaySoundAtEntity("", "lever_wood_gritty_stuck", "Player", 1, false);
    SetLeverStuckState(asParent, alState, true);
  }
}*/

/*void piston_cb(string &in asParent, string &in asChild, int alState)
{
  AddDebugMessage("hahaha", false);
  PlaySoundAtEntity("", "afx_temple_steam_release", "Player", 1, false);
  CreateParticleSystemAtEntity("", "ps_steam.ps", "area_piston", false);
  SetLocalVarInt("piston_zamceny", 1);
}

void reaktivacepromenne(string &in asEntity)
{
  AddDebugMessage("jedeme 0", false);
  SetLocalVarInt("jedeme", 0);
}*/

void tycka_timer(string &in asTimer)
{
  tycka_detector();
  AddTimer("", 1, "tycka_timer");
}

void jitpryc(string &in asEntity)
{
PlaySoundAtEntity("", "door_large_castle_open.snt", "Player", 1, false);
ChangeMap("04_entrance_hall.map", "playerstart_3", "", "");
SetupLoadScreen("loadingscreen", "sin", 0, "nacitani_sin.jpg");
}

void je_treba_zatopit(string &in asParent, string &in asChild, int alState)
{
  if(alState == 1)
  {
    SetLocalVarInt("pocet_uhli", GetLocalVarInt("pocet_uhli")+1);
    AddDebugMessage("pridavam uhli", false);
    SetEntityInteractionDisabled(asParent, true);
    if(GetLocalVarInt("pocet_uhli") == 1)
    {
      SetLocalVarString("uhli_1", asParent);
    }
    else if(GetLocalVarInt("pocet_uhli") == 2)
    {
      SetLocalVarString("uhli_2", asParent);
    }
    else if(GetLocalVarInt("pocet_uhli") == 3)
    {
      SetLocalVarString("uhli_3", asParent);
    }
  }
  else if(alState == -1)
  {
    SetLocalVarInt("pocet_uhli", GetLocalVarInt("pocet_uhli")-1);
    AddDebugMessage("ubiram uhli", false);
  }

  if(GetLocalVarInt("pocet_uhli") >= 3)
  {
    SetLocalVarInt("kotel_naplnen", 1);
    AddDebugMessage("kotel je naplnen", false);
  }
  else if(GetLocalVarInt("pocet_uhli") < 3)
  {
    SetLocalVarInt("kotel_naplnen", 0);
    AddDebugMessage("kotel NENI naplnen", false);
  }
}

void predstav_hedwigu(string &in asParent, string &in asChild, int alState)
{
  SetInDarknessEffectsActive(false);
  GiveSanityDamage(10.0, true);
  SetPropActiveAndFade("hedwig", true, 1.0);
  SetNPCFollowPlayer("hedwig", true);
  SetEntityActive("block1", true);
  SetEntityActive("block2", true);
  AddTimer("", 1.0, "a_doufam_v_poradny_herecky_vykony");
  StopMusic(3.0, 10);
  PlayMusic("alexmasonprisoner.ogg", true, 0.35, 1.0, 10, false);
  //SetFogProperties(1.0, 7.0, 1.0, false);
  //SetFogColor(100.0, 100.0, 100.0, 100.0);
}

void a_doufam_v_poradny_herecky_vykony(string &in asTimer)
{
  StartInsanityEvent("Wide2");
  if(GetGlobalVarInt("jazyk") == 0)
  {
    AddEffectVoice("strojovna1", "", "dabing", "strojovna1", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna2", "", "dabing", "strojovna2", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna3", "", "dabing", "strojovna3", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna4", "", "dabing", "strojovna4", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna5", "", "dabing", "strojovna5", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna6", "", "dabing", "strojovna6", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna7", "", "dabing", "strojovna7", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna8", "", "dabing", "strojovna8", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna9", "", "dabing", "strojovna9", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna10", "", "dabing", "strojovna10", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna11", "", "dabing", "strojovna11", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna12", "", "dabing", "strojovna12", false, "Player", 5.0, 5.0);
    AddEffectVoice("strojovna13", "", "dabing", "strojovna13", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna14", "", "dabing", "strojovna14", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna15", "", "dabing", "strojovna15", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna16", "", "dabing", "strojovna16", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna17", "", "dabing", "strojovna17", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna18", "", "dabing", "strojovna18", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna19", "", "dabing", "strojovna19", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna20", "", "dabing", "strojovna20", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna21", "", "dabing", "strojovna21", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna22", "", "dabing", "strojovna22", false, "Player", 1.0, 1.0);
    AddTimer("", 1.0, "t1");
  }
  else if(GetGlobalVarInt("jazyk") == 1)
  {
    AddEffectVoice("strojovna1_en", "", "dabing", "strojovna1", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna2_en", "", "dabing", "strojovna2", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna3_en", "", "dabing", "strojovna3", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna4_en", "", "dabing", "strojovna4", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna5_en", "", "dabing", "strojovna5", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna6_en", "", "dabing", "strojovna6", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna7_en", "", "dabing", "strojovna7", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna8_en", "", "dabing", "strojovna8", false, "Player", 1.0, 1.0);
    AddEffectVoice("strojovna9_en", "", "dabing", "strojovna9", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna10_en", "", "dabing", "strojovna10", false, "Player", 1.0, 15.0);
    AddEffectVoice("strojovna11_en", "", "dabing", "strojovna11", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna12_en", "", "dabing", "strojovna12", false, "Player", 1.0, 15.0);
    AddEffectVoice("strojovna13_en", "", "dabing", "strojovna13", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna14_en", "", "dabing", "strojovna14", false, "Player", 5.0, 15.0);
    AddEffectVoice("strojovna15_en", "", "dabing", "strojovna15", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna16_en", "", "dabing", "strojovna16", false, "Player", 5.0, 15.0);
    AddEffectVoice("strojovna17_en", "", "dabing", "strojovna17", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna18_en", "", "dabing", "strojovna18", false, "Player", 5.0, 15.0);
    AddEffectVoice("strojovna19_en", "", "dabing", "strojovna19", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna20_en", "", "dabing", "strojovna20", false, "Player", 5.0, 15.0);
    AddEffectVoice("strojovna21_en", "", "dabing", "strojovna21", true, "hedwig", 5.0, 15.0);
    AddEffectVoice("strojovna22_en", "", "dabing", "strojovna22", false, "Player", 5.0, 15.0);
    AddTimer("", 0.3, "t1");
  }
}

void t1(string &in asTimer)
{
  if(GetEffectVoiceActive() == false)
{
  SetPropActiveAndFade("hedwig", false, 3.0);
  SetEntityActive("block1", false);
  SetEntityActive("block2", false);
  StopMusic(3.0, 10);
  PlayMusic("paranoia.ogg", true, 0.7, 3.5, 10, false);
  StopCurrentInsanityEvent();
  AddQuest("q11", "q11");
  SetInDarknessEffectsActive(true);
  AutoSave();
  //SetFogProperties(0.0, 45.0, 1.3, false);
}
  else
{
  AddTimer("", 1, "t1");
}
}

void zatop_kurva_zatop(string &in asParent, string &in asChild, int alState)
{
  AddDebugMessage("zatop kurva zatop", false);
  if(GetLocalVarInt("kotel_naplnen") == 1)
  {
    if(GetLocalVarInt("sticky1_má_o_kolečko_víc") == 1 && GetLocalVarInt("sticky2_má_o_kolečko_víc") == 1 && GetLocalVarInt("spravna_kombinace") == 1 && GetLocalVarInt("piston1_srovnany") ==1 && GetLocalVarInt("piston2_srovnany") ==1 && GetLocalVarInt("stroj_ma_vodu") ==1 && GetLocalVarInt("stroj_ma_olej") == 1 && GetLocalVarInt("tlak_vyvazeny") == 1 && GetLocalVarInt("trubka_na_miste") == 1)
    {
      SetLeverStuckState("paka_z_pekla", 1, true);
      CreateParticleSystemAtEntity("", "ps_fire_stove_small.ps", "area_uhli", true);
      GiveSanityBoostSmall();
      SetPropEffectActive(GetLocalVarString("uhli_1"), true, true);
      SetPropEffectActive(GetLocalVarString("uhli_2"), true, true);
      SetPropEffectActive(GetLocalVarString("uhli_3"), true, true);
      SetLocalVarInt("kotel_zapalen", 1);
      RotatePropToSpeed("kolecko5", 1.0f, 1.0f, 0.0f, 0.0f, 1.0f, true, "");
      RotatePropToSpeed("kolecko4", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
      RotatePropToSpeed("kolecko1", 1.0f, 1.0f, 0.0f, 0.0f, 1.0f, true, "");
      RotatePropToSpeed("kolecko2", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
      RotatePropToSpeed("kolecko3", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
      RotatePropToSpeed("velkekolo1", 1.0f, 1.0f, 1.0f, 0.0f, 0.0f, true, "");
      RotatePropToSpeed("velkekolo2", 1.0f, 1.0f, -1.0f, 0.0f, 0.0f, true, "");
      RotatePropToSpeed("velkekolo3", 1.0f, 1.0f, 1.0f, 0.0f, 0.0f, true, "");
      RotatePropToSpeed("posledni_zkurveny_kolecko", 2.0f, 2.0f, -1.0f, 0.0f, 0.0f, true, "");
      CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_1", false);
      CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_2", false);
      CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_3", false);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_1", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_2", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_3", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_4", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_5", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_6", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_7", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_8", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_9", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_10", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_11", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_12", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_13", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_14", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_15", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_16", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_17", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_18", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_19", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_20", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_21", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_22", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_23", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_24", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_25", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_26", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_27", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_28", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_29", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_30", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_31", true);
      CreateParticleSystemAtEntity("", "ps_steam.ps", "ps_32", true);
      PlaySoundAtEntity("", "afx_grinding_machine_engine.snt", "Player", 1, true);
      //PlaySoundAtEntity("", "afx_temple_steam_release.snt", "Player", 1, false);
      PlayGuiSound("afx_temple_steam_release.snt", 1.0f);
      StartScreenShake(0.02, 3.0, 1.0, 5.0);
      //SetAllowStickyAreaAttachment(false);
      SetEntityInteractionDisabled("paka_z_pekla", true);
      if(QuestIsAdded("q8"))
      {
        CompleteQuest("q8", "q8");
      }
      if(QuestIsAdded("q9"))
      {
        CompleteQuest("q9", "q9");
      }
      // all of this just for a single variable change, life sucks, gg, no wards, noob carry
      SetGlobalVarInt("vytah_opraven", 1);
    }
    else
    {
      //if(GetEntitiesCollide("kolecko1", "area_kola") == true)
      //{
      if(GetLocalVarInt("sticky1_má_o_kolečko_víc") == 1)
      {
        AddDebugMessage("kolecko 1 na miste", false);
        RotatePropToSpeed("kolecko1", 1.0f, 1.0f, 0.0f, 0.0f, 1.0f, true, "");
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_1", false);
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_2", false);
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_3", false);
        //PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
        //PlayGuiSound("nonefungujeto.snt", 1.0f);
      }
      if(GetEntitiesCollide("kolecko2", "area_kola") == true)
      {
        AddDebugMessage("kolecko 2 na miste", false);
        RotatePropToSpeed("kolecko2", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_1", false);
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_2", false);
        CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "ps_3", false);
        //PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
      }
      AddDebugMessage("at ziji kolecka", false);
      AddTimer("", 5.5, "stop_kolecka_stop_ma_draha_kolecka");
      RotatePropToSpeed("kolecko3", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
      RotatePropToSpeed("kolecko5", 1.0f, 1.0f, 0.0f, 0.0f, 1.0f, true, "");
      RotatePropToSpeed("kolecko4", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
      RotatePropToSpeed("velkekolo3", 1.0f, 1.0f, 1.0f, 0.0f, 0.0f, true, "");
      RotatePropToSpeed("posledni_zkurveny_kolecko", 1.0f, 1.0f, -1.0f, 0.0f, 0.0f, true, "");
      PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
      //PlaySoundAtEntity("", "nonefungujeto", "Player", 1, false);
      PlayGuiSound("nonefungujeto", 2.0f);
      SetEntityInteractionDisabled("paka_z_pekla", true);
    }
  }
  else
  {
    /*PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
    PlaySoundAtEntity("", "nonefungujeto", "Player", 1, false);
    PlayGuiSound("nonefungujeto", 1.0f);*/
    CreateParticleSystemAtEntity("", "ps_steam_puff.ps", "area_ps_kotel", false);
    AddDebugMessage("at ziji kolecka", false);
    AddTimer("", 5.5, "stop_kolecka_stop_ma_draha_kolecka");
    RotatePropToSpeed("kolecko3", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
    RotatePropToSpeed("kolecko5", 1.0f, 1.0f, 0.0f, 0.0f, 1.0f, true, "");
    RotatePropToSpeed("kolecko4", 1.0f, 1.0f, 0.0f, 0.0f, -1.0f, true, "");
    PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
    //PlaySoundAtEntity("", "nonefungujeto", "Player", 1, false);
    PlayGuiSound("nonefungujeto", 2.0f);
    SetEntityInteractionDisabled("paka_z_pekla", true);
  }
}

void stop_kolecka_stop_ma_draha_kolecka(string &in asTimer)
{
  //PlaySoundAtEntity("", "13_machine_fail", "Player", 1, false);
  StopPropMovement("kolecko1");
  StopPropMovement("kolecko2");
  StopPropMovement("kolecko3");
  StopPropMovement("kolecko4");
  StopPropMovement("kolecko5");
  StopPropMovement("velkekolo3");
  StopPropMovement("posledni_zkurveny_kolecko");
  SetEntityInteractionDisabled("paka_z_pekla", false);
}

void tajnycallback(string &in asEntity)
{
  //GiveSanityBoostSmall();
  SetGlobalVarInt("nalezenych_tajnych_poznamek", GetGlobalVarInt("nalezenych_tajnych_poznamek")+1);
  SetMessage("TheVoice", "tajemstvinalezeno", 3.0);
  PlayGuiSound("puzzle.ogg", 1.0);
}

void hlasim_ze_trubka_je_na_svem_miste(string &in asStickyArea, string &in asBodyName)
{
  GiveSanityBoostSmall();
  SetLocalVarInt("trubka_na_miste", 1);
}

void attach1on(string &in asStickyArea, string &in asBodyName)
{
  SetLocalVarInt("sticky1_má_o_kolečko_víc", 1);
  //SetLocalVarString("sticky1_kolecko", asBodyName);
}

void attach1off(string &in asStickyArea, string &in asBodyName)
{
  SetLocalVarInt("sticky1_má_o_kolečko_víc", 0);
}

void attach2on(string &in asStickyArea, string &in asBodyName)
{
  SetLocalVarInt("sticky2_má_o_kolečko_víc", 1);
  //SetLocalVarString("sticky2_kolecko", asBodyName);
}

void attach2off(string &in asStickyArea, string &in asBodyName)
{
  SetLocalVarInt("sticky2_má_o_kolečko_víc", 0);
}

void OnEnter()
{
  //if(GetLocalVarInt("kotel_zapalen") == 0)
  //{
    //SetPropEffectActive("coal_*", false, false);
  //}
  if(GetLocalVarInt("spravna_kombinace") == 0)
  {
    AddTimer("", 1, "tycka_timer");
  }
  /*else if(GetLocalVarInt("kotel_zapalen") == 1)
  {

    SetPropEffectActive(GetLocalVarString("uhli_1"), true, true);
    SetPropEffectActive(GetLocalVarString("uhli_2"), true, true);
    SetPropEffectActive(GetLocalVarString("uhli_3"), true, true);
    CreateParticleSystemAtEntity("", "ps_fire_stove_small.ps", "area_uhli", false);
  }*/
  SetEntityInteractionDisabled("dverepryc", true);
  SetMapDisplayNameEntry("kotelna");

  PlayMusic("paranoia.ogg", true, 0.7, 0.1, 10, false);
  AutoSave();
}

void tycka_detector()
{
  AddDebugMessage("fukce tycka detektor vyvolana", false);

  if(GetLocalVarInt("spravna_kombinace") == 0)
  {
    AddDebugMessage("nebyla jeste zjistena spravna kombinace", false);
    //if(GetEntitiesCollide("tycka_modra_vlozena_dira_1", "dira_1") == true && GetEntitiesCollide("tycka_ruzova_vlozena_dira_2", "dira_2") == true && GetEntitiesCollide("tycka_zelena_vlozena_dira_3", "dira_3") == true && GetEntitiesCollide("tycka_cervena_vlozena_dira_4", "dira_4") == true && GetEntitiesCollide("tycka_zluta_vlozena_dira_5", "dira_5") == true && GetEntitiesCollide("tycka_tyrkysova_vlozena_dira_6", "dira_6") == true)
    if(GetLocalVarString("dira_1_item") == "tycka_modra" && GetLocalVarString("dira_2_item") == "tycka_ruzova" && GetLocalVarString("dira_3_item") == "tycka_zelena" && GetLocalVarString("dira_4_item") == "tycka_cervena" && GetLocalVarString("dira_5_item") == "tycka_zluta" && GetLocalVarString("dira_6_item") == "tycka_tyrkysova")
    {
      SetEntityInteractionDisabled("tycka*", true);
      SetEntityActive("dira*vyndat", false);
      SetLocalVarInt("spravna_kombinace", 1);
      AddDebugMessage("toto je spravna kombinace", false);
      PlaySoundAtEntity("", "puzzle", "Player", 0, false);
      if(QuestIsAdded("q26") && GetLocalVarInt("tlak_vyvazeny") == 1 && GetLocalVarInt("spravna_kombinace") == 1)
      {
        CompleteQuest("q26", "q26");
      }
      GiveSanityBoostSmall();
    }
  }
}

void StateChangePistonLever1(string &in asEntity, int alState)
{
	SetLocalVarInt(asEntity, alState+1);
	float[] aL1 = {-0.075f,0.0f,0.05f};
	float[] aL2 = {0.025f,0.0f,-0.03f};
	float[] aL3 = {0.025f,0.0f,-0.025f};
	float[] aL4 = {-0.075f,0.0f,0.05f};

	float fMove = aL1[GetLocalVarInt("p_lever_5")] + aL2[GetLocalVarInt("p_lever_6")]
				+ aL3[GetLocalVarInt("p_lever_7")] + aL4[GetLocalVarInt("p_lever_8")];

	SetMoveObjectState("piston_1", fMove);

	if(alState != 0){
		PlaySoundAtEntity("piston_1"+fMove, "17_piston_move", "piston_1", 1.0f, false);
		CreateParticleSystemAtEntityExt("pistonp"+fMove, "ps_steam_piston_move", "Area_piston_1", false, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
	}

	if(GetLocalVarInt("p_lever_5") == 0 && GetLocalVarInt("p_lever_6") == 2 &&
		GetLocalVarInt("p_lever_7") == 2 && GetLocalVarInt("p_lever_8") == 0){

		if(GetLocalVarInt("FirstPuzzleSolved")==0)
		{
			SetLocalVarInt("FirstPuzzleSolved", 2);
		}

		AddTimer("dprog1", 1.5f, "TimerDelayProg1");

		for(int i=3;i<6;i++){
			CreateParticleSystemAtEntityExt("steamp"+i, "ps_steam", "SteamAreaPuzzle_"+i, true, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
			PlaySoundAtEntity("steamps"+i, "17_steam_quiet", "SteamAreaPuzzle_"+i, 1.0f, true);
		}

		PlaySoundAtEntity("PistonComp", "17_piston_correct", "PistonDone", 3.0f, true);

		for(int i=1;i<5;i++){
			RemoveEntityCollideCallback("p_lever_"+i, "L_Up_Area_"+i);
			RemoveEntityCollideCallback("p_lever_"+i, "L_Down_Area_"+i);
		}

		PlaySoundAtEntity("pistondone", "17_piston_done", "piston_1", 0.0f, false);

		SetLeverStuckState("p_lever_5", -1, false);
		SetLeverStuckState("p_lever_6", 1, false);
		SetLeverStuckState("p_lever_7", 1, false);
		SetLeverStuckState("p_lever_8", -1, false);

		for(int i=1;i<5;i++)
			SetEntityPlayerInteractCallback("p_lever_"+i, "InteractLockedWheel", false);
	}

	AddDebugMessage("Entity: "+asEntity+"  State: "+alState+"  Value: "+fMove, false);
}

void TimerDelayProg1(string &in asTimer)
{
	DoProgress1();

	if(asTimer != "dprog2") return;

	PlaySoundAtEntity("piston_1", "17_piston_move", "piston_1", 1.0f, false);
	CreateParticleSystemAtEntityExt("pistonp", "ps_steam_piston_move", "Area_piston_1", false, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
}

void DoProgress1()
{
  AddDebugMessage("hele vole kde mam piston1?", false);
  PlayGuiSound("17_start_machine.snt", 1.0f);
  GiveSanityBoostSmall();
  SetLocalVarInt("piston2_srovnany", 1);
  AutoSave();
}

// ---

void StateChangePistonLever(string &in asEntity, int alState)
{
	SetLocalVarInt(asEntity, alState+1);
	float[] aL1 = {-0.075f,0.0f,0.05f};
	float[] aL2 = {0.025f,0.0f,-0.03f};
	float[] aL3 = {0.025f,0.0f,-0.025f};
	float[] aL4 = {-0.075f,0.0f,0.05f};

	float fMove = aL1[GetLocalVarInt("p_lever_1")] + aL2[GetLocalVarInt("p_lever_2")]
				+ aL3[GetLocalVarInt("p_lever_3")] + aL4[GetLocalVarInt("p_lever_4")];

	SetMoveObjectState("piston", fMove);

	if(alState != 0){
		PlaySoundAtEntity("piston"+fMove, "17_piston_move", "piston", 1.0f, false);
		CreateParticleSystemAtEntityExt("pistonp"+fMove, "ps_steam_piston_move", "Area_piston", false, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
	}

	if(GetLocalVarInt("p_lever_1") == 0 && GetLocalVarInt("p_lever_2") == 2 &&
		GetLocalVarInt("p_lever_3") == 2 && GetLocalVarInt("p_lever_4") == 0){

		if(GetLocalVarInt("FirstPuzzleSolved")==0)
		{
			SetLocalVarInt("FirstPuzzleSolved", 2);
		}

		AddTimer("dprog1", 1.5f, "TimerDelayProg");

		for(int i=3;i<6;i++){
			CreateParticleSystemAtEntityExt("steamp"+i, "ps_steam", "SteamAreaPuzzle_"+i, true, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
			PlaySoundAtEntity("steamps"+i, "17_steam_quiet", "SteamAreaPuzzle_"+i, 1.0f, true);
		}

		PlaySoundAtEntity("PistonComp", "17_piston_correct", "PistonDone", 3.0f, true);

		for(int i=1;i<5;i++){
			RemoveEntityCollideCallback("p_lever_"+i, "L_Up_Area_"+i);
			RemoveEntityCollideCallback("p_lever_"+i, "L_Down_Area_"+i);
		}

		PlaySoundAtEntity("pistondone", "17_piston_done", "piston", 0.0f, false);

		SetLeverStuckState("p_lever_1", -1, false);
		SetLeverStuckState("p_lever_2", 1, false);
		SetLeverStuckState("p_lever_3", 1, false);
		SetLeverStuckState("p_lever_4", -1, false);

		for(int i=1;i<5;i++)
			SetEntityPlayerInteractCallback("p_lever_"+i, "InteractLockedWheel", false);
	}

	AddDebugMessage("Entity: "+asEntity+"  State: "+alState+"  Value: "+fMove, false);
}


void TimerDelayProg(string &in asTimer)
{
	DoProgress();

	if(asTimer != "dprog1") return;

	PlaySoundAtEntity("piston", "17_piston_move", "piston", 1.0f, false);
	CreateParticleSystemAtEntityExt("pistonp", "ps_steam_piston_move", "Area_piston", false, 0.8, 0.4, 0.3, 1, true, 0.3f, 0.6f, 12.0f, 13.0f);
}

void DoProgress()
{
  AddDebugMessage("hele vole kde mam piston?", false);
  PlayGuiSound("17_start_machine.snt", 1.0f);
  GiveSanityBoostSmall();
  SetLocalVarInt("piston1_srovnany", 1);
}

void CollideLever(string &in asParent, string &in asChild, int alState)
{
	if(StringContains(asChild,"Down")) //Because Down didn't work reliable.
		SetLeverStuckState(asParent, -1, true);
	else SetLeverStuckState(asParent, 1, true);

	AddTimer(asParent, 0.2f, "TimerReleaseLever");

	AddDebugMessage("Lever: "+asParent+"  Area: "+asChild, false);
}
void TimerReleaseLever(string &in asTimer)
{
	SetLeverStuckState(asTimer, 0, false);
}

void valve_steam_machines_werent_a_failure(string &in asItem, string &in asEntity)
{
  if(GetGlobalVarInt("ma_plnej_kybl") == 1)
  {
    SetPlayerActive(false);
    StartInsanityEvent("wide_normalni");
    SetPropActiveAndFade("kybl", true, 0.3);
    AddTimer("", 0.6, "they_brought_many_devs_to_linux_and_vulkan");
    StartPlayerLookAt("area_kybl_look", 2.5, 5.0, "null");
  }
  else
  {
    SetMessage("TheVoice", "musis_to_naplnit_idiote", 3.0);
  }
}

void they_brought_many_devs_to_linux_and_vulkan(string &in asTimer)
{
  RotatePropToSpeed("kybl", 7.0, 7.0, 0.0, 0.0, 100.0, false, "");
  PlayGuiSound("lejulejuvodu.snt", 1.0f);
  AddTimer("", 0.6, "and_that_is_important");
  CreateParticleSystemAtEntity("ps_kybl", "ps_water_impact_high.ps", "area_kybl", false);
}

void and_that_is_important(string &in asTimer)
{
  StopPropMovement("kybl");
  SetPropActiveAndFade("kybl", false, 0.5);
  GiveSanityBoostSmall();
  StopPlayerLookAt();
  SetPlayerActive(true);
  StopCurrentInsanityEvent();
  SetEntityActive("area_kybl", false);
  SetLocalVarInt("stroj_ma_vodu", 1);
  RemoveItem("kyblstrojovna");
}

void puzzles_too_hard(string &in asItem, string &in asEntity)
{
  if(GetGlobalVarInt("ma_plnou_sklenenou_picovinu") == 1)
  {
    SetPlayerActive(false);
    StartInsanityEvent("wide_normalni");
    SetPropActiveAndFade("letajici_sklenena_picovina", true, 0.3);
    SetEntityInteractionDisabled("letajici_sklenena_picovina", true);
    AddTimer("", 0.6, "puzzles_too_hard_1_out_of_ten_moddb");
    StartPlayerLookAt("area_picovina_look", 2.5, 5.0, "null");
  }
  else
  {
    SetMessage("TheVoice", "musis_to_naplnit_idiote1", 3.0);
  }
}

void puzzles_too_hard_1_out_of_ten_moddb(string &in asTimer)
{
  RotatePropToSpeed("letajici_sklenena_picovina", 7.0, 7.0, 0.0, 0.0, -100.0, false, "");
  PlayGuiSound("lejulejuvodu.snt", 1.0f);
  AddTimer("", 0.6, "who_cares");
  CreateParticleSystemAtEntity("ps_kybl", "ps_water_impact_high.ps", "area_nalevka", false);
}

void who_cares(string &in asTimer)
{
  StopPropMovement("letajici_sklenena_picovina");
  SetPropActiveAndFade("letajici_sklenena_picovina", false, 0.5);
  GiveSanityBoostSmall();
  StopPlayerLookAt();
  SetPlayerActive(true);
  StopCurrentInsanityEvent();
  SetEntityActive("area_nalevka", false);
  SetLocalVarInt("stroj_ma_olej", 1);
  RemoveItem("sklenenapicovina");
}

void cetlmanual(string &in asEntity)
{
  if(GetLocalVarInt("kotel_zapalen") == 0)
  {
    AddQuest("q8", "q8");
  }
  SetEntityActive("area_hedwig", true);
}

void SixLevers(string &in asEntity, int alState)
{
	if(alState == -1){
		if(asEntity == "machine_lever_1") SetLocalVarInt("up_"+asEntity, 3);
		else if(asEntity == "machine_lever_2") SetLocalVarInt("up_"+asEntity, 3);
		else if(asEntity == "machine_lever_3") SetLocalVarInt("up_"+asEntity, 5);
		else if(asEntity == "machine_lever_4") SetLocalVarInt("up_"+asEntity, 1);
		else if(asEntity == "machine_lever_5") SetLocalVarInt("up_"+asEntity, 2);
		else if(asEntity == "machine_lever_6") SetLocalVarInt("up_"+asEntity, 4);

		CheckValue(asEntity);

		AddDebugMessage("Lever Min & up value: " + GetLocalVarInt("up_value"), false);
	}
	else if(alState == 1){
		if(asEntity == "machine_lever_1") SetLocalVarInt("down_"+asEntity, 1);
		else if(asEntity == "machine_lever_2") SetLocalVarInt("down_"+asEntity, 5);
		else if(asEntity == "machine_lever_3") SetLocalVarInt("down_"+asEntity, 6);
		else if(asEntity == "machine_lever_4") SetLocalVarInt("down_"+asEntity, 5);
		else if(asEntity == "machine_lever_5") SetLocalVarInt("down_"+asEntity, 2);
		else if(asEntity == "machine_lever_6") SetLocalVarInt("down_"+asEntity, 2);

		CheckValue(asEntity);

		AddDebugMessage("Lever Max & down value: " + GetLocalVarInt("down_value"), false);
	}
	else if(alState == 0){
		SetLocalVarInt("up_"+asEntity, 0);
		SetLocalVarInt("down_"+asEntity, 0);

		AddDebugMessage("Lever Mid", false);
	}

	if(GetLocalVarInt("up_value") == 8 && GetLocalVarInt("down_value") == 8){

		SetLocalVarInt("tlak_vyvazeny", 1);
    GiveSanityBoostSmall();
    if(QuestIsAdded("q26") && GetLocalVarInt("tlak_vyvazeny") == 1 && GetLocalVarInt("spravna_kombinace") == 1)
    {
      CompleteQuest("q26", "q26");
    }

		for(int i=1;i<7;i++)
			SetLeverStuckState("machine_lever_"+i, GetLeverState("machine_lever_"+i), true);

		for(int i=1;i<=6;i++){
			CreateParticleSystemAtEntity("FlowP"+i, "ps_steam.ps", "FlowParticles_"+i, true);
			PlaySoundAtEntity("FlowS"+i, "13_steam", "FlowParticles_"+i, 0.5, true);
		}

		PlaySoundAtEntity("done"+asEntity, "13_flow_done", asEntity, 0.0f, false);
	}
}

void CheckValue(string sEntity)
{
	PlaySoundAtEntity("s"+sEntity, "lever_mech_min_max", sEntity, 0.0f, false);

	SetLocalVarInt("up_value", 0);
	SetLocalVarInt("down_value", 0);

	for(int i=1;i<=6;i++){
		AddLocalVarInt("up_value", GetLocalVarInt("up_machine_lever_"+i));
		AddLocalVarInt("down_value", GetLocalVarInt("down_machine_lever_"+i));
	}
}

void OnLeave()
{
  StopMusic(1000, 0.5);
  SetGlobalVarInt("dalsi_nacitaci_obrazovka", RandInt(1,5));
  if(GetGlobalVarInt("dalsi_nacitaci_obrazovka") == 1)
  {
    if(GetGlobalVarInt("potkal_helene") == 0)
    {
      if(GetPlayerSanity() < 100 && GetPlayerSanity() > 80)
      {
        SetupLoadScreen("loading", "helene", 0, "nacitani_helene.jpg");
      }
      else if(GetPlayerSanity() < 80 && GetPlayerSanity() > 60)
      {
        SetupLoadScreen("loading", "helene2", 0, "nacitani_helene_horsi.jpg");
      }
      else if(GetPlayerSanity() < 60 && GetPlayerSanity() > 40)
      {
        SetupLoadScreen("loading", "helene3", 0, "nacitani_helene_horsi_horsi.jpg");
      }
      else if(GetPlayerSanity() < 40 && GetPlayerSanity() > 20)
      {
        SetupLoadScreen("loading", "helene4", 0, "nacitani_helene_horsi_horsi_horsi.jpg");
      }
      else if(GetPlayerSanity() < 20)
      {
        SetupLoadScreen("loading", "helene5", 0, "nacitani_helene_horsi_horsi_horsi_horsi.jpg");
      }
    }
    else
    {
      SetupLoadScreen("loading", "helene5", 0, "nacitani_helene_horsi_horsi_horsi_horsi.jpg");
    }
  }
  else if(GetGlobalVarInt("dalsi_nacitaci_obrazovka") == 2)
  {
    SetupLoadScreen("loading", "niklas", 0, "nacitani_niklas.jpg");
  }
  else if(GetGlobalVarInt("dalsi_nacitaci_obrazovka") == 3)
  {
    SetupLoadScreen("loading", "adolf", 0, "nacitani_adolf.jpg");
  }
  else if(GetGlobalVarInt("dalsi_nacitaci_obrazovka") == 4)
  {
    SetupLoadScreen("loading", "gotfried", 0, "nacitani_gotfried.jpg");
  }
  else if(GetGlobalVarInt("dalsi_nacitaci_obrazovka") == 5)
  {
    SetupLoadScreen("loading", "hedwig", 0, "nacitani_hedwig.jpg");
  }
  AutoSave();
}
