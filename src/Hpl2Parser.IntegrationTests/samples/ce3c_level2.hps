//  ___  _         _            _           _   _            ______ _ _ _       
// / _ \| |       | |          | |         | | | |           | ___ (_) | |      
/// /_\ \ |__   __| |_   _  ___| |_ ___  __| | | |__  _   _  | |_/ /_| | |_   _ 
//|  _  |  _ \ / _  | | | |/ __| __/ _ \/ _  | |  _ \| | | | | ___ \ | | | | | |
//| | | | |_) | (_| | |_| | (__| ||  __/ (_| | | |_) | |_| | | |_/ / | | | |_| |
//\_| |_/____/ \__,_|\__,_|\___|\__\___|\__,_| |____/ \__, | \____/|_|_|_|\__, |
//                                                     __/ |               __/ |
//                                                    |___/               |___/   
//													
//													By: Nick Debergue
//													
//****IF YOU'RE READING: Good luck understanding this gibberish :)
//****Contact: perceptionist420@ymail.com
//****Or message me or comment at Mod/Indie DB! I'm always looking for collaborations!
//****
//****CHEATS: Search the code for "hax" (CAUTION: YOU MUST COMMENT/UNCOMMENT THESE SEGMENTS CORRECTLY FOR THE DESIRED EFFECT!)
//
//
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////---BEGINNING---//////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void startArea1(string &in asEntity, int alState){
	
	if(GetGlobalVarInt("fromLvl2") == 0){
		SetGlobalVarInt("fromLvl2", 1);
		SetMapDisplayNameEntry("LVL2");
		
		if(GetGlobalVarInt("lvl2FirstRun") == 0){
			for(int i = 1; i <= 15; ++i){
				SetLightVisible("labLight"+i, false);
			}
			
			SetLightVisible("BoxLight_2", false);
			SetLightVisible("tvLightF", false);
			SetLightVisible("tvLight", false);
			
			AddGlobalVarInt("fromLvl3", 0);
			
			AddLocalVarInt("blueScreen", 1);
			AddLocalVarInt("bluescreen2", 1);
			AddLocalVarInt("lightsOn", 1);
			AddLocalVarInt("lightsOn2", 0);
			AddLocalVarInt("stepsPassed", 1);
			AddGlobalVarInt("lvl2Scare1", 0);
			AddGlobalVarInt("lvl2Scare2", 0);
			AddGlobalVarInt("lvl2TV", 0);
			AddLocalVarInt("staticNumb", 1);
			
			AddGlobalVarInt("lvl2FirstRun", 1);
		}
		
		if((HasItem("hallwayKey2"))||(GetGlobalVarInt("unlockedLab") == 1)){
			SetMessage("Messages", "lvl2Enter2", 8);
			if((GetGlobalVarInt("lvl2TV") < 2)&&(GetGlobalVarInt("lvl2Scare2") == 1)){
				SetEntityActive("static5", false);
				SetEntityActive("static6", false);
				SetEntityActive("static7", false);
				SetEntityActive("static8", false);
				SetEntityActive("tvOff4", false);
				
				PlaySoundAtEntity("static1", "static_far.snt", "TV1", 0, false);
				SetLocalVarInt("staticNumb", 1);
				AddTimer("static", 0.1, "randomStatic");
				SetLightVisible("BoxLight_2", true);
				SetLightVisible("tvLightF", true);
				AddEntityCollideCallback("Player", "startTv", "startTv", true, 1);
			}
		}else{
			SetMessage("Messages", "lvl2Enter1", 8);
		}
		
		if(GetGlobalVarInt("lvl2Scare1") == 0){
			AddEntityCollideCallback("Player", "triggerCry", "triggerCry1", true, 1);
			AddEntityCollideCallback("Player", "startSteps", "startSteps", true, 1);
			AddEntityCollideCallback("Player", "triggerBox", "triggerBox1", true, 1);
			
			SetLampLit("lanternScare1", false, false);
			SetLampLit("lanternScare2", false, false);
			SetLampLit("lanternScare3", false, false);
			SetLampLit("lanternScare4", false, false);
			SetLampLit("lanternScare5", false, false);
			SetLampLit("lanternScare6", false, false);
			SetLampLit("lanternScare7", false, false);
			SetLampLit("lanternScare8", false, false);
			SetLampLit("lanternScare9", false, false);
			SetLampLit("lanternScare10", false, false);
			SetLampLit("lanternScare11", false, false);
		}
		
		if(GetGlobalVarInt("lvl2Scare2") == 0){
			SetLightVisible("bathroom1_14", false);
			SetLightVisible("bathroom1_15", false);
			SetLightVisible("bathroom1_16", false);
			SetLightVisible("bathroom1_17", false);
			SetLightVisible("bathroom1_18", false);
			SetLightVisible("bathroom1_19", false);
			SetLightVisible("bathroom1_20", false);
			SetLightVisible("bathroom1_21", false);
			SetLightVisible("bathroom1_22", false);
			SetLightVisible("bathroom1_23", false);
			SetLightVisible("bathroom1_24", false);
			SetLightVisible("bathroom1_25", false);
			SetLightVisible("bathroom1_26", false);
			AddEntityCollideCallback("Player", "showerScareTrigger", "triggerShowerScare", true, 1);
			
		}
		
		AddEntityCollideCallback("Player", "fall_1", "startFall1", false, 1);
		AddEntityCollideCallback("Player", "fall_3", "startFall2", false, 1);
		
		AddEntityCollideCallback("Player", "enterFirstFloor", "spawnFirstFloor", true, 1);
		
		PlaySoundAtEntity("showerDrips", "drips.snt", "showerDrips", 0.1, true);
		PlaySoundAtEntity("waterDrips", "running_water.snt", "waterDrips", 0.1, true);
		PlaySoundAtEntity("acid_container_1", "acid_close.snt", "acid_container_1", 0.1, true);
		
		SetEntityPlayerInteractCallback("light_switch_1", "switchLights", false);
		SetEntityPlayerInteractCallback("light_switch_2", "switchLights2", false);
		
		SetEntityPlayerInteractCallback("mansion_1", "checkifLocked", false);
		SetEntityPlayerInteractCallback("mansion_2", "checkifLocked", false);
		SetEntityPlayerInteractCallback("mansion_3", "checkifLocked", false);
		
		AddUseItemCallback("unlockLab", "hallwayKey2", "mansion_3", "unlockLab", true);
		
		SetEntityInteractionDisabled("pincers_1", true);
		SetEntityInteractionDisabled("plane_1", true);
		
		PlayMusic("ambient2.ogg", true, 1, 2, 1, true);
		
		//HAXE
		//TeleportPlayer("start2");//////////////////////////////////////////HAXE
		
		AutoSave();
	}
}

void died(string &in asName, int alCount){
	
	SetEntityPlayerInteractCallback("mansion_1", "checkifLocked", false);
	SetEntityPlayerInteractCallback("mansion_2", "checkifLocked", false);
	SetEntityPlayerInteractCallback("mansion_3", "checkifLocked", false);

	if(asName == "upstairs"){
		if(GetGlobalVarInt("lvl2Scare1") == 0){
			SetLocalVarInt("stepsPassed", 1);
			AddEntityCollideCallback("Player", "triggerCry", "triggerCry1", true, 1);
			AddEntityCollideCallback("Player", "startSteps", "startSteps", true, 1);
			AddEntityCollideCallback("Player", "triggerBox", "triggerBox1", true, 1);
		}
		
		AddEntityCollideCallback("Player", "fall_1", "startFall1", false, 1);
		AddEntityCollideCallback("Player", "fall_3", "startFall2", false, 1);
		
		SetPlayerActive(true);
		
	}if(asName == "downstairs"){
		AddEntityCollideCallback("Player", "fall_1", "startFall1", false, 1);
		AddEntityCollideCallback("Player", "fall_3", "startFall2", false, 1);
		
		SetPlayerActive(true);
		
	}else if((asName == "usedAcid1")||(asName == "usedAcid2")){
		SetPlayerSanity(100);
		SetPlayerJumpDisabled(false);
		SetPlayerMoveSpeedMul(1);
		SetPlayerRunSpeedMul(1);
		SetPlayerActive(false);
		AddTimer("startMonsterDied", 2, "startMonsterDied");
		
	}else if((asName == "gotAcid1")||(asName == "gotAcid2")||(asName == "gotHandDrill")){
		SetPlayerSanity(100);
		SetPlayerJumpDisabled(false);
		SetPlayerMoveSpeedMul(1);
		SetPlayerRunSpeedMul(1);
		AddEntityCollideCallback("Player", "startMonster", "startMonster", true, 1);
		AddEntityCollideCallback("Player", "disableJump1", "disableJump", true, 1);
		SetPlayerActive(true);
	}else if(asName == "fromLvl3"){
		SetPlayerSanity(100);
		SetPlayerJumpDisabled(false);
		SetPlayerMoveSpeedMul(1);
		SetPlayerRunSpeedMul(1);
		AddEntityCollideCallback("Player", "startMonster2", "startMonster", true, 1);
		AddEntityCollideCallback("Player", "disableJump2", "disableJump", true, 1);
		SetPlayerActive(true);
	}
}

void triggerCry1(string &in asParent, string &in asChild, int alState){
	SetEntityActive("corpse_male_1", true);
	PlayGuiSound("react_pant.snt", 1);
	SetPlayerSanity(10);
	AddEntityCollideCallback("Player", "stopInsanity1", "stopInsanity1", true, 1);
	CreateParticleSystemAtEntity("storm1", "ps_dust_whirl_large.ps", "storm1", true);
	CreateParticleSystemAtEntity("storm2", "ps_dust_whirl_large.ps", "storm2", true);
	CreateParticleSystemAtEntity("storm3", "ps_dust_whirl_large.ps", "storm3", true);
	CreateParticleSystemAtEntity("storm4", "ps_dust_whirl_large.ps", "storm4", true);
	CreateParticleSystemAtEntity("storm5", "ps_dust_whirl_large.ps", "storm5", true);
	CreateParticleSystemAtEntity("storm6", "ps_dust_whirl_large.ps", "storm6", true);
	CreateParticleSystemAtEntity("storm7", "ps_dust_whirl_large.ps", "storm7", true);
	AddTimer("lanternScare1", 1, "lanternScare1");
	PlaySoundAtEntity("cry1", "12_girl_scream.snt", "12_girl_cry_1", 0.1, true);
	PlayGuiSound("general_wind_whirl5.ogg", 90.0f);
	PlayMusic("01_event_dust.ogg", false, 1, 0, 2, true);
	
}

void stopInsanity1(string &in asParent, string &in asChild, int alState){
	SetPlayerSanity(100);
}

void lanternScare1(string &in asTimer){
	SetLampLit("lanternScare1", false, false);
	SetLampLit("lanternScare2", false, false);
	SetLampLit("lanternScare3", false, false);
	SetLampLit("lanternScare4", false, false);
	SetLampLit("lanternScare5", false, false);
	SetLampLit("lanternScare6", false, false);
	SetLampLit("lanternScare7", false, false);
	SetLampLit("lanternScare8", false, false);
	SetLampLit("lanternScare9", false, false);
	SetLampLit("lanternScare10", false, false);
	SetLampLit("lanternScare11", false, false);
}

void startSteps(string &in asParent, string &in asChild, int alState){
	SetLampLit("lanternScare1", true, false);
	SetLampLit("lanternScare2", true, false);
	SetLampLit("lanternScare3", true, false);
	SetLampLit("lanternScare4", true, false);
	SetLampLit("lanternScare5", true, false);
	SetLampLit("lanternScare6", true, false);
	SetLampLit("lanternScare7", true, true);
	SetLampLit("lanternScare8", true, true);
	SetLampLit("lanternScare9", true, false);
	SetLampLit("lanternScare10", true, false);
	SetLampLit("lanternScare11", true, true);
	AddTimer("stepsTimer", 0.4, "doSteps");
}

void startFall1(string &in asParent, string &in asChild, int alState){
	AddEntityCollideCallback("Player", "fall_2", "die1", true, 1);
	AddTimer("stopFall1", 1, "stopFall1");
}

void stopFall1(string &in asTimer){
	RemoveEntityCollideCallback("Player", "fall_2");
}

void startFall2(string &in asParent, string &in asChild, int alState){
	AddEntityCollideCallback("Player", "fall_4", "die1", true, 1);
	AddTimer("stopFall2", 1, "stopFall2");
}

void stopFall2(string &in asTimer){
	RemoveEntityCollideCallback("Player", "fall_4");
}

void doSteps(string &in asTimer){
	if(GetLocalVarInt("stepsPassed") < 17){
		PlaySoundAtEntity("steps_"+GetLocalVarInt("stepsPassed"), "29_daniel_footsteps.snt", "steps_"+GetLocalVarInt("stepsPassed"), 0.1, true);
		CreateParticleSystemAtEntity("footDust"+GetLocalVarInt("stepsPassed"), "ps_dust_impact.ps", "steps_"+GetLocalVarInt("stepsPassed"), false);
		SetLocalVarInt("stepsPassed", GetLocalVarInt("stepsPassed")+1);
		AddTimer("stepsTimer", 0.4, "doSteps");
	}
}

void triggerBox1(string &in asParent, string &in asChild, int alState){
	SetEntityActive("box1", true);
	AddTimer("makeBox1Static", 1.5, "makeBox1Static");
}

void makeBox1Static(string &in asTimer){
	SetPropStaticPhysics("box1", true);
	SetGlobalVarInt("lvl2Scare1", 1);
}

void randomStatic(string &in asTimer){
	if(GetLocalVarInt("staticNumb") == 1){
		SetEntityActive("static5", true);
		SetEntityActive("static6", false);
		SetEntityActive("static7", false);
		SetEntityActive("static8", false);
		SetLocalVarInt("staticNumb", GetLocalVarInt("staticNumb")+1);
		AddTimer("static1", 0.01, "randomStatic");
		return;
	
	}else if(GetLocalVarInt("staticNumb") == 2){
		SetEntityActive("static5", false);
		SetEntityActive("static6", true);
		SetEntityActive("static7", false);
		SetEntityActive("static8", false);
		SetLocalVarInt("staticNumb", GetLocalVarInt("staticNumb")+1);
		AddTimer("static1", 0.05, "randomStatic");
		return;
	
	}else if(GetLocalVarInt("staticNumb") == 3){
		SetEntityActive("static5", false);
		SetEntityActive("static6", false);
		SetEntityActive("static7", true);
		SetEntityActive("static8", false);
		SetLocalVarInt("staticNumb", GetLocalVarInt("staticNumb")+1);
		AddTimer("static1", 0.05, "randomStatic");
		return;
	
	}else if(GetLocalVarInt("staticNumb") == 4){
		SetEntityActive("static5", false);
		SetEntityActive("static6", false);
		SetEntityActive("static7", false);
		SetEntityActive("static8", true);
		SetLocalVarInt("staticNumb", 1);
		AddTimer("static1", 0.05, "randomStatic");
		return;
	
	}
}

void switchLights(string &in asEntity){
	if(GetLocalVarInt("lightsOn") == 0){
		SetLightVisible("bathroom1_1", true);
		SetLightVisible("bathroom1_2", true);
		SetLightVisible("bathroom1_3", true);
		SetLightVisible("bathroom1_4", true);
		SetLightVisible("bathroom1_5", true);
		SetLightVisible("bathroom1_6", true);
		SetLightVisible("bathroom1_7", true);
		SetLightVisible("bathroom1_8", true);
		SetLightVisible("bathroom1_9", true);
		SetLightVisible("bathroom1_10", true);
		SetLightVisible("bathroom1_11", true);
		SetLightVisible("bathroom1_12", true);
		SetLightVisible("bathroom1_13", true);
		SetLocalVarInt("lightsOn", 1);
		PlayGuiSound("light_on.ogg", 10);
	}else if(GetLocalVarInt("lightsOn") == 1){
		SetLightVisible("bathroom1_1", false);
		SetLightVisible("bathroom1_2", false);
		SetLightVisible("bathroom1_3", false);
		SetLightVisible("bathroom1_4", false);
		SetLightVisible("bathroom1_5", false);
		SetLightVisible("bathroom1_6", false);
		SetLightVisible("bathroom1_7", false);
		SetLightVisible("bathroom1_8", false);
		SetLightVisible("bathroom1_9", false);
		SetLightVisible("bathroom1_10", false);
		SetLightVisible("bathroom1_11", false);
		SetLightVisible("bathroom1_12", false);
		SetLightVisible("bathroom1_13", false);
		SetLocalVarInt("lightsOn", 0);
		PlayGuiSound("light_off.ogg", 10);
	}
}

void switchLights2(string &in asEntity){
	if(GetLocalVarInt("lightsOn2") == 0){
		for(int i = 1; i <= 15; ++i){
			SetLightVisible("labLight"+i, true);
		}
		SetLocalVarInt("lightsOn2", 1);
		PlayGuiSound("light_on.ogg", 10);
	}else if(GetLocalVarInt("lightsOn2") == 1){
		for(int i = 1; i <= 15; ++i){
			SetLightVisible("labLight"+i, false);
		}
		SetLocalVarInt("lightsOn2", 0);
		PlayGuiSound("light_off.ogg", 10);
	}
}

void triggerShowerScare(string &in asParent, string &in asChild, int alState){
	if(GetGlobalVarInt("lvl2Scare2") == 0){
		PlayGuiSound("insanity_whisper01.ogg", 10);
		AddEntityCollideCallback("Player", "showerScareTrigger2", "triggerShowerScare2", true, 1);
	}
}

void triggerShowerScare2(string &in asParent, string &in asChild, int alState){
	if(GetGlobalVarInt("lvl2Scare2") == 0){
		SetSwingDoorLocked("mansion_2", true, true);
		SetSwingDoorClosed("mansion_2", true, true);
	
		SetPlayerMoveSpeedMul(0);
		SetPlayerRunSpeedMul(0);
		SetPlayerJumpDisabled(true);
	
		SetLightVisible("bathroom1_1", false);
		SetLightVisible("bathroom1_2", false);
		SetLightVisible("bathroom1_3", false);
		SetLightVisible("bathroom1_4", false);
		SetLightVisible("bathroom1_5", false);
		SetLightVisible("bathroom1_6", false);
		SetLightVisible("bathroom1_7", false);
		SetLightVisible("bathroom1_8", false);
		SetLightVisible("bathroom1_9", false);
		SetLightVisible("bathroom1_10", false);
		SetLightVisible("bathroom1_11", false);
		SetLightVisible("bathroom1_12", false);
		SetLightVisible("bathroom1_13", false);
	
		SetLightVisible("bathroom1_14", true);
		SetLightVisible("bathroom1_15", true);
		SetLightVisible("bathroom1_16", true);
		SetLightVisible("bathroom1_17", true);
		SetLightVisible("bathroom1_18", true);
		SetLightVisible("bathroom1_19", true);
		SetLightVisible("bathroom1_20", true);
		SetLightVisible("bathroom1_21", true);
		SetLightVisible("bathroom1_22", true);
		SetLightVisible("bathroom1_23", true);
		SetLightVisible("bathroom1_24", true);
		SetLightVisible("bathroom1_25", true);
		SetLightVisible("bathroom1_26", true);
		
		SetEntityActive("showerScareCorpse_1", true);
		SetEntityActive("showerScareChair_1", true);
		
		PlayGuiSound("react_pant.snt", 1);
		PlayGuiSound("sanity_heartbeat.snt", 1);
		
		PlayMusic("12_event_blood.ogg", false, 1, 3, 3, false);
		
		SetPlayerSanity(0);
		PlayGuiSound("00_faint.ogg", 100.0f);
		
		StartPlayerLookAt("showerScareCorpse_1", 3, 3, "releaseLook");
		
		SetGlobalVarInt("lvl2Scare2", 1);
		SetLocalVarInt("lightsOn", 2);
		
		AddTimer("showerScare1", 2, "showerScare");
	}
}

void showerScare(string &in asTimer){
	if(asTimer == "showerScare1"){
		PlaySoundAtEntity("showerSounds1", "insanity_whisper.snt", "showerSounds", 0.1, true);
	
		SetLightVisible("bathroom1_14", false);
		SetLightVisible("bathroom1_15", false);
		SetLightVisible("bathroom1_16", false);
		SetLightVisible("bathroom1_17", false);
		SetLightVisible("bathroom1_18", false);
		SetLightVisible("bathroom1_19", false);
		SetLightVisible("bathroom1_20", false);
		SetLightVisible("bathroom1_21", false);
		SetLightVisible("bathroom1_22", false);
		SetLightVisible("bathroom1_23", false);
		SetLightVisible("bathroom1_24", false);
		SetLightVisible("bathroom1_25", false);
		SetLightVisible("bathroom1_26", false);
		
		SetEntityActive("showerScareCorpse_1", false);
		SetEntityActive("showerScareChair_1", false);
		
		AddTimer("showerScare2", 2, "showerScare");
	}
	if(asTimer == "showerScare2"){
		PlayGuiSound("sanity_heartbeat1.ogg", 90);
		
		SetLightVisible("bathroom1_15", true);
		SetLightVisible("bathroom1_16", true);
		SetLightVisible("bathroom1_17", true);
		SetLightVisible("bathroom1_18", true);
		SetLightVisible("bathroom1_19", true);
		SetLightVisible("bathroom1_20", true);
		SetLightVisible("bathroom1_21", true);
		SetLightVisible("bathroom1_22", true);
		SetLightVisible("bathroom1_23", true);
		SetLightVisible("bathroom1_24", true);
		SetLightVisible("bathroom1_25", true);
		SetLightVisible("bathroom1_26", true);
		
		SetEntityActive("showerScareCorpse_2", true);
		SetEntityActive("showerScareChair_2", true);
		
		AddTimer("showerScare3", 2, "showerScare");
	}
	if(asTimer == "showerScare3"){
		PlaySoundAtEntity("showerSounds2", "insanity_whisper.snt", "showerSounds", 0.1, true);
	
		SetLightVisible("bathroom1_14", false);
		SetLightVisible("bathroom1_15", false);
		SetLightVisible("bathroom1_16", false);
		SetLightVisible("bathroom1_17", false);
		SetLightVisible("bathroom1_18", false);
		SetLightVisible("bathroom1_19", false);
		SetLightVisible("bathroom1_20", false);
		SetLightVisible("bathroom1_21", false);
		SetLightVisible("bathroom1_22", false);
		SetLightVisible("bathroom1_23", false);
		SetLightVisible("bathroom1_24", false);
		SetLightVisible("bathroom1_25", false);
		SetLightVisible("bathroom1_26", false);
		
		SetEntityActive("showerScareCorpse_2", false);
		SetEntityActive("showerScareChair_2", false);
		
		AddTimer("showerScare4", 2, "showerScare");
	}
	if(asTimer == "showerScare4"){
		PlayGuiSound("sanity_heartbeat1.ogg", 90);
	
		SetLightVisible("bathroom1_15", true);
		SetLightVisible("bathroom1_16", true);
		SetLightVisible("bathroom1_17", true);
		SetLightVisible("bathroom1_18", true);
		SetLightVisible("bathroom1_19", true);
		SetLightVisible("bathroom1_20", true);
		SetLightVisible("bathroom1_21", true);
		SetLightVisible("bathroom1_22", true);
		SetLightVisible("bathroom1_23", true);
		SetLightVisible("bathroom1_24", true);
		SetLightVisible("bathroom1_25", true);
		SetLightVisible("bathroom1_26", true);
		
		SetEntityActive("showerScareCorpse_3", true);
		SetEntityActive("showerScareChair_3", true);
		
		AddTimer("showerScare5", 2, "showerScare");
	}
	if(asTimer == "showerScare5"){
		PlaySoundAtEntity("showerSounds3", "insanity_whisper.snt", "showerSounds", 0.1, true);
		
		SetLightVisible("bathroom1_14", false);
		SetLightVisible("bathroom1_15", false);
		SetLightVisible("bathroom1_16", false);
		SetLightVisible("bathroom1_17", false);
		SetLightVisible("bathroom1_18", false);
		SetLightVisible("bathroom1_19", false);
		SetLightVisible("bathroom1_20", false);
		SetLightVisible("bathroom1_21", false);
		SetLightVisible("bathroom1_22", false);
		SetLightVisible("bathroom1_23", false);
		SetLightVisible("bathroom1_24", false);
		SetLightVisible("bathroom1_25", false);
		SetLightVisible("bathroom1_26", false);
		
		SetEntityActive("showerScareCorpse_3", false);
		SetEntityActive("showerScareChair_3", false);
		
		AddTimer("showerScare6", 2, "showerScare");
	}
	if(asTimer == "showerScare6"){
		PlayGuiSound("sanity_heartbeat1.ogg", 90);
		
		SetLightVisible("bathroom1_15", true);
		SetLightVisible("bathroom1_16", true);
		SetLightVisible("bathroom1_17", true);
		SetLightVisible("bathroom1_18", true);
		SetLightVisible("bathroom1_19", true);
		SetLightVisible("bathroom1_20", true);
		SetLightVisible("bathroom1_21", true);
		SetLightVisible("bathroom1_22", true);
		SetLightVisible("bathroom1_23", true);
		SetLightVisible("bathroom1_24", true);
		SetLightVisible("bathroom1_25", true);
		SetLightVisible("bathroom1_26", true);
		
		SetEntityActive("showerScareCorpse_4", true);
		SetEntityActive("showerScareChair_4", true);
		
		AddTimer("showerScare7", 2, "showerScare");
	}
	if(asTimer == "showerScare7"){
		PlaySoundAtEntity("showerSounds4", "insanity_whisper.snt", "showerSounds", 0.1, true);
		
		SetLightVisible("bathroom1_14", false);
		SetLightVisible("bathroom1_15", false);
		SetLightVisible("bathroom1_16", false);
		SetLightVisible("bathroom1_17", false);
		SetLightVisible("bathroom1_18", false);
		SetLightVisible("bathroom1_19", false);
		SetLightVisible("bathroom1_20", false);
		SetLightVisible("bathroom1_21", false);
		SetLightVisible("bathroom1_22", false);
		SetLightVisible("bathroom1_23", false);
		SetLightVisible("bathroom1_24", false);
		SetLightVisible("bathroom1_25", false);
		SetLightVisible("bathroom1_26", false);
		
		SetEntityActive("showerScareCorpse_4", false);
		SetEntityActive("showerScareChair_4", false);
		
		AddTimer("showerScare8", 2, "showerScare");
	}
	if(asTimer == "showerScare8"){
		PlayGuiSound("sanity_heartbeat1.ogg", 90);
		
		SetLightVisible("bathroom1_15", true);
		SetLightVisible("bathroom1_16", true);
		SetLightVisible("bathroom1_17", true);
		SetLightVisible("bathroom1_18", true);
		SetLightVisible("bathroom1_19", true);
		SetLightVisible("bathroom1_20", true);
		SetLightVisible("bathroom1_21", true);
		SetLightVisible("bathroom1_22", true);
		SetLightVisible("bathroom1_23", true);
		SetLightVisible("bathroom1_24", true);
		SetLightVisible("bathroom1_25", true);
		SetLightVisible("bathroom1_26", true);
		
		SetEntityActive("showerScareCorpse_5", true);
		SetEntityActive("showerScareChair_5", true);
		
		AddTimer("showerScare9", 2, "showerScare");
	}
	if(asTimer == "showerScare9"){
		PlaySoundAtEntity("showerSounds5", "insanity_whisper.snt", "showerSounds", 0.1, true);
		
		SetLightVisible("bathroom1_14", false);
		SetLightVisible("bathroom1_15", false);
		SetLightVisible("bathroom1_16", false);
		SetLightVisible("bathroom1_17", false);
		SetLightVisible("bathroom1_18", false);
		SetLightVisible("bathroom1_19", false);
		SetLightVisible("bathroom1_20", false);
		SetLightVisible("bathroom1_21", false);
		SetLightVisible("bathroom1_22", false);
		SetLightVisible("bathroom1_23", false);
		SetLightVisible("bathroom1_24", false);
		SetLightVisible("bathroom1_25", false);
		SetLightVisible("bathroom1_26", false);
		
		SetEntityActive("showerScareCorpse_5", false);
		SetEntityActive("showerScareChair_5", false);
		
		AddTimer("showerScare10", 2, "showerScare");
	}
	if(asTimer == "showerScare10"){
		SetSwingDoorLocked("mansion_2", false, true);
		PlayGuiSound("sanity_heartbeat1.ogg", 90);
		
		SetLightVisible("bathroom1_1", true);
		SetLightVisible("bathroom1_2", true);
		SetLightVisible("bathroom1_3", true);
		SetLightVisible("bathroom1_4", true);
		SetLightVisible("bathroom1_5", true);
		SetLightVisible("bathroom1_6", true);
		SetLightVisible("bathroom1_7", true);
		SetLightVisible("bathroom1_8", true);
		SetLightVisible("bathroom1_9", true);
		SetLightVisible("bathroom1_10", true);
		SetLightVisible("bathroom1_11", true);
		SetLightVisible("bathroom1_12", true);
		SetLightVisible("bathroom1_13", true);
		
		SetPlayerMoveSpeedMul(1);
		SetPlayerRunSpeedMul(1);
		SetPlayerJumpDisabled(false);
		
		SetPlayerSanity(10);
		
		SetLocalVarInt("lightsOn", 1);
		
		PlaySoundAtEntity("static1", "static_far.snt", "TV1", 0, false);
		SetLocalVarInt("staticNumb", 1);
		AddTimer("static", 0.1, "randomStatic");
		SetLightVisible("BoxLight_2", true);
		SetLightVisible("tvLightF", true);
		AddEntityCollideCallback("Player", "startTv", "startTv", true, 1);
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//START TV//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void startTv(string &in asParent, string &in asChild, int alState){
	StopSound("static1", 0);
	SetPlayerSanity(100);
	SetLocalVarInt("blueScreen", 1);
	SetLocalVarInt("bluescreen2", 1);
	
	if((HasItem("hallwayKey2"))||(GetGlobalVarInt("unlockedLab") == 1)){
		PlayGuiSound("billy3_withKey.ogg", 10);
		AddTimer("ST24", 7.5, "subTitles");
		AddTimer("ST25", 10, "subTitles");
		AddTimer("ST26", 13.5, "subTitles");
		AddTimer("ST27", 16.5, "subTitles");
		AddTimer("ST28", 19, "subTitles");
		AddTimer("ST29", 22, "subTitles");
		AddTimer("ST30", 26.6, "subTitles");
		AddTimer("ST31", 30.3, "subTitles");
		
		AddTimer("bluescreen2", 0.5, "bluescreen2");
	}else{
		PlayGuiSound("billy3_noKey.ogg", 10);
		AddTimer("ST15", 7.5, "subTitles");
		AddTimer("ST16", 9, "subTitles");
		AddTimer("ST17", 12, "subTitles");
		AddTimer("ST18", 14.5, "subTitles");
		AddTimer("ST19", 17.5, "subTitles");
		AddTimer("ST20", 20.5, "subTitles");
		AddTimer("ST21", 23.5, "subTitles");
		AddTimer("ST22", 28.4, "subTitles");
		AddTimer("ST23", 32, "subTitles");
		
		AddTimer("blueScreen", 0.5, "blueScreen1");
	}
	
	//remove static
	RemoveTimer("static1");
	SetEntityActive("static5", false);
	SetEntityActive("static6", false);
	SetEntityActive("static7", false);
	SetEntityActive("static8", false);
	//and old screen
	SetEntityActive("tvOff4", false);
	
	//
	SetPlayerActive(false);
	StartPlayerLookAt("TV1", 10, 10, "releaseLook");
	
	//start blue screen
	SetEntityActive("blueScreen1", true);
	SetLightVisible("tvLightF", false);
	SetLightVisible("tvLight", true);
}

void subTitles(string &in asTimer){
	SetMessage("Messages", asTimer, 5);
}

void blueScreen1(string &in asTimer){
	if((GetLocalVarInt("blueScreen") == 1)||(GetLocalVarInt("blueScreen") == 3)||(GetLocalVarInt("blueScreen") == 5)){
		SetEntityActive("blueScreen2", true);
		SetEntityActive("blueScreen1", false);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.5, "blueScreen1");
	}else if((GetLocalVarInt("blueScreen") == 2)||(GetLocalVarInt("blueScreen") == 4)||(GetLocalVarInt("blueScreen") == 6)){
		SetEntityActive("blueScreen1", true);
		SetEntityActive("blueScreen2", false);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.5, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 7){
		SetEntityActive("blueScreen1", false);
		SetEntityActive("blueScreenPlay", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 1.2, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 8){
		SetEntityActive("blueScreenPlay", false);
		SetEntityActive("static5", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.3, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 9){
		SetEntityActive("static5", false);
		SetEntityActive("static6", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.3, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 10){
		SetEntityActive("static6", false);
		SetEntityActive("static7", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.3, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 11){
		SetEntityActive("static7", false);
		SetEntityActive("static8", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.3, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 12){
		SetEntityActive("static8", false);
		SetEntityActive("static5", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.2, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 13){
		SetEntityActive("static5", false);
		SetEntityActive("billy_tv1", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 6, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 14){
		FadeOut(1);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 15){
		TeleportPlayer("tvCutscene");
		MovePlayerHeadPos(0, 5, 0, 100, 1);
		StartPlayerLookAt("cutsceneLook1", 30, 30, "");
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 16){
		FadeIn(1);
		
		AddTimer("pushForward1", 0.1, "pushForward1");
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 12, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 17){
		FadeOut(1);
		
		StopPlayerLookAt();
		
		RemoveTimer("pushForward1");
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 18){
		TeleportPlayer("tvEnd");
		MovePlayerHeadPos(0, 0, 0, 100, 1);
		
		RemoveTimer("pushForward1");
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 19){
		FadeIn(1);
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 5.8, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 20){
		SetEntityActive("static5", true);
		SetEntityActive("billy_tv1", false);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 21){
		SetEntityActive("static5", false);
		SetEntityActive("tvOff1", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 22){
		SetEntityActive("tvOff1", false);
		SetEntityActive("tvOff2", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 23){
		SetEntityActive("tvOff2", false);
		SetEntityActive("tvOff3", true);
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 24){
		SetEntityActive("tvOff3", false);
		SetEntityActive("tvOff4", true);
		SetLightVisible("BoxLight_2", false);
		SetLightVisible("tvLight", false);
		
		SetLocalVarInt("blueScreen", GetLocalVarInt("blueScreen")+1);
		AddTimer("blueScreen", 0.1, "blueScreen1");
	}else if(GetLocalVarInt("blueScreen") == 25){
		SetPlayerActive(true);
		
		if(GetGlobalVarInt("lvl2TV") == 0){
			SetGlobalVarInt("lvl2TV", 1);
		}
		
		SetEntityPlayerInteractCallback("replayTV", "replayTV", true);
		
		TeleportPlayer("PlayerStartArea_1");
		
		AutoSave();
	}
}

void replayTV(string &in asEntity){
	SetEntityActive("static5", false);
	SetEntityActive("static6", false);
	SetEntityActive("static7", false);
	SetEntityActive("static8", false);
	SetEntityActive("tvOff4", false);
	
	PlaySoundAtEntity("static1", "static_far.snt", "TV1", 0, false);
	SetLocalVarInt("staticNumb", 1);
	AddTimer("static", 0.1, "randomStatic");
	SetLightVisible("BoxLight_2", true);
	SetLightVisible("tvLightF", true);
	
	AddTimer("addTVCollide", 2, "addTVCollide");
}

void addTVCollide(string &in asTimer){
	AddEntityCollideCallback("Player", "startTv", "startTv", true, 1);
}

void bluescreen2(string &in asTimer){
	if((GetLocalVarInt("bluescreen2") == 1)||(GetLocalVarInt("bluescreen2") == 3)||(GetLocalVarInt("bluescreen2") == 5)){
		SetEntityActive("blueScreen2", true);
		SetEntityActive("blueScreen1", false);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.5, "bluescreen2");
	}else if((GetLocalVarInt("bluescreen2") == 2)||(GetLocalVarInt("bluescreen2") == 4)||(GetLocalVarInt("bluescreen2") == 6)){
		SetEntityActive("blueScreen1", true);
		SetEntityActive("blueScreen2", false);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.5, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 7){
		SetEntityActive("blueScreen1", false);
		SetEntityActive("blueScreenPlay", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 1.2, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 8){
		SetEntityActive("blueScreenPlay", false);
		SetEntityActive("static5", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.3, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 9){
		SetEntityActive("static5", false);
		SetEntityActive("static6", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.3, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 10){
		SetEntityActive("static6", false);
		SetEntityActive("static7", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.3, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 11){
		SetEntityActive("static7", false);
		SetEntityActive("static8", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.3, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 12){
		SetEntityActive("static8", false);
		SetEntityActive("static5", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.2, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 13){
		SetEntityActive("static5", false);
		SetEntityActive("billy_tv1", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 5, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 14){
		FadeOut(1);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 15){
		TeleportPlayer("tvCutscene");
		MovePlayerHeadPos(0, 5, 0, 100, 1);
		StartPlayerLookAt("cutsceneLook1", 30, 30, "");
		
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 16){
		FadeIn(1);
		
		AddTimer("pushForward1", 0.1, "pushForward1");
		
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 11, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 17){
		FadeOut(1);
		
		StopPlayerLookAt();
		
		RemoveTimer("pushForward1");
		
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 18){
		TeleportPlayer("tvEnd");
		MovePlayerHeadPos(0, 0, 0, 100, 1);
		
		RemoveTimer("pushForward1");
		
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 19){
		FadeIn(1);
		
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 7, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 20){
		SetEntityActive("static5", true);
		SetEntityActive("billy_tv1", false);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 21){
		SetEntityActive("static5", false);
		SetEntityActive("tvOff1", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 22){
		SetEntityActive("tvOff1", false);
		SetEntityActive("tvOff2", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 23){
		SetEntityActive("tvOff2", false);
		SetEntityActive("tvOff3", true);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 24){
		SetEntityActive("tvOff3", false);
		SetEntityActive("tvOff4", true);
		SetLightVisible("BoxLight_2", false);
		SetLightVisible("tvLight", false);
		SetLocalVarInt("bluescreen2", GetLocalVarInt("bluescreen2")+1);
		AddTimer("bluescreen2", 0.1, "bluescreen2");
	}else if(GetLocalVarInt("bluescreen2") == 25){
		SetEntityActive("ladder1", true);
		SetEntityActive("ladder2", true);
		SetEntityActive("ladder3", true);
		SetEntityActive("ladder4", true);
		SetEntityActive("ladder5", true);
		
		SetGlobalVarInt("lvl2TV", 2);
		
		SetEntityPlayerInteractCallback("replayTV", "replayTV", true);
		
		SetPlayerActive(true);
		
		AutoSave();
	}
}

void pushForward1(string &in asTimer){
	AddPlayerBodyForce(0, 0, -3000, false);
	AddTimer("pushForward1", 0.1, "pushForward1");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//UNLOCKED LAB//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void unlockLab(string &in asItem, string &in asEntity){
	RemoveItem("hallwayKey2");
	SetSwingDoorLocked("mansion_3", false, false);
	PlayGuiSound("unlock_door.ogg", 100.0f);
	SetEntityActive("ladder1", true);
	SetEntityActive("ladder2", true);
	SetEntityActive("ladder3", true);
	SetEntityActive("ladder4", true);
	SetEntityActive("ladder5", true);
	
	AddEntityCollideCallback("Player", "monsterNoiseInit", "monsterNoise", true, 1);
	AddUseItemCallback("getAcid", "emptyJar", "acid_container_1", "giveAcid1", true);
}

void monsterNoise(string &in asParent, string &in asChild, int alState){
	PlaySoundAtEntity("monsterNoise", "amb_hunt.snt", "monsterNoise", 0, false);
}

void giveAcid1(string &in asItem, string &in asEntity){
	RemoveItem("emptyJar");
	PlayGuiSound("12_epoxy_fill.ogg", 100.0f);
	GiveItem("acidJar", "chemical_container.ent", "acidJar", "chemical_container_full.tga", 1);
	AddUseItemCallback("useAcid1", "acidJar", "slime_6way_1", "useAcid1", true);
	AddEntityCollideCallback("Player", "startMonster", "startMonster", true, 1);
	AddEntityCollideCallback("Player", "monsterChase", "monsterChase", false, 1);
	AddEntityCollideCallback("Player", "disableJump1", "disableJump", true, 1);
	
	CheckPoint("gotAcid1", "startAcid", "died", "deathHints", "brokenAnkle");
	
	AutoSave();
}

void giveAcid2(string &in asItem, string &in asEntity){
	RemoveItem("emptyJar");
	PlayGuiSound("12_epoxy_fill.ogg", 100.0f);
	GiveItem("acidJar", "chemical_container.ent", "acidJar", "chemical_container_full.tga", 1);
	AddUseItemCallback("useAcid2", "acidJar", "slime_6way_2", "useAcid2", true);
	
	CheckPoint("gotAcid2", "startAcid", "died", "deathHints", "brokenAnkle");
}

void useAcid1(string &in asItem, string &in asEntity){
	RemoveItem("acidJar");
	PlayGuiSound("gameplay_acid_web.ogg", 100.0f);
	GiveItem("emptyJar", "chemical_container.ent", "emptyJar", "chemical_container.tga", 1);
	CreateParticleSystemAtEntity("acidBurning", "ps_acid_web_dissolve.ps", "acidBurn", true);
	AddTimer("mucilage1", 1, "mucilage1");
	AddUseItemCallback("getAcid2", "emptyJar", "acid_container_1", "giveAcid2", true);
	
	CheckPoint("usedAcid1", "startMucilage", "died", "deathHints", "brokenAnkle");
}

void useAcid2(string &in asItem, string &in asEntity){
	RemoveItem("acidJar");
	PlayGuiSound("gameplay_acid_web.ogg", 100.0f);
	CreateParticleSystemAtEntity("acidBurning", "ps_acid_web_dissolve.ps", "acidBurn", true);
	AddTimer("mucilage2", 1, "mucilage2");
	
	SetEntityPlayerInteractCallback("handDrillP1", "gotHandDrill1", true);
	SetEntityPlayerInteractCallback("handDrillP2", "gotHandDrill2", true);
	SetEntityActive("handDrillS1", false);
	SetEntityActive("handDrillP1", true);
	
	CheckPoint("usedAcid2", "startMucilage", "died", "deathHints", "brokenAnkle");
}

void mucilage1(string &in asTimer){
	SetMessage("Messages", "lvl2MoreAcid", 8);
	SetEntityActive("slime_6way_1", false);
}

void mucilage2(string &in asTimer){
	SetMessage("Messages", "success", 8);
	SetEntityActive("slime_6way_2", false);
}

void startMonster(string &in asParent, string &in asChild, int alState){
	SetEntityActive("servant_grunt_1", true);
	SetEnemyDisableTriggers("servant_grunt_1", true);
	
	SetPlayerActive(false);
	SetPlayerJumpDisabled(false);
	
	StartPlayerLookAt("servant_grunt_1", 10, 10, "");
	
	SetSwingDoorLocked("mansion_1", false, false);
	SetSwingDoorClosed("mansion_1", false, false);
	SetSwingDoorDisableAutoClose("mansion_1", true);
	
	AddPropImpulse("mansion_1", -3, 0, 0, "world");
	
	if(HasItem("exitKey")){
		RemoveItem("exitKey");
	}
	
	AddTimer("openingDoor", 0.1, "timerPush");
}

void startMonsterDied(string &in asTimer){
	SetEntityActive("servant_grunt_1", true);
	SetEnemyDisableTriggers("servant_grunt_1", true);
	
	StartPlayerLookAt("servant_grunt_1", 10, 10, "");
	
	SetSwingDoorLocked("mansion_1", false, false);
	SetSwingDoorClosed("mansion_1", false, false);
	SetSwingDoorDisableAutoClose("mansion_1", true);
	
	AddPropImpulse("mansion_1", -3, 0, 0, "world");
	
	AddTimer("openingDoor", 0.1, "timerPush");
}

void timerPush(string &in asTimer){
	PlayGuiSound("door_mansion_open.snt", 0.3);
	AddPropImpulse("mansion_1", -4, 0, -2, "world");
	AddTimer("pushinShitRound1", 1.1, "disableTimerClose");
}

void disableTimerClose(string &in asTimer){
	SetSwingDoorDisableAutoClose("mansion_1", false);
	AddEnemyPatrolNode("servant_grunt_1", "PathNodeArea_1", 0, "");
	AddEnemyPatrolNode("servant_grunt_1", "PathNodeArea_2", 0, "");
	AddEntityCollideCallback("servant_grunt_1", "endMonster", "endMonster", true, 1);
}

void endMonster(string &in asParent, string &in asChild, int alState){
	ClearEnemyPatrolNodes("servant_grunt_1");
	
	SetSwingDoorLocked("mansion_1", true, true);
	SetSwingDoorClosed("mansion_1", true, true);
	
	SetPlayerActive(true);
	StopPlayerLookAt();
}

void monsterChase(string &in asParent, string &in asChild, int alState){
	SetEnemyDisableTriggers("servant_grunt_1", false);
	ShowEnemyPlayerPosition("servant_grunt_1");
	PlayGuiSound("player_falldamage3.ogg", 1);
	SetPlayerSanity(0);
	SetPlayerJumpDisabled(true);
	SetPlayerHealth(20);
	SetPlayerMoveSpeedMul(0);
	SetPlayerRunSpeedMul(0);
}

void disableJump(string &in asParent, string &in asChild, int alState){
	SetPlayerJumpDisabled(true);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//CONTROL CHECKPOINTS///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void spawnFirstFloor(string &in asParent, string &in asChild, int alState){
	CheckPoint("upstairs", "PlayerStartArea_1", "died", "deathHints", "watchStep");
	AddEntityCollideCallback("Player", "enterMainHall", "spawnMainHall", true, 1);
	//
	//TeleportPlayer("PlayerStartArea_2");//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////HAX!!!!!!!!!!!!!!!!!!!!!!!!
	//GiveItem("hallwayKey2", "key_tomb.ent", "Hkey3", "key_tomb.tga", 1);
	//SetEntityActive("slime_6way_1", false);
	//SetEntityActive("slime_6way_2", false);
	//SetEntityActive("ladder1", true);
	//SetEntityActive("ladder2", true);
	//SetEntityActive("ladder3", true);
	//SetEntityActive("ladder4", true);
	//SetEntityActive("ladder5", true);
	//
}

void spawnMainHall(string &in asParent, string &in asChild, int alState){
	CheckPoint("downstairs", "start2", "died", "deathHints", "watchStep");
	AddEntityCollideCallback("Player", "enterFirstFloor", "spawnFirstFloor", true, 1);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//START AREA 2//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void startArea2(string &in asEntity, int alState){
	if(GetGlobalVarInt("fromLvl3") == 1){
		SetGlobalVarInt("fromLvl3", 0);
		
		AddEntityCollideCallback("Player", "startMonster2", "startMonster", true, 1);
		AddEntityCollideCallback("Player", "monsterChase", "monsterChase", false, 1);
		AddEntityCollideCallback("Player", "disableJump2", "disableJump", true, 1);
		
		CheckPoint("fromLvl3", "PlayerStartArea_2", "died", "deathHints", "brokenAnkle");
		
		SetMapDisplayNameEntry("LVL2");
		
		SetEntityInteractionDisabled("pincers_1", true);
		SetEntityInteractionDisabled("plane_1", true);
		
		PlayMusic("ambient2.ogg", true, 1, 2, 1, true);
		
		/////////////////////////////////////////////////////////////////////////////////
		//SetEntityPlayerInteractCallback("handDrillP1", "gotHandDrill1", true);
		//SetEntityPlayerInteractCallback("handDrillP2", "gotHandDrill2", true);///////////HAX
		//SetEntityActive("handDrillS1", false);
		//SetEntityActive("handDrillP1", true);
		//////////////////////////////////////////////////////////////////////////////////
	}
}

void gotHandDrill1(string &in asEntity){
	
	if((HasItem("handDrillP2"))&&(HasItem("handDrillP3"))){
		RemoveItem("handDrillP1");
		RemoveItem("handDrillP2");
		RemoveItem("handDrillP3");
		GiveItem("handDrill", "Puzzle", "handDrill", "hand_drill.tga", 1);
		PlayGuiSound("12_make_drill", 1);
	}else if(HasItem("handDrillP2")){
		RemoveItem("handDrillP1");
		RemoveItem("handDrillP2");
		GiveItem("handDrillC1", "Puzzle", "handDrillC1", "handDrillC1.tga", 1);
		PlayGuiSound("12_make_drill", 1);
	}
	
	CheckPoint("gotHandDrill", "startDrill", "died", "deathHints", "brokenAnkle");
	AutoSave();
}

void gotHandDrill2(string &in asEntity){

	if((HasItem("handDrillP1"))&&(HasItem("handDrillP3"))){
		RemoveItem("handDrillP1");
		RemoveItem("handDrillP2");
		RemoveItem("handDrillP3");
		GiveItem("handDrill", "Puzzle", "handDrill", "hand_drill.tga", 1);
		PlayGuiSound("12_make_drill", 1);
	}else if(HasItem("handDrillP1")){
		RemoveItem("handDrillP1");
		RemoveItem("handDrillP2");
		GiveItem("handDrillC1", "Puzzle", "handDrillC1", "handDrillC1.tga", 1);
		PlayGuiSound("12_make_drill", 1);
	}
	
	//TeleportPlayer("startDrill");/////////////////////////////////////////////////HAX
	
	AutoSave();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//MISC FUNCTIONS////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void die1(string &in asParent, string &in asChild, int alState){
	SetPlayerActive(false);
	SetPlayerHealth(0);
}

void checkifLocked(string &in asEntity){
	if(GetSwingDoorLocked(asEntity)){
		SetMessage("Messages", "lockedDoor", 2);
	}
}

void releaseLook(){
	StopPlayerLookAt();
}