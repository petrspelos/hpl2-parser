void OnStart()
{
SetMapDisplayNameEntry("RedMine02");
AddEntityCollideCallback("Player", "ScriptArea_59" ,"helmethint", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_41" ,"endedchase", true, 1);
/////////////
AddEntityCollideCallback("Player", "ScriptArea_48" ,"startfinalevent", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_25" ,"minehelmetfade", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_40" ,"scarewalk", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_31" ,"strangelight", true, 1);
//////////////
AddEntityCollideCallback("Player", "ScriptArea_17" ,"newcorridors_now", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_18" ,"spiderfake", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_19" ,"spiderfake", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_35" ,"farbangdoor", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_16" ,"finalmonster", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_10" ,"uvlight_rev", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_36" ,"flareactive", true, 1);
/////fake corpse event
AddEntityCollideCallback("Player", "ScriptArea_20" ,"fake_corpse_active", false, 1);
AddEntityCollideCallback("Player", "ScriptArea_21" ,"fake_corpse_deactive", false, 1);
AddEntityCollideCallback("Player", "ScriptArea_22" ,"fake_corpse_active", false, 1);
AddEntityCollideCallback("Player", "ScriptArea_23" ,"fake_corpse_deactive", false, 1);
/////////
AddUseItemCallback("", "note_nec_research_2", "lamp_uvlamp_new_1", "checkpassword", false);
AddUseItemCallback("", "weapon_crowbar_item_1", "ScriptArea_29", "usecrowbarforvalve", true);
AddEntityCollideCallback("Player", "ScriptArea_15" ,"changeslide", true, 1);
AddEntityCollideCallback("Player", "ScriptArea_33" ,"newmusicactive", true, 1);
FadeLightTo("SpotLight_82", -1, -1, -1, -1, 0, 0);
InteractConnectPropWithMoveObject("Gate1","nec_shovel_5", "iron_mine_vertical_door_sp_3",true, false, 0);
InteractConnectPropWithMoveObject("Gate2","nec_shovel_6", "iron_mine_vertical_door_sp_3",true, false, 0);
InteractConnectPropWithMoveObject("Gate3","nec_shovel_9", "Door_6",true, false, 0);
InteractConnectPropWithMoveObject("Gate4","nec_shovel_9", "Door_5",true, false, 0);
InteractConnectPropWithMoveObject("Gate5","nec_shovel_13", "Door_3", true, false, 0);
InteractConnectPropWithMoveObject("Gate6","nec_shovel_13", "Door_44", true, false, -1);
}
////fake corpse
void fake_corpse_active(string &in asParent, string &in asChild, int alState)
{
SetEntityActive("ScriptArea_20", false);
SetEntityActive("ScriptArea_22", false);
SetEntityActive("ScriptArea_21", true);
SetEntityActive("ScriptArea_23", true);
CreateParticleSystemAtEntity("f1", "flies_intense_swarm.ps", "ps_fly_1", false);
CreateParticleSystemAtEntity("f2", "flies_intense_swarm.ps", "ps_fly_2", false);
///CreateParticleSystemAtEntity("f3", "flies_intense_swarm.ps", "ps_fly_3", false);
PlaySoundAtEntity("flyy", "red_cloud_swarm.snt", "ps_fly_4", 0.5, true);
for (int i=1; i<=11; i++){
SetEntityActive("fake_"+i, true);
}
}
void fake_corpse_deactive(string &in asParent, string &in asChild, int alState)
{
for (int i=1; i<=11; i++){
SetEntityActive("fake_"+i, false);
}
StopSound("flyy", 0.5);
DestroyParticleSystem("f1");
DestroyParticleSystem("f2");
DestroyParticleSystem("f3");
SetEntityActive("ScriptArea_20", true);
SetEntityActive("ScriptArea_22", true);
SetEntityActive("ScriptArea_21", false);
SetEntityActive("ScriptArea_23", false);
}
///////
void changeslide(string &in asParent, string &in asChild, int alState)
{
FadeLightTo("SpotLight_105", -1, -1, -1, -1, 0, 0.5);
AddTimer("", 0.8, "orig_slideshow");
AddTimer("", 1.4, "orig_slideshow2");
}
void orig_slideshow(string &in asTimer)
{
FadeLightTo("SpotLight_82", -1, -1, -1, -1, 9.5, 0.5);
}
void orig_slideshow2(string &in asTimer)
{
SetEntityActive("ScriptArea_27", true);
}
//////////////////////

void usecrowbarforvalve(string &in asItem, string &in asEntity)
{
RemoveItem(asItem);
StartPlayerLookAt("nec_shovel_12", 1.5, 1.5, "");
SetEntityActive("nec_shovel_13", true);
SetEntityActive("nec_shovel_12", false);
SetEntityActive("ScriptArea_29", false);
CreateParticleSystemAtEntity("", "particle_imp_dirt.ps", "ScriptArea_32", false);
PlaySoundAtEntity("", "puzzle_place_jar.snt", "ScriptArea_32", 0, true);
AddTimer("", 1, "stoplooknow");
}
void stoplooknow(string &in asTimer)
{
StopPlayerLookAt();
}
void newmusicactive(string &in asParent, string &in asChild, int alState)
{
SetLocalVarInt("ambientmus", 1);
PlayMusic("Underwater Ambient.ogg", true, 0.35, 10, 1, false);
//StopSound("Sound_27", 0);
//StopSound("Sound_25", 0);
RotatePropToSpeed("techdemo_propeller_5", 1, 1, 0, 1, 0, true, "propeller_1");
RotatePropToSpeed("techdemo_propeller_3", 1, 1, 0, 1, 0, true, "propeller_2");
RotatePropToSpeed("techdemo_propeller_1", 1, 1, 0, 1, 0, true, "propeller_3");
RotatePropToSpeed("techdemo_propeller_6", 1, 1, 0, 1, 0, true, "propeller_5");
RotatePropToSpeed("techdemo_propeller_8", 1, 1, 0, 1, 0, true, "propeller_4");
}

////level transit
void interact_firstroom(string &in asEntity)
{
if (asEntity == "Door_corr_01"){
PlaySoundAtEntity("", "door_metal_turnlock_open1.snt", "Player", 0, true);
SetPlayerActive(false);
FadeOut(1);
AddTimer("to1", 1.2,"to_corr01_transit");
AddTimer("to2", 1.5,"to_corr01_transit");
if (GetLocalVarInt("monsterevent") == 1){
for (int i=1; i<=6; i++){
ResetProp("propthing_"+i);
}
}
return;
}
if (asEntity == "Door_corr_02"){
PlaySoundAtEntity("", "door_metal_turnlock_open1.snt", "Player", 0, true);
SetPlayerActive(false);
FadeOut(1);
AddTimer("to3", 1.2,"to_corr01_transit");
AddTimer("to4", 1.5,"to_corr01_transit");
return;
}
}

void to_corr01_transit(string &in asTimer)
{
if (asTimer == "to1")
{
TeleportPlayer("PlayerStartArea_1");
return;
}
if (asTimer == "to2")
{
SetPlayerActive(true);
FadeIn(1);
PlaySoundAtEntity("", "door_metal_turnlock_close1.snt", "Player", 0, true);
if (GetLocalVarInt("ambientmus") == 1){
PlayMusic("Underwater Ambient.ogg", true, 0.35, 10, 1, false);
}
return;
}
if (asTimer == "to3")
{
TeleportPlayer("PlayerStartArea_14");
return;
}
if (asTimer == "to4")
{
StopMusic(2,1);
SetPlayerActive(true);
FadeIn(1);
PlaySoundAtEntity("", "door_metal_turnlock_close1.snt", "Player", 0, true);
return;
}
}
//////////////
////level transit second//////////////
void interact_secondroom(string &in asEntity)
{
if (asEntity == "Door_mine_01"){
PlaySoundAtEntity("", "01_door_open_2.snt", "Player", 0, true);
SetPlayerActive(false);
FadeOut(1);
AddTimer("too1", 1.2,"to_mine01_transit");
AddTimer("too2", 1.5,"to_mine01_transit");
if (GetLocalVarInt("monsterevent") == 1){
SetPlayerHealth(200);
return;
}
return;
}
if (asEntity == "Door_mine_02"){
PlaySoundAtEntity("", "01_door_open_2.snt", "Player", 0, true);
SetPlayerActive(false);
FadeOut(1);
AddTimer("too3", 1.2,"to_mine01_transit");
AddTimer("too4", 1.5,"to_mine01_transit");
return;
}
}
void to_mine01_transit(string &in asTimer)
{
if (asTimer == "too1")
{
TeleportPlayer("PlayerStartArea_11");
return;
}
if (asTimer == "too2")
{
SetPlayerActive(true);
FadeIn(1);
PlaySoundAtEntity("", "01_door_close_2.snt", "Player", 0, true);
return;
}
if (asTimer == "too3")
{
TeleportPlayer("PlayerStartArea_2");
return;
}
if (asTimer == "too4")
{
SetPlayerActive(true);
FadeIn(1);
PlaySoundAtEntity("", "01_door_close_2.snt", "Player", 0, true);
return;
}
}
//////////////
/////////////
//////////////////
/////////////
void Sink_interact(string &in asEntity)
{
PlayGuiSound("interact_sink1.ogg", 20.0f);
}
void uvlight_switch(string &in asEntity)
{
if(GetLocalVarInt("lighton") == 0)
		{
		   
		    SetLampLit("lamp_uvlamp_new_1", false, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton", 1);
			StopSound("Sound_31", 0.5);
			SetLightVisible("SpotLight_86", false);
			SetLightVisible("SpotLight_87", false);
			SetLightVisible("SpotLight_88", false);
			SetLightVisible("SpotLight_89", false);
            SetLightVisible("SpotLight_93", false);
			 SetLightVisible("SpotLight_90", false);
			SetLightVisible("SpotLight_91", false);
			SetLightVisible("SpotLight_92", false);
            return;
		}
		if(GetLocalVarInt("lighton") == 1)
		{
		    SetLampLit("lamp_uvlamp_new_1", true, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton", 0);
			FadeInSound("Sound_31", 0.5, true);
      	    SetLightVisible("SpotLight_86", true);
			SetLightVisible("SpotLight_87", true);
			SetLightVisible("SpotLight_88", true);
			SetLightVisible("SpotLight_89", true);
            SetLightVisible("SpotLight_93", true);
		    SetLightVisible("SpotLight_90", true);
			SetLightVisible("SpotLight_91", true);
			SetLightVisible("SpotLight_92", true);
			if (HasItem("note_nec_research_2") == true){
			SetEntityActive("ScriptArea_10", true);
			return;
			}
		    return;
		}
}
//////////////
void lamp01switch(string &in asEntity)
{
if(GetLocalVarInt("lighton02") == 0)
		{	   
		    SetLampLit("mining_room_desklamp_new_1", false, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton02", 1);
			SetLightVisible("SpotLight_25", false);
			SetLightVisible("SpotLight_26", false);
			SetLightVisible("SpotLight_83", false);
			SetLightVisible("SpotLight_84", false);
			SetLightVisible("SpotLight_85", false);
            return;
		}
		if(GetLocalVarInt("lighton02") == 1)
		{
		    SetLampLit("mining_room_desklamp_new_1", true, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton02", 0);
			SetLightVisible("SpotLight_25", true);
			SetLightVisible("SpotLight_26", true);
			SetLightVisible("SpotLight_83", true);
			SetLightVisible("SpotLight_84", true);
			SetLightVisible("SpotLight_85", true);
		    return;
		}
}
void lamp02switch(string &in asEntity)
{
if(GetLocalVarInt("lighton03") == 0)
		{	   
		    SetLampLit("mining_room_desklamp_new_2", false, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton03", 1);
			SetLightVisible("SpotLight_20", false);
			SetLightVisible("SpotLight_21", false);
			SetLightVisible("SpotLight_22", false);
			SetLightVisible("SpotLight_23", false);
			SetLightVisible("SpotLight_24", false);
            return;
		}
		if(GetLocalVarInt("lighton03") == 1)
		{
		    SetLampLit("mining_room_desklamp_new_2", true, false);
		    PlayGuiSound("interact_lamp1.ogg", 5.0f);
			SetLocalVarInt("lighton03", 0);
			SetLightVisible("SpotLight_20", true);
			SetLightVisible("SpotLight_21", true);
			SetLightVisible("SpotLight_22", true);
			SetLightVisible("SpotLight_23", true);
			SetLightVisible("SpotLight_24", true);
		    return;
		}
}
/////////////
////////////////
///PROJECTOR////
///////////////
void projectoractiv(string &in asEntity)
{
if(GetLocalVarInt("projector") == 0)
		{
		SetButtonSwitchedOn("tech_projector_1", false, true);
		 PlayGuiSound("interact_projector_off1.ogg", 10.0f);
		 StopSound("Sound_9", 1);
		 SetLocalVarInt("projector", 1);
		 SetEntityActive("signbox_radius_2", false);
		SetLightVisible("PointLight_9", false);
		SetLightVisible("SpotLight_82", false);
		///SetLightVisible("SpotLight_10", false);
		return;
	    }
    if(GetLocalVarInt("projector") == 1)
	{
	SetButtonSwitchedOn("tech_projector_1", true, true);
	    PlayGuiSound("interact_projector_on1.ogg", 10.0f);
	    FadeInSound("Sound_9", 1, false);
	    SetLocalVarInt("projector", 0);
		SetEntityActive("signbox_radius_2", true);
        SetLightVisible("PointLight_9", true);
		SetLightVisible("SpotLight_82", true);
		///SetLightVisible("SpotLight_10", true);
		return;
	}

}
/////////////////
void SaveSpotArt(string &in asEntity)
{
FadeImageTrailTo(2, 100);
AddTimer("waittim_save2art", 2, "waittimsart");
AddTimer("", 5, "waittim3art");
ShowPlayerCrossHairIcons(false);
SetPlayerActive(false);
GiveSanityBoostSmall();
SetEntityActive("ScriptArea_8", false);

if (GetLocalVarInt("first_artefact_touch") == 0){
SetLocalVarInt("first_artefact_touch", 1);
PlayGuiSound("horror_flashback.snt", 3.0f);
StartEffectEmotionFlash("03_Red", "Artifact04", "");
return;
}
else if (GetLocalVarInt("first_artefact_touch") == 1){
PlayGuiSound("ui_emotion_stone.snt", 3.0f);
StartEffectFlash(2.5, 1, 2);
FadePlayerFOVMulTo(0.17, 1.6);
return;
}
}
void waittimsart(string &in asTimer)
{
FadeRadialBlurTo(0.009f, 0.09f);
SetPlayerSanity(90);
SetEntityCustomFocusCrossHair("ScriptArea_29", "ignite");
ShowPlayerCrossHairIcons(true);
FadePlayerFOVMulTo(1, 100);
FadeImageTrailTo(0, 100);
SetSanityDrainDisabled(true);
SetPlayerActive(true);
AutoSave();
}
void waittim3art(string &in asTimer)
{
SetEntityActive("ScriptArea_8", true);
}
////////////////////
///////////////
//SAVE
/////
void SaveSpot(string &in asEntity)
{
ShowPlayerCrossHairIcons(false);
SetPlayerActive(false);
GiveSanityBoostSmall();
////SetEntityActive("ScriptArea_8", false);
PlayGuiSound("ui_emotion_stone.snt", 3.0f);
FadePlayerFOVMulTo(0.17, 1.6);
StartEffectFlash(2.5, 1, 2);
AddTimer("waittim_save", 2, "waittim");
//if (asEntity == "ScriptArea_8"){
//AddTimer("", 5, "waittim2");
//}
if (asEntity == "ScriptArea_4"){
AddTimer("", 5, "waittim3");
}
if (asEntity == "ScriptArea_6"){
AddTimer("", 5, "waittim4");
}
}
void waittim(string &in asTimer)
{
SetPlayerSanity(90);
SetEntityCustomFocusCrossHair("ScriptArea_29", "ignite");
ShowPlayerCrossHairIcons(true);
FadePlayerFOVMulTo(1, 100);
SetSanityDrainDisabled(true);
SetPlayerActive(true);
AutoSave();
}
///void waittim2(string &in asTimer)
///{
///SetEntityActive("ScriptArea_8", true);
///}
void waittim3(string &in asTimer)
{
SetEntityActive("ScriptArea_4", true);
}
void waittim4(string &in asTimer)
{
SetMessage("03_Red", "Artifact05", -1);
SetEntityActive("ScriptArea_6", true);
}
///////////
void pickfirsthelmet(string &in asEntity, string &in asType)
{
if (asEntity == "mine_helmet_3"){
AddTimer("", 0.5, "equipitt");
SetGlobalVarInt("lanterngain", 1);
SetEntityActive("lantern_2", true);
SetEntityActive("lantern_1", false);
return;
}
if (asEntity == "lantern_1"){
AddTimer("", 0.5, "equipitt");
SetGlobalVarInt("lanterngain", 1);
SetEntityActive("mine_helmet_2", true);
SetEntityActive("mine_helmet_3", false);
return;
}
}
void equipitt(string &in asTimer)
{
PlayGuiSound("pick_cloth2.ogg", 0.9f);
}
/////
void worminteract(string &in asEntity)
{
///PlayGuiSound("impact_organic_low.snt", 2.5f);
StartPlayerLookAt("ScriptArea_14", 1.8, 1.8, "");
FadePlayerFOVMulTo(0.8, 1.5);
SetPlayerActive(false);
AddTimer("e0", 1.3, "eatseq");
AddTimer("e1", 1.4, "eatseq");
AddTimer("e2", 2.5, "eatseq");
}
void eatseq(string &in asTimer)
{
if (asTimer == "e0"){
PlaySoundAtEntity("", "enemy_dog_eat.snt", "Player", 0, true);
CreateParticleSystemAtEntity("", "particle_blood_splat01.ps", "ScriptArea_14", false);
return;
}
if (asTimer == "e1"){
StopPlayerLookAt();
return;
}
if (asTimer == "e2"){
FadePlayerFOVMulTo(1, 2);
SetPlayerActive(true);
StartScreenShake(0.01, 0.1, 0.1, 0);
PlaySoundAtEntity("", "player_coughnew.snt", "Player", 0.5f/1.2f, true);
StartInsanityEvent("DamageHit");
GivePlayerDamage(10, "BloodSplat", false, false);
return;
}
}
//////////////
void newcorridors_now(string &in asParent, string &in asChild, int alState)
{
for (int i=1; i<=11; i++){
SetEntityActive("fake_"+i, false);
}
lightflickeractive();
StopSound("flyy", 0.5);
DestroyParticleSystem("f1");
DestroyParticleSystem("f2");
DestroyParticleSystem("f3");
SetEntityActive("Door_8", false);
SetEntityActive("Doorw", false);
SetEntityActive("Door_break", true);
SetEntityActive("invisible_box_metal_heavy_3", true);
///FadeInSound("Sound_25", 1, true);
///FadeInSound("Sound_27", 1, true);

//SetEntityActive("slide_move_15", false);
//SetEntityActive("slide_move_17", false);
//SetEntityActive("slide_move_14", false);
//SetEntityActive("slide_move_13", false);
//SetEntityActive("slide_move_12", false);
//SetEntityActive("slide_move_11", false);
//SetEntityActive("slide_move_19", false);
//SetEntityActive("slide_move_21", false);

}
void spiderfake(string &in asParent, string &in asChild, int alState)
{
SetEntityActive("ScriptArea_18", false);
SetEntityActive("ScriptArea_19", false);
SetEntityActive("necr_spider_move_1", true);
SetEntityActive("necr_spider_move_2", true);
//PlayGuiSound("horror_spider_thump1.ogg", 1.0f);
AddTimer("s1", 0.1, "spiderseq");
AddTimer("s2", 0.2, "spiderseq");
AddTimer("s3", 1.2, "spiderseq");
}
void spiderseq(string &in asTimer)
{
if (asTimer == "s1"){
PlayPropAnimation("necr_spider_move_1", "Walk", 0, true, "");
PlayPropAnimation("necr_spider_move_2", "Walk",  0, true, "");
return;
}
if (asTimer == "s2"){
 SetMoveObjectState("necr_spider_move_1", -100);
  SetMoveObjectState("necr_spider_move_2", 100);
return;
}
if (asTimer == "s3"){
  SetEntityActive("necr_spider_move_1", false);
  SetEntityActive("necr_spider_move_2", false);
return;
}
}
////////////////////
void farbangdoor(string &in asParent, string &in asChild, int alState)
{
StartScreenShake(0.01, 0, 0.6, 0);
PlaySoundAtEntity("", "event_metal_impact_echo1.snt", "Elevators", 0, true);
}
////////////
void uvlight_rev(string &in asParent, string &in asChild, int alState)
{
CompleteQuest("code", "Redcode");
StopMusic(1, 1);
SetPlayerActive(false);
StartInsanityEvent("WideRed2");
ShowPlayerCrossHairIcons(false);
StartPlayerLookAt("lamp_uvlamp_new_1", 1.1, 1.1, "");
AddTimer("t1", 2.5, "notereview");
AddTimer("t2", 5.0, "notereview");
}
void notereview(string &in asTimer)
{
if (asTimer == "t1"){
PlayMusic("secret_room.ogg", false, 0.4, 9, 1.1, false);
///RemoveItem("note_nec_research_2");
//GiveItem("secret_note", "Puzzle", "passnote", "inventory_blank_note.tga", 1);
SetMessage("03_Red", "uvlamp", -1);
SetEntityActive("ScriptArea_31", true);
SetEntityActive("ScriptArea_48", true);
PlaySoundAtEntity("pr", "18_prisoner1.snt", "ScriptArea_58", 0, false);
ResetProp("things_44");
for (int i=10; i<=18; i++){
SetEntityActive("newbutton_"+i, false);
}
for (int k=1; k<=9; k++){
SetEntityActive("newbutton_"+k, true);
}
return;
}
if (asTimer == "t2"){
SetPropStaticPhysics("things_44", true);
StopPlayerLookAt();
ShowPlayerCrossHairIcons(true);
SetPlayerActive(true);
AddNote("RedPassword02", "default_note");
PlayGuiSound("ui_add_quest.snt", 5.0f);
SetMessage("03_Red", "uvlamp02", -1);
SetEntityActive("ScriptArea_16", true);
SetLocalVarInt("monsterevent", 1);
StopSound("Sound_33", 1);
SetEntityActive("base_entrance_man_1", false);
return;
}
}
////////////
//////CODE///////
void buttoncase_3(string &in asEntity)
{
if (asEntity == "newbutton_10"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_11"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_12"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_13"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_14"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_15"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_16"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_17"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
if (asEntity == "newbutton_18"){
PlayGuiSound("puzzle_button.ogg", 1.0f);
AddLocalVarInt("buttoncountnew", 1);
if (GetLocalVarInt("buttoncountnew") == 4){
if (GetLocalVarInt("codenote_first") == 0){
SetLocalVarInt("passpanelfirst", 1);
AddQuest("code", "Redcode");
}
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncountnew", 0);
}
return;
}
}
//////
/////////////
void buttoncase_2(string &in asEntity)
{
PlayGuiSound("puzzle_button.ogg", 1.0f);
if (asEntity == "newbutton_2"){
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_1"){  //second
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 2 && GetLocalVarInt("truenum_5") == 1){
SetLocalVarInt("truenum_1", 1);
}
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_3"){
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_4"){  ///four
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4 && GetLocalVarInt("truenum_7") == 1){
SetLocalVarInt("truenum_4", 1);
AddTimer("", 0.1, "check");
}
else if (GetLocalVarInt("buttoncount") == 4 && GetLocalVarInt("truenum_7") == 0){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_5"){   ///first
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 1){
SetLocalVarInt("truenum_5", 1);
}
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_6"){
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_7"){ ///third
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 3 && GetLocalVarInt("truenum_1") == 1){
SetLocalVarInt("truenum_7", 1);
}
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_8"){
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
if (asEntity == "newbutton_9"){
AddLocalVarInt("buttoncount", 1);
if (GetLocalVarInt("buttoncount") == 4){
PlayGuiSound("door_code_incorrect1.ogg", 1.0f);
SetLocalVarInt("buttoncount", 0);
}
return;
}
}
void check(string &in asTimer)
{
if (GetLocalVarInt("buttoncount") == 4 && GetLocalVarInt("truenum_4") == 1){
PlayGuiSound("door_code_correct1.ogg", 1.0f);
AddTimer("", 0.5, "opendoorsound");
for (int i=1; i<=11; i++){
SetEntityActive("button_"+i, false);
}
}
}
void opendoorsound(string &in asTimer)
{
///PlayGuiSound("13_unlock_door1.ogg", 1.0f);
 SetMoveObjectState("Doorr2", 0.915);
   SetMoveObjectState("Doorr1", -0.915);
    PlaySoundAtEntity("", "refinery_slide_open.snt", "ScriptArea_7", 1.1f/0.6f, true);
}
/////////////
void finalmonster(string &in asParent, string &in asChild, int alState)
{
StopMusic(1, 1);
SetPlayerActive(false);
StartInsanityEvent("Wide4");
StartPlayerLookAt("ScriptArea_37", 1.5, 1.5, "");
StartScreenShake(0.01, 0, 0.6, 0);
AddTimer("m1", 2.5, "monstercase");
AddTimer("m2", 6.5, "monstercase");
AddTimer("m3", 8.5, "monstercase");
PlaySoundAtEntity("", "07_infected_rumble.snt", "ScriptArea_38", 0, true);
PlaySoundAtEntity("", "break_metal_sheet.snt", "ScriptArea_38", 0, true);
}
void monstercase(string &in asTimer)
{
if (asTimer == "m1")
{
SetEntityActive("Door_break", false);
SetEntityActive("Door_break_1", true);
SetEntityActive("Door_break_2", true);
SetEntityActive("Door_corr_3", true);
SetEntityActive("Door_corr_02", false);
SetEntityActive("invisible_box_metal_heavy_3", false);
PlaySoundAtEntity("", "new_agressive_demo.snt", "ScriptArea_37", 0, true);
return;
}
if (asTimer == "m2")
{
AddEffectVoice("red_monologue2", "", "Voice", "Red_demo_02", false, "ScriptArea_4", 9, 16 );
CheckPoint("default", "PlayerStartArea_1", "defreset", "", "");
SetEntityActive("infected_mine_1", true);
SetEntityActive("red_infected_collector_1", true);
TeleportEnemyToNode("infected_mine_1", "PathNodeArea_353", true);
return;
}
if (asTimer == "m3")
{
SetPlayerActive(true);
StopPlayerLookAt();
for (int i=1; i<=47; i++){
AddEnemyPatrolNode("infected_mine_1", "Path_"+i, 0.01, "");
}
for (int l=1; l<=6; l++){
AddEnemyPatrolNode("red_infected_collector_1", "Paths_"+l, 0.01, "");
}
return;
}
}
void defreset(string &in asName, int alCount)
{
SetEntityActive("infected_mine_1", true);
SetEntityActive("red_infected_collector_1", true);
TeleportEnemyToNode("infected_mine_1", "PathNodeArea_353", true);
AddTimer("", 0.5, "startpatrol");
}
void startpatrol(string &in asTimer)
{
for (int i=1; i<=47; i++){
AddEnemyPatrolNode("infected_mine_1", "Path_"+i, 0.01, "");
}
for (int l=1; l<=6; l++){
AddEnemyPatrolNode("red_infected_collector_1", "Paths_"+l, 0.01, "");
}
}
////////////////
/////////////////////
//////////FLARE////////////
/////////////////////////////
void flareactive(string &in asParent, string &in asChild, int alState)
{
flareuse();
}
void flareuse()
{
AddTimer("san1", 0.7, "sanity1");
}
void sanity1(string &in asTimer)
{
AddTimer("san1", 0.7, "sanity1");
if (GetPlayerSanity() == 85){
AddGlobalVarInt("Flaers", 1);
CreateEntityAtArea("flare_"+GetGlobalVarInt("Flaers"), "nec_flare_grab.ent", "Flare_area", true); 
SetEntityPos("flare_"+GetGlobalVarInt("Flaers"), GetPlayerPosX()+0.2, GetPlayerPosY()+0.2, GetPlayerPosZ()+0.2);
SetPlayerSanity(90);
AddTimer("flare_"+GetGlobalVarInt("Flaers"), 120.0f, "flareend");
}
}
void flareend(string &in asTimer)
{
SetPropEffectActive(asTimer, false, true);
}
//////////////
void fence_locked(string &in asEntity)
{
PlaySoundAtEntity("", "interact_locked_gate.snt", "irondoor_sp", 0, true);
}
void interact_gate(string &in asEntity)
{
PlaySoundAtEntity("", "interact_locked_gate.snt", "things_44", 0, true);
}

void elevator_button(string &in asEntity)
{
SetMessage("Sign", "panelbroken", -1);
PlayGuiSound("puzzle_button.snt", 2.8f);
}
//////////////
////DOOR SCARE AFTER MONSTER APPEAR
void interact_firstroombreak(string &in asEntity)
{
if (GetLocalVarInt("firstuse") == 0){
    SetLocalVarInt("firstuse", 1);
 	FadeImageTrailTo(3, 0.05);
	PlaySoundAtEntity("impact1", "03_metal_impact.snt", "bangarea", 0.0f, true);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_2", true);
	CreateParticleSystemAtEntity("dust2", "particle_dust_lid_remove.ps", "dustarea_3", true);
	CreateParticleSystemAtEntity("dust3", "particle_dust_lid_remove.ps", "dustarea_1", true);
	CreateParticleSystemAtEntity("dust4", "particle_dust_lid_remove.ps", "dustarea_4", true);
	StartScreenShake(0.018f, 0.5 ,0.4, 0.1);
	AddTimer("scaredelay1", 0.4f, "ScareDelay01");
	AddTimer("scaredelay2", 0.88f, "ScareDelay01");
	AddTimer("scaredelay3", 1.41f, "ScareDelay01");
	AddTimer("scaredelay4", 2.2f, "ScareDelay01");
	AddTimer("scaredelay5", 3.4f, "ScareDelay01");
	return;
	}
	if (GetLocalVarInt("firstuse") == 1){
	PlaySoundAtEntity("", "interact_locked_metal_door.snt", "dustarea_4", 0, true);
	return;
	}
}
void ScareDelay01(string &in asTimer)
{
if (asTimer == "scaredelay1"){
    CreateParticleSystemAtEntity("dust1", "ps_impact_dirt_high.ps", "dustarea_4", true);
	return;
	}
if (asTimer == "scaredelay2"){
    PlaySoundAtEntity("impact1", "03_metal_impact.snt", "bangarea", 0.0f, true);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_5", true);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_6", true);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_7", true);
	StartScreenShake(0.019f, 0.4,0.4,0.1);
	return;
}
if (asTimer == "scaredelay3"){
    CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_1", true);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_2", true);
    PlaySoundAtEntity("ear", "insanity_ear_ring.snt", "Player", 1, false);
	CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "dustarea_8", true);
	return;
}
if (asTimer == "scaredelay4"){
     FadeGlobalSoundSpeed(0.5, 0.5);
     PlaySoundAtEntity("", "infected_hunting_2.snt", "bangarea", 1, false);
     StopSound("ear", 4.6);
	 return;
}
if (asTimer == "scaredelay5"){
FadeImageTrailTo(0, 3);
FadeGlobalSoundSpeed(1, 3);
return;
}
}
void ladder1at(string &in asStickyArea, string &in asBodyName)
{
SetEntityInteractionDisabled("mine_ladder_3", true);
PlayGuiSound("ladder_default_attach.snt", 1.0f);
SetEntityActive("LadderArea_1", true);
}
/////////

void minehelmetfade(string &in asParent, string &in asChild, int alState)
{
/////SetLightVisible("iron_mine_helmet_1_SpotLight_1", false);
SetPropEffectActive("iron_mine_helmet_1", false, true);
SetEntityInteractionDisabled("iron_mine_helmet_1", true);
AddTimer("h1", 1.0, "helmetseq");
AddTimer("h2", 1.5, "helmetseq");
AddTimer("h3", 2.5, "helmetseq");
}
void helmetseq(string &in asTimer)
{
if (asTimer == "h1"){
SetPropEffectActive("iron_mine_helmet_1", true, true);
////SetLightVisible("iron_mine_helmet_1_SpotLight_1", true);
return;
}
if (asTimer == "h2"){
SetPropEffectActive("iron_mine_helmet_1", false, true);
///SetLightVisible("iron_mine_helmet_1_SpotLight_1", false);
return;
}
if (asTimer == "h3"){
SetEntityInteractionDisabled("iron_mine_helmet_1", false);
SetPropEffectActive("iron_mine_helmet_1", true, true);
///SetLightVisible("iron_mine_helmet_1_SpotLight_1", true);
return;
}
}
void fadefinal(string &in asEntity)
{
AddTimer("", 1.6, "breakmimehelmet");
}
void breakmimehelmet(string &in asTimer)
{
SetLightVisible("iron_mine_helmet_1_SpotLight_1", false);
SetPropEffectActive("iron_mine_helmet_1", false, false);
PlaySoundAtEntity("", "13_light_out1.snt", "iron_mine_helmet_1", 0, false);
CreateParticleSystemAtEntity("", "ps_break_glass.ps", "iron_mine_helmet_1", false);
}

void scarewalk(string &in asParent, string &in asChild, int alState)
{
StartInsanityEvent("Steps_Infected");
}
void strangelight(string &in asParent, string &in asChild, int alState)
{
FadeImageTrailTo(1,1);
StopSound("pr", 0);
///StartPlayerLookAt("item_hand_jeila_1", 2, 2, "");
AddTimer("b0", 	0.4, "bloodsplash");
AddTimer("b1", 	0.6, "bloodsplash");
AddTimer("b2", 1.1, "bloodsplash");
SetEntityActive("item_hand_jeila_1", true);
SetEntityActive("blood_spatter01_1", true);
SetEntityActive("blood_spatter01_2", true);
StartScreenShake(0.1f, 0.0f, 0.0f, 0.35f);
PlaySoundAtEntity("", "horrorimpact2.snt", "Player", 0, true);
AddTimer("", 2, "monsteryell"); 
}
void bloodsplash(string &in asTimer)
{
if (asTimer == "b0"){
AddPropForce("item_hand_jeila_1", 0, -2000, 0, "world");
return;
}
if (asTimer == "b1"){
CreateParticleSystemAtEntity("", "blood.ps", "ScriptArea_60", false);
return;
}
if (asTimer == "b2"){
//StopPlayerLookAt();
FadeImageTrailTo(0,1);
PlaySoundAtEntity("", "19_pour_blood_low.snt", "ScriptArea_55", 0, false);
CreateParticleSystemAtEntity("", "ps_blood_drop_area.ps", "ScriptArea_55", false);
CreateParticleSystemAtEntity("", "ps_guardian_danger_fog_loop.ps", "ScriptArea_57", false);
return;
}
}
void monsteryell(string &in asTimer)
{
PlaySoundAtEntity("", "horror_growl1.snt", "ScriptArea_53", 0, true);
}
///////
void lightflickeractive()
{
AddTimer("", 1.5f, "lampon");
}
void lampon(string &in asTimer)
{
PlaySoundAtEntity("lampon_1", "lm_light_flicker_long.snt", "lamp_machineroom_12", 0, false);
for (int i=1; i<=5; i++){
SetLightVisible("Spot_"+i, false);
}
AddTimer("", 0.34f, "lampoff_1");
SetLampLit("lamp_machineroom_12", false, false);
}
void lampoff_1(string &in asTimer)
{
for (int i=1; i<=5; i++){
SetLightVisible("Spot_"+i, true);
}
AddTimer("", 1.5f, "lampon");
SetLampLit("lamp_machineroom_12", true, false);
}
//////////////
//////////////
/////////////////////////////////
void startfinalevent(string &in asParent, string &in asChild, int alState)
{
SetPlayerHealth(90);
AddTimer("e1", 1.14, "eventactive");
AddTimer("e2", 1.8, "eventactive");
AddTimer("e3", 1.9, "eventactive");
SetEntityActive("Door_mine_4", true);
SetEntityActive("Door_mine_02", false);
SetEntityActive("red_infected_collector_1", false);
SetEntityActive("infected_mine_1", false);
SetEntityActive("flash_scene2_1", false);
SetEnemyDisabled("red_infected_collector_1", true);
SetEnemyDisabled("infected_mine_1", true);
SetEnemyDisableTriggers("red_infected_collector_1", true);
SetEnemyDisableTriggers("infected_mine_1", true);
///////////////////////////
StartScreenShake(0.006f, 0.8,0.2,0.2);
CreateParticleSystemAtEntity("", "particle_expl_cavein.ps", "area_exp_2", false);
SetPropActiveAndFade("cavein_base_1", true, 1);
SetEntityActive("BlockCave", true);
PlaySoundAtEntity("", "explosion_rock_large.snt", "area_exp_2", 0.5f, false);
}
void eventactive(string &in asTimer)
{
if (asTimer == "e1"){
PlaySoundAtEntity("rumb", "mine_amb_rumble.snt", "area_exp_2", 0, false);
StartScreenShake(0.012f, 9999,99,99);
StopSound("Sound_16", 0);
PlayMusic("Tomb Escape final.ogg", true, 0.4, 6, 2, true);
return;
}
if (asTimer == "e2"){
AddTimer("banggate", RandFloat(2.5, 3.5), "banggateseq");
PlaySoundAtEntity("impact1", "03_metal_impact.snt", "area_finaldust_17", 0.0f, false);
CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(9, 11), false);
CreateParticleSystemAtEntity("dust2", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(12, 14), false);
CreateParticleSystemAtEntity("dust3", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(15, 19), false);
return;
}
if (asTimer == "e3"){
AddTimer("banggate2", RandFloat(2.5, 3.5), "banggateseq2");
PlaySoundAtEntity("impact1", "03_metal_impact.snt", "area_finaldust_6", 0.0f, false);
CreateParticleSystemAtEntity("dust4", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(1, 3), false);
CreateParticleSystemAtEntity("dust5", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(4, 5), false);
CreateParticleSystemAtEntity("dust6", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(6, 8), false);
return;
}

}
////////////////
void banggateseq(string &in asTimer)
{
AddTimer("banggate", RandFloat(2.5, 4.5), "banggateseq");
PlaySoundAtEntity("impact1", "03_metal_impact.snt", "area_finaldust_17", 0.0f, false);
CreateParticleSystemAtEntity("dust1", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(9, 11), false);
CreateParticleSystemAtEntity("dust2", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(12, 14), false);
CreateParticleSystemAtEntity("dust3", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(15, 19), false);
}
void banggateseq2(string &in asTimer)
{
AddTimer("banggate2", RandFloat(2.5, 4.5), "banggateseq2");
PlaySoundAtEntity("impact1", "03_metal_impact.snt", "area_finaldust_6", 0.0f, false);
CreateParticleSystemAtEntity("dust4", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(1, 3), false);
CreateParticleSystemAtEntity("dust5", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(4, 5), false);
CreateParticleSystemAtEntity("dust6", "particle_dust_lid_remove.ps", "area_finaldust_"+RandInt(6, 8), false);
}
////////////////
void endedchase(string &in asParent, string &in asChild, int alState)
{
SetPlayerCrouching(false);
SetPlayerJumpDisabled(true);
SetPlayerCrouchDisabled(true);
SetInDarknessEffectsActive(false);
ShowPlayerCrossHairIcons(false);
ChangePlayerStateToNormal();
StartInsanityEvent("WideRed2");
SetPlayerActive(false);
StartPlayerLookAt("ScriptArea_50", 2, 2, "");
AddTimer("r1", 1,"enemyattack");
AddTimer("r2", 1.2,"enemyattack");
AddTimer("r3", 1.8,"enemyattack");
AddTimer("r4", 5.5,"enemyattack");
AddTimer("r5", 7.8,"enemyattack");
AddTimer("r6", 12.8,"enemyattack");
AddTimer("r7", 13.8,"enemyattack");
AddTimer("r8", 14.8,"enemyattack");
AddTimer("r9", 15.8,"enemyattack");
}
void enemyattack(string &in asTimer)
{
if (asTimer == "r1"){
SetLampLit("emergency_light_red_4", true, true);
FadeLightTo("SpotLight_153", 0.81, 0.018, 0, 0.276, 20, 0.1);
FadeLightTo("SpotLight_126", -1, -1, -1, -1, 20, 0.1);
FadeLightTo("SpotLight_124", -1, -1, -1, -1, 20, 0.1);
SetEntityActive("things_44", false);
SetEntityActive("amnesia_bottle_126", false);
SetEntityActive("Door_mine_4", false);
SetEntityActive("things_47", true);
SetEntityActive("Door_mine_3", true);
SetEntityActive("red_infected_collector_2", true);
SetEnemySanityDecreaseActive("red_infected_collector_2", false);
SetEntityActive("amnesia_bottle_169", true);
RemoveTimer("banggate");
RemoveTimer("banggate2");
return;
}
if (asTimer == "r2"){
SetEntityActive("character_rockworm_x_1", true);
PlayPropAnimation("character_rockworm_x_1", "Idle", 0, true, "");
CreateParticleSystemAtEntity("", "particle_explosion_bomb.ps", "area_exp_1", false);
CreateParticleSystemAtEntity("", "particle_expl_dust_exp.ps", "area_exp_3", false);
CreateParticleSystemAtEntity("", "particle_expl_dust_small.ps", "area_exp_5", false);
PlaySoundAtEntity("", "enemy_rock_worm_attack.snt", "Player", 0.0f, false);
return;
}

if (asTimer == "r3"){
PlaySoundAtEntity("", "break_metal_door.snt", "Player", 0.0f, false);
SetMoveObjectState("character_rockworm_x_1", 5);
AddEnemyPatrolNode("red_infected_collector_2", "sp_1", 0.01, "");
AddEnemyPatrolNode("red_infected_collector_2", "sp_2", 0.01, "");
AddEnemyPatrolNode("red_infected_collector_2", "sp_3", 0.01, "");
AddEnemyPatrolNode("red_infected_collector_2", "sp_4", 0.01, "");
AddEnemyPatrolNode("red_infected_collector_2", "sp_5", 0.01, "");
AddEnemyPatrolNode("red_infected_collector_2", "sp_6", 0.01, "");
StartPlayerLookAt("area_exp_4", 2.2, 2.2, "");
FadeImageTrailTo(1.1, 1);
FadeRadialBlurTo(0.02, 1);
return;
}
if (asTimer == "r4"){
AddPropForce("level_door_mine_8", 0, 0, -1600, "World");
PlayGuiSound("player_scare_low1_reverb.ogg", 20.0f);
StartPlayerLookAt("ScriptArea_50", 2.2, 2.2, "");
return;
}
if (asTimer == "r5"){
///PlaySoundAtEntity("sr", "step_run_wood_loop.snt", "ScriptArea_50", 0.0f, false);
MovePlayerHeadPos(0, 0, 20, 4.2, 0.5);
PlaySoundAtEntity("", "event_rail_steps.snt", "Player", 0.0f, false);
AddTimer("", 5, "stoprunsound");
return;
}
if (asTimer == "r6"){
///PlaySoundAtEntity("sr", "player_climb_red.snt", "ScriptArea_50", 0.0f, false);
PlaySoundAtEntity("", "event_rail_steps_gettingin.snt", "Player", 0.0f, false);
SetEntityActive("character_rockworm_x_1", false);
SetEntityActive("red_infected_collector_2", false);
MovePlayerHeadPos(0, 0.5, 21.2, 3.5, 0.5);
return;
}
if (asTimer == "r7"){
SetEntityActive("amnesia_bottle_129", false);
return;
}
if (asTimer == "r8"){
MovePlayerHeadPos(0, 0.5, 20, 3.5, 0.5);
return;
}
if (asTimer == "r9"){
PlaySoundAtEntity("", "event_rail_minecart.snt", "Player", 0.0f, false);
StartPlayerLookAt("Look_final_2", 2.2, 2.2, "");
MovePlayerHeadPos(0, -25.3, 114, 4.6, 0.5);
AddTimer("b1", 2.1,"breakwoodsblocks");
AddTimer("b11", 7.45,"breakwoodsblocks");
AddTimer("b2", 9.3,"breakwoodsblocks");
AddTimer("b22", 14.9,"breakwoodsblocks");
AddTimer("b3", 19.0,"breakwoodsblocks");
AddTimer("b4", 22.0,"breakwoodsblocks");
return;
}
}
////////
void stoprunsound(string &in asTimer)
{
///StopSound("sr", 0);
}
void breakwoodsblocks(string &in asTimer)
{
if (asTimer == "b1"){
SetPropHealth("barricade_1", 0);
return;
}
if (asTimer == "b11"){
GivePlayerDamage(40, "BloodSplat", false, false);
StartInsanityEvent("DamageHit");
SetPropHealth("barricade_2", 0);
CreateParticleSystemAtEntity("", "ps_dust_falling_small_thin.ps", "ps_falling_9", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_small_thin.ps", "ps_falling_8", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_small_thin.ps", "ps_falling_4", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_small_thin.ps", "ps_falling_7", false);

CreateParticleSystemAtEntity("", "ps_dust_falling_rumble.ps", "ps_falling_1", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_rumble.ps", "ps_falling_2", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_rumble.ps", "ps_falling_5", false);
return;
}
if (asTimer == "b2"){
StartInsanityEvent("Bugs_Many");
SetPropHealth("barricade_3", 0);
return;
}
if (asTimer == "b22"){
SetPlayerSanity(3);
GivePlayerDamage(30, "BloodSplat", false, false);
StartInsanityEvent("DamageHit");
SetPropHealth("barricade_4", 0);
CreateParticleSystemAtEntity("", "ps_dust_falling_rumble.ps", "ps_falling_10", false);
CreateParticleSystemAtEntity("", "ps_dust_falling_rumble.ps", "ps_falling_11", false);
SetEntityActive("bolder_1", true);
SetEntityActive("bolder_2", true);
SetEntityActive("bolder_3", true);
SetEntityActive("worm_nest_barr_wood01_3", false);
AddTimer("", 0.1, "pushforce");
SetMoveObjectState("things_46", 1);
SetMoveObjectState("things_48", 1);
FadeLightTo("PointLight_39", 1, 1, 1, 1, 1, 0.1);
FadeLightTo("PointLight_38", 1, 1, 1, 1, 1, 6);
if (GetLanternActive() == true){
SetLanternActive(false, false);
PlaySoundAtEntity("", "13_light_out1.snt", "Player", 0, false);
}
return;
}
if (asTimer == "b3"){
///FadeOut(0.5);
StartEffectFlash(0.01, 1, 1);
StopSound("rumb", 1);
StopMusic(2, 2);
StopMusic(1, 1);
PlaySoundAtEntity("rig","ear_sound_scene.snt", "Player", 0, true);
return;
}
if (asTimer == "b4"){
FadeOut(0.5);
StopSound("Sound_1", 0);
PlayGuiSound("gui_thunder1.ogg", 1.0f);
StopSound("rig", 2);
AddTimer("f1", 4.8, "endhereplease");
return;
}
}
void endhereplease(string &in asTimer)
{
StartCredits("penumbra_music_E1_A10.ogg", false, "Ending", "EndCredits", 5);
}
void pushforce(string &in asTimer)
{
 AddPropForce("bolder_1", 0, 0, -3000, "World");
 AddPropForce("bolder_3", 0, 0, -4000, "World");
  AddPropForce("bolder_2", 0, 0, -4000, "World");
}
/////////////
///////////////
////////////////
///////////
///////////
/////////
void wormsign_1(string &in asEntity)
{
SetMessage("03_Red", "wormsign_1", -1);
}
void wormsign_2(string &in asEntity)
{
SetMessage("03_Red", "wormsign_3", -1);
}
void wormsign_3(string &in asEntity)
{
SetMessage("03_Red", "wormsign_2", -1);
}
void stuckvent(string &in asEntity)
{
SetMessage("Sign", "doorlocked_1", -1);
}
//////////////
void helmethint(string &in asParent, string &in asChild, int alState)
{
StartPlayerLookAt("mine_helmet_3", 1.1, 1.1, "");
AddTimer("", 1.8, "stoplookhelmet");
}
void stoplookhelmet(string &in asTimer)
{
StopPlayerLookAt();
}
/////////
void lookmissing(string &in asEntity)
{
SetMessage("24_iron_mine_A", "lostmap", -1);
}
/////////
void checkpassword(string &in asItem, string &in asEntity)
{
if (GetLocalVarInt("lighton") == 0){
SetMessage("03_Red", "uvlamp03", -1);
}
}
void sign_hole(string &in asEntity)
{
SetMessage("03_Red", "sign_hole", -1);
}
void sign_docs(string &in asEntity)
{
SetMessage("03_Red", "sign_dogs", -1);
}
void sign_rad(string &in asEntity)
{
SetMessage("03_Red", "sign_rad", -1);
}
////////////
void OnEnter()
{
CompleteQuest("has", "RedGuests02");
SetEntityCustomFocusCrossHair("ScriptArea_29", "ignite");
PreloadSound("horror_growl1.snt"); 
PreloadSound("event_rail_steps.snt"); 
PreloadSound("event_rail_steps_gettingin.snt"); 
PreloadSound("event_rail_minecart.snt"); 
PreloadSound("oldmine_cave_rumble.snt"); 
PreloadSound("door_ventilation_start.snt"); 
PreloadSound("door_ventilation_stop.snt"); 
PreloadSound("afx_cellar_light_flicker.snt"); 
PreloadSound("horror_bang_mirror1.snt"); 
PreloadSound("break_wooden_door1.snt"); 
PreloadSound("break_wooden_barrel.snt"); 
PreloadSound("ear_sound_scene.snt"); 
PreloadSound("break_metal_door.snt"); 
PreloadSound("enemy_rock_worm_attack.snt"); 
////////////
PreloadSound("red_cloud_swarm.snt"); 
PreloadSound("puzzle_place_jar.snt"); 
PreloadSound("door_metal_turnlock_open1.snt"); 
PreloadSound("door_metal_turnlock_close1.snt"); 
PreloadSound("01_door_open_2.snt"); 
PreloadSound("01_door_close_2.snt"); 
PreloadSound("07_infected_rumble.snt");
PreloadSound("break_metal_sheet.snt");
PreloadSound("interact_locked_gate.snt");
PreloadSound("03_metal_impact.snt");
PreloadSound("infected_hunting_2.snt");
PreloadSound("13_light_out1.snt");
PreloadSound("lm_light_flicker_long.snt");
PreloadSound("afx_bilge_stinger.snt");
PreloadSound("fanloop_new.snt");
PreloadSound("fanloop_squeak.snt");
PreloadSound("enemy_dog_eat.snt");
PreloadSound("player_coughnew.snt");
PreloadSound("lm_burning_gas.snt");
PreloadSound("event_metal_impact_echo1.snt");
PreloadSound("event_rail.snt");
PreloadSound("18_prisoner1.snt");
////////////
PreloadParticleSystem("ps_guardian_danger_fog_loop.ps");
PreloadParticleSystem("ps_blood_drop_area.ps");
PreloadParticleSystem("blood.ps");
PreloadSound("19_pour_blood_low.snt");
PreloadParticleSystem("particle_explosion_bomb.ps");
PreloadParticleSystem("ps_dust_falling_small_thin.ps");
PreloadParticleSystem("ps_dust_falling_rumble.ps");
PreloadParticleSystem("particle_expl_dust_small.ps");
PreloadParticleSystem("particle_expl_dust_exp.ps");
PreloadParticleSystem("flies_intense_swarm.ps");
PreloadParticleSystem("particle_imp_dirt.ps");
PreloadParticleSystem("particle_blood_splat01.ps");
PreloadParticleSystem("particle_tower_steam.ps");
PreloadParticleSystem("particle_dust_lid_remove.ps");
PreloadParticleSystem("ps_impact_dirt_high.ps");
PreloadParticleSystem("ps_break_glass.ps");
PreloadParticleSystem("ps_light_dust.ps");
PreloadParticleSystem("ps_area_fog_small.ps");
SetSanityDrainDisabled(true);
SetPlayerSanity(90);
if (GetGlobalVarInt("alreadymine") == 1){
SetEntityActive("mine_helmet_3", false);
SetEntityActive("lantern_1", false);
SetEntityActive("mine_helmet_2", true);
SetEntityActive("lantern_2", true);
}
if (GetGlobalVarInt("lastmapevent") == 1){
PlayMusic("Underwater Ambient.ogg", true, 0.35, 10, 1, false);
SetEntityActive("amnesia_bottle_174", true);
SetEntityActive("amnesia_bottle_152", false);
SetEntityActive("nec_flare_event", true);
StopSound("Sound_2", 0);
SetEntityActive("ScriptArea_35", true);
SetEntityActive("ScriptArea_17", true);
SetEntityActive("ScriptArea_20", false);
SetEntityActive("ScriptArea_22", false);
SetEntityActive("ScriptArea_21", false);
SetEntityActive("ScriptArea_23", false);
SetEntityActive("ScriptArea_18", true);
SetEntityActive("ScriptArea_19", true);
if (GetLocalVarInt("lighton") == 0){
SetEntityActive("ScriptArea_10", true);
}
}
if (GetGlobalVarInt("questnot02") == 1){
SetEntityActive("lamp_machineroom_165", true);
SetEntityActive("lamp_machineroom_100", false);
}
SetEntityActive("flash_scene2_1", true);
for (int i=3; i<=5; i++){
AddEnemyPatrolNode("flash_scene2_1", "PathNodeArea_"+i, 0.01, "");
}
}
void OnLeave()
{
SetupLoadScreen("", "", 1, "menu_loading_screen.jpg");
SetLanternActive(false, false);
}
////////////////////
